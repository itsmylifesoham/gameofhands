/*!
 * SmartFoxServer 2X HTML5/JavaScript API
 * (c) gotoAndPlay | All rights reserved
 * http://www.smartfoxserver.com
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SFS2X=t():e.SFS2X=t()}(this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=72)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="SFSError",n}return o(t,Error),t}(),a=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.name="SFSValidationError",o.errors=n,o}return o(t,s),t}(),u=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="SFSTypeError",n}return o(t,s),t}();t.SFSError=s,t.SFSValidationError=a,t.SFSTypeError=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Message=t.Requests=t.BaseRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(10);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(t){s(this,e),this._reqObj=new i.SFSObject,this._id=t,this._targetController=0,this._logger=o.Logger.instance}return r(e,null,[{key:"KEY_ERROR_CODE",get:function(){return"ec"}},{key:"KEY_ERROR_PARAMS",get:function(){return"ep"}}]),r(e,[{key:"getMessage",value:function(){return new u(this._id,this._targetController,this._reqObj)}},{key:"validate",value:function(){this._logger.error("BaseRequest.validate = no child-class implementation found!")}},{key:"execute",value:function(){this._logger.error("BaseRequest.execute = no child-class implementation found!")}},{key:"id",get:function(){return this._id}}]),e}(),u=function(){function e(t,n,r){s(this,e),this._id=t,this._targetController=n,this._content=r,Object.freeze(this)}return r(e,[{key:"dump",value:function(){return(l.getNameFromId(this.id)+" ("+this.id+")").trim()+"\n"+this.content.getDump()}},{key:"id",get:function(){return this._id}},{key:"targetController",get:function(){return this._targetController}},{key:"content",get:function(){return this._content}}]),e}(),l=Object.freeze({Handshake:0,Login:1,Logout:2,JoinRoom:4,CreateRoom:6,GenericMessage:7,ChangeRoomName:8,ChangeRoomPassword:9,SetRoomVariables:11,SetUserVariables:12,CallExtension:13,LeaveRoom:14,SubscribeRoomGroup:15,UnsubscribeRoomGroup:16,SpectatorToPlayer:17,PlayerToSpectator:18,ChangeRoomCapacity:19,KickUser:24,BanUser:25,FindRooms:27,FindUsers:28,PingPong:29,SetUserPosition:30,InitBuddyList:200,AddBuddy:201,BlockBuddy:202,RemoveBuddy:203,SetBuddyVariables:204,GoOnline:205,InviteUsers:300,InvitationReply:301,CreateSFSGame:302,QuickJoinGame:303,JoinRoomInvite:304,getNameFromId:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]===e)return t;return""}});t.BaseRequest=a,t.Requests=l,t.Message=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vec3D=t.SFSArray=t.SFSObject=t.SFSDataWrapper=t.SFSDataType=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(69),o=n(11),s=n(10),a=n(0);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=Object.freeze({NULL:0,BOOL:1,BYTE:2,SHORT:3,INT:4,LONG:5,FLOAT:6,DOUBLE:7,UTF_STRING:8,BOOL_ARRAY:9,BYTE_ARRAY:10,SHORT_ARRAY:11,INT_ARRAY:12,LONG_ARRAY:13,FLOAT_ARRAY:14,DOUBLE_ARRAY:15,UTF_STRING_ARRAY:16,SFS_ARRAY:17,SFS_OBJECT:18,TEXT:20,fromId:function(e){if("number"!=typeof e)return null;for(var t in this)if(this.hasOwnProperty(t)&&this[t]===e)return t},validate:function(e,t){if(null==this.fromId(e))throw new a.SFSTypeError("Invalid type passed; use one of the SFSDataType constants");var n=null;if(e===this.NULL&&null!=t&&(n="a null value"),e!==this.NULL&&null==t&&(n="a non-null value"),e!==this.BOOL||this.isBoolType(t)||(n="a boolean value"),e!==this.BYTE||this.isByteType(t)||(n="an integer number in this range: 0 <= value < 256"),e!==this.SHORT||this.isShortType(t)||(n="an integer number in this range: -32.768 <= value < +32.768"),e!==this.INT||this.isIntType(t)||(n="an integer number in this range: -2^31 <= value < +2^31"),e!==this.LONG||this.isLongType(t)||(n="an integer number in this range: -(2^53 - 1) <= value <= +(2^53 - 1)"),e!==this.FLOAT||this.isFloatType(t)||(n="a number in this range: -3.4028234663852886e+38 <= value <= 3.4028234663852886e+38"),e!==this.DOUBLE||this.isDoubleType(t)||(n="a finite number"),e!==this.UTF_STRING&&e!==this.TEXT||this.isStringType(t)||(n="a string value"),e!==this.BOOL_ARRAY||this.isArrayType(t,this.isBoolType)||(n="an array of boolean values"),e!==this.BYTE_ARRAY||this.isArrayType(t,this.isByteType)||(n="an array of integer numbers in this range: 0 <= value < 256"),e!==this.SHORT_ARRAY||this.isArrayType(t,this.isShortType)||(n="an array of integer numbers in this range: -32.768 <= value < +32.768"),e!==this.INT_ARRAY||this.isArrayType(t,this.isIntType)||(n="an array of integer numbers in this range: -2^31 <= value < +2^31"),e!==this.LONG_ARRAY||this.isArrayType(t,this.isLongType)||(n="an array of integer numbers in this range: -(2^53 - 1) <= value <= +(2^53 - 1)"),e!==this.FLOAT_ARRAY||this.isArrayType(t,this.isFloatType)||(n="an array of numbers in this range: -3.4028234663852886e+38 <= value <= 3.4028234663852886e+38"),e!==this.DOUBLE_ARRAY||this.isArrayType(t,this.isDoubleType)||(n="an array of finite numbers"),e!==this.UTF_STRING_ARRAY||this.isArrayType(t,this.isStringType)||(n="an array of string values"),e!==this.SFS_OBJECT||t instanceof f||(n="a SFSObject instance"),e!==this.SFS_ARRAY||t instanceof h||(n="a SFSArray instance"),null!=n)throw new a.SFSTypeError("Invalid value passed; type SFSDataType."+this.fromId(e)+" requires "+n)},isBoolType:function(e){return"boolean"==typeof e},isByteType:function(e){return"number"==typeof e&&Math.floor(e)===e&&e>=0&&e<256},isShortType:function(e){return"number"==typeof e&&Math.floor(e)===e&&e>=-32768&&e<32768},isIntType:function(e){return"number"==typeof e&&Math.floor(e)===e&&e>=-2147483648&&e<2147483648},isLongType:function(e){return"number"==typeof e&&Math.floor(e)===e&&Number.isSafeInteger(e)},isFloatType:function(e){return"number"==typeof e&&e>=-3.4028234663852886e38&&e<=3.4028234663852886e38},isDoubleType:function(e){return"number"==typeof e&&isFinite(e)},isStringType:function(e){return"string"==typeof e},isArrayType:function(e,t){return e instanceof Array&&(!(e.length>0)||t(e[0]))}}),c=function e(t,n){u(this,e),this.type=t,this.value=n,Object.freeze(this)},f=function(){function e(){u(this,e),this._dataHolder=new Map,this._serializer=i.SFSDataSerializer.instance,Object.freeze(this)}return r(e,[{key:"toBinary",value:function(){return this._serializer.object2binary(this)}},{key:"keys",value:function(){return this._dataHolder.keys()}},{key:"getWrappedItem",value:function(e){return this._dataHolder.get(e)}},{key:"getKeysArray",value:function(){return Array.from(this.keys())}},{key:"size",value:function(){return this._dataHolder.size}},{key:"containsKey",value:function(e){return null!=this.getWrappedItem(e)}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getWrappedItem(e);if(null!=n&&null!=t&&n.type!=t)throw new a.SFSTypeError("Requested value is not of type SFSDataType."+l.fromId(t));return null!=n?n.value:null}},{key:"isNull",value:function(e){var t=this.getWrappedItem(e);return null==t||t.type==l.NULL}},{key:"getBool",value:function(e){return this.get(e,l.BOOL)}},{key:"getByte",value:function(e){return this.get(e,l.BYTE)}},{key:"getShort",value:function(e){return this.get(e,l.SHORT)}},{key:"getInt",value:function(e){return this.get(e,l.INT)}},{key:"getLong",value:function(e){var t=this.get(e,l.LONG);return Number.isSafeInteger(t)||s.Logger.instance.warn("Long value contained in SFSObject is not safe"),t}},{key:"getFloat",value:function(e){return this.get(e,l.FLOAT)}},{key:"getDouble",value:function(e){return this.get(e,l.DOUBLE)}},{key:"getUtfString",value:function(e){return this.get(e,l.UTF_STRING)}},{key:"getText",value:function(e){return this.get(e,l.TEXT)}},{key:"getBoolArray",value:function(e){return this.get(e,l.BOOL_ARRAY)}},{key:"getByteArray",value:function(e){return this.get(e,l.BYTE_ARRAY)}},{key:"getShortArray",value:function(e){return this.get(e,l.SHORT_ARRAY)}},{key:"getIntArray",value:function(e){return this.get(e,l.INT_ARRAY)}},{key:"getLongArray",value:function(e){return this.get(e,l.LONG_ARRAY)}},{key:"getFloatArray",value:function(e){return this.get(e,l.FLOAT_ARRAY)}},{key:"getDoubleArray",value:function(e){return this.get(e,l.DOUBLE_ARRAY)}},{key:"getUtfStringArray",value:function(e){return this.get(e,l.UTF_STRING_ARRAY)}},{key:"getSFSObject",value:function(e){return this.get(e,l.SFS_OBJECT)}},{key:"getSFSArray",value:function(e){return this.get(e,l.SFS_ARRAY)}},{key:"put",value:function(e,t,n){if(!(arguments.length>3&&void 0!==arguments[3]&&arguments[3])){if("string"!=typeof e)throw"Invalid key passed; must be of type string";l.validate(n,t)}this._dataHolder.set(e,new c(n,t))}},{key:"putNull",value:function(e){this.put(e,null,l.NULL)}},{key:"putBool",value:function(e,t){this.put(e,t,l.BOOL)}},{key:"putByte",value:function(e,t){this.put(e,t,l.BYTE)}},{key:"putShort",value:function(e,t){this.put(e,t,l.SHORT)}},{key:"putInt",value:function(e,t){this.put(e,t,l.INT)}},{key:"putLong",value:function(e,t){this.put(e,t,l.LONG)}},{key:"putFloat",value:function(e,t){this.put(e,t,l.FLOAT)}},{key:"putDouble",value:function(e,t){this.put(e,t,l.DOUBLE)}},{key:"putUtfString",value:function(e,t){this.put(e,t,l.UTF_STRING)}},{key:"putText",value:function(e,t){this.put(e,t,l.TEXT)}},{key:"putBoolArray",value:function(e,t){this.put(e,t,l.BOOL_ARRAY)}},{key:"putByteArray",value:function(e,t){this.put(e,t,l.BYTE_ARRAY)}},{key:"putShortArray",value:function(e,t){this.put(e,t,l.SHORT_ARRAY)}},{key:"putIntArray",value:function(e,t){this.put(e,t,l.INT_ARRAY)}},{key:"putLongArray",value:function(e,t){this.put(e,t,l.LONG_ARRAY)}},{key:"putFloatArray",value:function(e,t){this.put(e,t,l.FLOAT_ARRAY)}},{key:"putDoubleArray",value:function(e,t){this.put(e,t,l.DOUBLE_ARRAY)}},{key:"putUtfStringArray",value:function(e,t){this.put(e,t,l.UTF_STRING_ARRAY)}},{key:"putSFSArray",value:function(e,t){this.put(e,t,l.SFS_ARRAY)}},{key:"putSFSObject",value:function(e,t){this.put(e,t,l.SFS_OBJECT)}},{key:"getDump",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return 0===this.size()?"[ Empty SFSObject ]":e?o.DumpFormatter.prettyPrintDump(this._dump()):this._dump()}},{key:"getHexDump",value:function(){return o.DumpFormatter.hexDump(this.toBinary())}},{key:"_dump",value:function(){var e=o.DumpFormatter.TOKEN_INDENT_OPEN,t=!0,n=!1,r=void 0;try{for(var i,s=this.keys()[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=i.value,u=this.getWrappedItem(a);e+="("+l.fromId(u.type).toLowerCase()+") "+a+": ",u.type===l.SFS_OBJECT||u.type===l.SFS_ARRAY?e+=u.value.getDump(!1):u.type===l.BYTE_ARRAY?e+=o.DumpFormatter.prettyPrintByteArray(u.value):e+=u.value,e+=o.DumpFormatter.TOKEN_DIVIDER}}catch(e){n=!0,r=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw r}}return e+=o.DumpFormatter.TOKEN_INDENT_CLOSE}}],[{key:"newFromBinaryData",value:function(e){return i.SFSDataSerializer.instance.binary2object(e)}}]),e}(),h=function(){function e(){u(this,e),this._dataHolder=[],this._serializer=i.SFSDataSerializer.instance,Object.freeze(this)}return r(e,[{key:"toBinary",value:function(){return this._serializer.array2binary(this)}},{key:"getWrappedItem",value:function(e){return"number"!=typeof e||e>=this._dataHolder.length?null:this._dataHolder[e]}},{key:"size",value:function(){return this._dataHolder.length}},{key:"contains",value:function(t){if(t instanceof e||t instanceof f)throw new a.SFSError("SFSArray and SFSObject types are not supported by the SFSArray.contains method");for(var n=0;n<this.size();n++){var r=this.getWrappedItem(n);if(null!=r&&r.value==t)return!0}return!1}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("number"!=typeof e||e>=this._dataHolder.length)return null;var n=this.getWrappedItem(e);if(null!=n&&null!=t&&n.type!=t)throw new a.SFSTypeError("Requested value is not of type SFSDataType."+l.fromId(t));return null!=n?n.value:null}},{key:"isNull",value:function(e){var t=this.getWrappedItem(e);return null==t||t.type==l.NULL}},{key:"getBool",value:function(e){return this.get(e,l.BOOL)}},{key:"getByte",value:function(e){return this.get(e,l.BYTE)}},{key:"getShort",value:function(e){return this.get(e,l.SHORT)}},{key:"getInt",value:function(e){return this.get(e,l.INT)}},{key:"getLong",value:function(e){var t=this.get(e,l.LONG);return Number.isSafeInteger(t)||s.Logger.instance.warn("Long value contained in SFSObject is not safe"),t}},{key:"getFloat",value:function(e){return this.get(e,l.FLOAT)}},{key:"getDouble",value:function(e){return this.get(e,l.DOUBLE)}},{key:"getUtfString",value:function(e){return this.get(e,l.UTF_STRING)}},{key:"getText",value:function(e){return this.get(e,l.TEXT)}},{key:"getBoolArray",value:function(e){return this.get(e,l.BOOL_ARRAY)}},{key:"getByteArray",value:function(e){return this.get(e,l.BYTE_ARRAY)}},{key:"getShortArray",value:function(e){return this.get(e,l.SHORT_ARRAY)}},{key:"getIntArray",value:function(e){return this.get(e,l.INT_ARRAY)}},{key:"getLongArray",value:function(e){return this.get(e,l.LONG_ARRAY)}},{key:"getFloatArray",value:function(e){return this.get(e,l.FLOAT_ARRAY)}},{key:"getDoubleArray",value:function(e){return this.get(e,l.DOUBLE_ARRAY)}},{key:"getUtfStringArray",value:function(e){return this.get(e,l.UTF_STRING_ARRAY)}},{key:"getSFSObject",value:function(e){return this.get(e,l.SFS_OBJECT)}},{key:"getSFSArray",value:function(e){return this.get(e,l.SFS_ARRAY)}},{key:"add",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]||l.validate(t,e),this._dataHolder.push(new c(t,e))}},{key:"addNull",value:function(){this.add(null,l.NULL)}},{key:"addBool",value:function(e){this.add(e,l.BOOL)}},{key:"addByte",value:function(e){this.add(e,l.BYTE)}},{key:"addShort",value:function(e){this.add(e,l.SHORT)}},{key:"addInt",value:function(e){this.add(e,l.INT)}},{key:"addLong",value:function(e){this.add(e,l.LONG)}},{key:"addFloat",value:function(e){this.add(e,l.FLOAT)}},{key:"addDouble",value:function(e){this.add(e,l.DOUBLE)}},{key:"addUtfString",value:function(e){this.add(e,l.UTF_STRING)}},{key:"addText",value:function(e){this.add(e,l.TEXT)}},{key:"addBoolArray",value:function(e){this.add(e,l.BOOL_ARRAY)}},{key:"addByteArray",value:function(e){this.add(e,l.BYTE_ARRAY)}},{key:"addShortArray",value:function(e){this.add(e,l.SHORT_ARRAY)}},{key:"addIntArray",value:function(e){this.add(e,l.INT_ARRAY)}},{key:"addLongArray",value:function(e){this.add(e,l.LONG_ARRAY)}},{key:"addFloatArray",value:function(e){this.add(e,l.FLOAT_ARRAY)}},{key:"addDoubleArray",value:function(e){this.add(e,l.DOUBLE_ARRAY)}},{key:"addUtfStringArray",value:function(e){this.add(e,l.UTF_STRING_ARRAY)}},{key:"addSFSArray",value:function(e){this.add(e,l.SFS_ARRAY)}},{key:"addSFSObject",value:function(e){this.add(e,l.SFS_OBJECT)}},{key:"getDump",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return 0===this.size()?"[ Empty SFSArray ]":e?o.DumpFormatter.prettyPrintDump(this._dump()):this._dump()}},{key:"getHexDump",value:function(){return o.DumpFormatter.hexDump(this.toBinary())}},{key:"_dump",value:function(){for(var e=o.DumpFormatter.TOKEN_INDENT_OPEN,t=0;t<this.size();t++){var n=this.getWrappedItem(t);e+="("+l.fromId(n.type).toLowerCase()+") "+t+": ",n.type===l.SFS_OBJECT||n.type===l.SFS_ARRAY?e+=n.value.getDump(!1):n.type===l.BYTE_ARRAY?e+=o.DumpFormatter.prettyPrintByteArray(n.value):e+=n.value,e+=o.DumpFormatter.TOKEN_DIVIDER}return e+=o.DumpFormatter.TOKEN_INDENT_CLOSE}}],[{key:"newFromBinaryData",value:function(e){return i.SFSDataSerializer.instance.binary2array(e)}}]),e}(),_=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];u(this,e),this.px=t,this.py=n,this.pz=r,this._useFloatCoordinates=i}return r(e,[{key:"toString",value:function(){return"("+this.px+","+this.py+","+this.pz+")"}},{key:"toArray",value:function(){return[this.px,this.py,this.pz]}},{key:"isFloat",get:function(){return this._useFloatCoordinates}}],[{key:"fromArray",value:function(t){return new e(t[0],t[1],t[2])}}]),e}();t.SFSDataType=l,t.SFSDataWrapper=c,t.SFSObject=f,t.SFSArray=h,t.Vec3D=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMORoom=t.SFSRoom=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(9),s=n(43),a=n(0);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];u(this,e),this._id=t,this._name=n,this._groupId=r,this._isGame=!1,this._isHidden=!1,this._isJoined=!1,this._isPasswordProtected=!1,this._maxUsers=0,this._maxSpectators=0,this._userCount=0,this._specCount=0,this._isManaged=!0,this._variables=new Map,this._userManager=new s.SFSUserManager,this._roomManager=null,this.properties={},i&&Object.seal(this)}return r(e,[{key:"toString",value:function(){return"[Room: "+this.name+", Id: "+this.id+", Group Id: "+this.groupId+"]"}},{key:"getUserByName",value:function(e){return this._userManager.getUserByName(e)}},{key:"getUserById",value:function(e){return this._userManager.getUserById(e)}},{key:"containsUser",value:function(e){return this._userManager.containsUser(e)}},{key:"getUserList",value:function(){return this._userManager.getUserList()}},{key:"getPlayerList",value:function(){var e=this;return this._userManager.getUserList().filter(function(t){return t.isPlayerInRoom(e)})}},{key:"getSpectatorList",value:function(){var e=this;return this._userManager.getUserList().filter(function(t){return t.isSpectatorInRoom(e)})}},{key:"getVariable",value:function(e){return this._variables.get(e)}},{key:"containsVariable",value:function(e){return this._variables.has(e)}},{key:"getVariables",value:function(){return Array.from(this._variables.values())}},{key:"getRoomManager",value:function(){return this._roomManager}},{key:"_addUser",value:function(e){this._userManager._addUser(e)}},{key:"_removeUser",value:function(e){this._userManager._removeUser(e)}},{key:"_setVariables",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;this._setVariable(s)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_setVariable",value:function(e){e.isNull?this._variables.delete(e.name):this._variables.set(e.name,e)}},{key:"_setRoomManager",value:function(e){if(null!=this._roomManager)throw new a.SFSError("Room Manager already assigned to "+this.toString());this._roomManager=e}},{key:"_merge",value:function(e){this._variables.clear();var t=!0,n=!1,r=void 0;try{for(var i,o=e._variables.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;this._setVariable(s)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this._userManager._clearAll();var a=!0,u=!1,l=void 0;try{for(var c,f=e.getUserList()[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var h=c.value;this._addUser(h)}}catch(e){u=!0,l=e}finally{try{!a&&f.return&&f.return()}finally{if(u)throw l}}}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"groupId",get:function(){return this._groupId}},{key:"isGame",get:function(){return this._isGame}},{key:"isHidden",get:function(){return this._isHidden}},{key:"isJoined",get:function(){return this._isJoined}},{key:"isPasswordProtected",get:function(){return this._isPasswordProtected}},{key:"maxUsers",get:function(){return this._maxUsers}},{key:"maxSpectators",get:function(){return this._maxSpectators}},{key:"userCount",get:function(){return this.isJoined?this.isGame?this.getPlayerList().length:this._userManager.getUserCount():this._userCount}},{key:"spectatorCount",get:function(){return this.isGame?this.isJoined?this.getSpectatorList().length:this._specCount:0}},{key:"capacity",get:function(){return this.maxUsers+this.maxSpectators}}],[{key:"fromSFSArray",value:function(t){var n=14===t.size(),r=void 0;(r=n?new c(t.get(0),t.get(1),t.get(2)):new e(t.get(0),t.get(1),t.get(2)))._isGame=t.get(3),r._isHidden=t.get(4),r._isPasswordProtected=t.get(5),r._userCount=t.get(6),r._maxUsers=t.get(7);var s=t.get(8);if(null!=s)for(var a=0;a<s.size();a++){var u=o.SFSRoomVariable.fromSFSArray(s.get(a));r._setVariable(u)}return r._isGame&&(r._specCount=t.get(9),r._maxSpectators=t.get(10)),n&&(r._defaultAOI=i.Vec3D.fromArray(t.get(11)),null!=t.get(13)&&(r._lowerMapLimit=i.Vec3D.fromArray(t.get(12)),r._higherMapLimit=i.Vec3D.fromArray(t.get(13)))),r}}]),e}(),c=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default";u(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,!1));return i._defaultAOI=null,i._lowerMapLimit=null,i._higherMapLimit=null,i._itemsById=new Map,Object.seal(i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l),r(t,[{key:"getMMOItem",value:function(e){return this._itemsById.get(e)}},{key:"getMMOItems",value:function(){return Array.from(this._itemsById.values())}},{key:"_addMMOItem",value:function(e){this._itemsById.set(e.id,e)}},{key:"_removeItem",value:function(e){this._itemsById.delete(e)}},{key:"defaultAOI",get:function(){return this._defaultAOI}},{key:"lowerMapLimit",get:function(){return this._lowerMapLimit}},{key:"higherMapLimit",get:function(){return this._higherMapLimit}}]),t}();t.SFSRoom=l,t.MMORoom=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._listenersByEvent={}}return r(e,[{key:"addEventListener",value:function(e,t,n){this._listenersByEvent[e]||(this._listenersByEvent[e]=[]),this._listenersByEvent[e].push({callback:t,scope:n})}},{key:"removeEventListener",value:function(e,t){var n=this._listenersByEvent[e];if(n)for(var r=0;r<n.length;r++)if(n[r].callback===t){n.splice(r,1);break}}},{key:"dispatchEvent",value:function(e,t){var n=this._listenersByEvent[e];if(n){var r=!0,i=!1,o=void 0;try{for(var s,a=n[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var u=s.value;u.callback.call(u.scope,t)}}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}}}}]),e}(),o=Object.freeze({HANDSHAKE:"handshake",CONNECTION:"connection",CONNECTION_LOST:"connectionLost",LOGIN:"login",LOGIN_ERROR:"loginError",LOGOUT:"logout",ROOM_ADD:"roomAdd",ROOM_CREATION_ERROR:"roomCreationError",ROOM_REMOVE:"roomRemove",ROOM_JOIN:"roomJoin",ROOM_JOIN_ERROR:"roomJoinError",USER_ENTER_ROOM:"userEnterRoom",USER_EXIT_ROOM:"userExitRoom",USER_COUNT_CHANGE:"userCountChange",PROXIMITY_LIST_UPDATE:"proximityListUpdate",PLAYER_TO_SPECTATOR:"playerToSpectator",PLAYER_TO_SPECTATOR_ERROR:"playerToSpectatorError",SPECTATOR_TO_PLAYER:"spectatorToPlayer",SPECTATOR_TO_PLAYER_ERROR:"spectatorToPlayerError",ROOM_NAME_CHANGE:"roomNameChange",ROOM_NAME_CHANGE_ERROR:"roomNameChangeError",ROOM_PASSWORD_STATE_CHANGE:"roomPasswordStateChange",ROOM_PASSWORD_STATE_CHANGE_ERROR:"roomPasswordStateChangeError",ROOM_CAPACITY_CHANGE:"roomCapacityChange",ROOM_CAPACITY_CHANGE_ERROR:"roomCapacityChangeError",PUBLIC_MESSAGE:"publicMessage",PRIVATE_MESSAGE:"privateMessage",OBJECT_MESSAGE:"objectMessage",MODERATOR_MESSAGE:"moderatorMessage",ADMIN_MESSAGE:"adminMessage",EXTENSION_RESPONSE:"extensionResponse",ROOM_VARIABLES_UPDATE:"roomVariablesUpdate",USER_VARIABLES_UPDATE:"userVariablesUpdate",MMOITEM_VARIABLES_UPDATE:"mmoItemVariablesUpdate",ROOM_GROUP_SUBSCRIBE:"roomGroupSubscribe",ROOM_GROUP_SUBSCRIBE_ERROR:"roomGroupSubscribeError",ROOM_GROUP_UNSUBSCRIBE:"roomGroupUnsubscribe",ROOM_GROUP_UNSUBSCRIBE_ERROR:"roomGroupUnsubscribeError",ROOM_FIND_RESULT:"roomFindResult",USER_FIND_RESULT:"userFindResult",INVITATION:"invitation",INVITATION_REPLY:"invitationReply",INVITATION_REPLY_ERROR:"invitationReplyError",PING_PONG:"pingPong",SOCKET_ERROR:"socketError"}),s=Object.freeze({BUDDY_LIST_INIT:"buddyListInit",BUDDY_ADD:"buddyAdd",BUDDY_REMOVE:"buddyRemove",BUDDY_BLOCK:"buddyBlock",BUDDY_ERROR:"buddyError",BUDDY_ONLINE_STATE_CHANGE:"buddyOnlineStateChange",BUDDY_VARIABLES_UPDATE:"buddyVariablesUpdate",BUDDY_MESSAGE:"buddyMessage"});t.EventDispatcher=i,t.SFSEvent=o,t.SFSBuddyEvent=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogicOperator=t.MatchExpression=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(t,n,r){o(this,e),this._varName=t,this._condition=n,this._value=r,this._logicOp=null,this._next=null,this._parent=null,Object.seal(this)}return r(e,[{key:"and",value:function(t,n,r){return this._next=e.chainedMatchExpression(t,n,r,a.AND,this),this._next}},{key:"or",value:function(t,n,r){return this._next=e.chainedMatchExpression(t,n,r,a.OR,this),this._next}},{key:"hasNext",value:function(){return null!=this._next}},{key:"rewind",value:function(){for(var e=this;null!=e._parent;)e=e._parent;return e}},{key:"toString",value:function(){for(var e=this.rewind(),t=e.asString();e.hasNext();)t+=(e=e.next).asString();return t}},{key:"asString",value:function(){var e="";null!=this._logicOp&&(e+=" "+this._logicOp.id+" ");var t="string"==typeof this._value?"' "+this._value+" '":this._value;return e+="("+this._varName+" "+this._condition.symbol+" "+t+")"}},{key:"toSFSArray",value:function(){var e=this.rewind(),t=new i.SFSArray;for(t.addSFSArray(e.expressionAsSFSArray());e.hasNext();)e=e.next,t.addSFSArray(e.expressionAsSFSArray());return t}},{key:"expressionAsSFSArray",value:function(){var e=new i.SFSArray;return null!=this._logicOp?e.addUtfString(this._logicOp.id):e.addNull(),e.addUtfString(this._varName),e.addByte(this._condition.type),e.addUtfString(this._condition.symbol),0===this._condition.type?e.addBool(this._value):1===this._condition.type?e.addDouble(this._value):e.addUtfString(this._value),e}},{key:"varName",get:function(){return this._varName}},{key:"condition",get:function(){return this._condition}},{key:"value",get:function(){return this._value}},{key:"logicOp",get:function(){return this._logicOp}},{key:"next",get:function(){return this._next}}],[{key:"chainedMatchExpression",value:function(t,n,r,i,o){var s=new e(t,n,r);return s._logicOp=i,s._parent=o,s}}]),e}(),a=function(){function e(t){o(this,e),this._id=t,Object.freeze(this)}return r(e,[{key:"id",get:function(){return this._id}}],[{key:"AND",get:function(){return new e("AND")}},{key:"OR",get:function(){return new e("OR")}}]),e}();t.MatchExpression=s,t.LogicOperator=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SFSBuddyVariable=t.ReservedBuddyVariables=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(8);var o=Object.freeze({BV_ONLINE:"$__BV_ONLINE__",BV_STATE:"$__BV_STATE__",BV_NICKNAME:"$__BV_NICKNAME__"}),s=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return Object.freeze(i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseVariable),r(t,null,[{key:"OFFLINE_PREFIX",get:function(){return"$"}}]),r(t,[{key:"toString",value:function(){return"[BuddyVar: "+this.name+", Type: "+this.type+", Value: "+this.value+"]"}},{key:"isOffline",get:function(){return this._name.charAt(0)===t.OFFLINE_PREFIX}}],[{key:"fromSFSArray",value:function(e){return new t(e.get(0),e.get(2),e.get(1))}}]),t}();t.ReservedBuddyVariables=o,t.SFSBuddyVariable=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserPrivileges=t.SFSUser=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(14),o=n(0);var s=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=t,this._name=n,this._isItMe=r,this._privilegeId=0,this._aoiEntryPoint=null,this._variables=new Map,this._playerIdByRoomId=new Map,this._userManager=null,this.properties={},Object.seal(this)}return r(e,[{key:"toString",value:function(){return"[User: "+this.name+", Id: "+this.id+", Is me: "+this.isItMe+"]"}},{key:"isJoinedInRoom",value:function(e){return e.containsUser(this)}},{key:"getPlayerId",value:function(e){var t=this._playerIdByRoomId.get(e.id);return null!=t?t:0}},{key:"isPlayerInRoom",value:function(e){return!!e.isGame&&this.getPlayerId(e)>0}},{key:"isSpectatorInRoom",value:function(e){return!!e.isGame&&this.getPlayerId(e)<0}},{key:"getVariable",value:function(e){return this._variables.get(e)}},{key:"containsVariable",value:function(e){return this._variables.has(e)}},{key:"getVariables",value:function(){return Array.from(this._variables.values())}},{key:"getUserManager",value:function(){return this._userManager}},{key:"_setPlayerId",value:function(e,t){this._playerIdByRoomId.set(t.id,e)}},{key:"_removePlayerId",value:function(e){this._playerIdByRoomId.delete(e.id)}},{key:"_setVariables",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;this._setVariable(s)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_setVariable",value:function(e){e.isNull?this._variables.delete(e.name):this._variables.set(e.name,e)}},{key:"_setUserManager",value:function(e){if(null!=this._userManager)throw new o.SFSError("User Manager already assigned to user "+this.toString());this._userManager=e}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"isItMe",get:function(){return this._isItMe}},{key:"privilegeId",get:function(){return this._privilegeId}},{key:"aoiEntryPoint",get:function(){return this._aoiEntryPoint}},{key:"isGuest",get:function(){return this._privilegeId===a.GUEST}},{key:"isStandardUser",get:function(){return this._privilegeId===a.STANDARD}},{key:"isModerator",get:function(){return this._privilegeId===a.MODERATOR}},{key:"isAdmin",get:function(){return this.privilegeId===a.ADMINISTRATOR}},{key:"isPlayer",get:function(){return this.isPlayerInRoom(this._userManager._sfs.lastJoinedRoom)}},{key:"isSpectator",get:function(){return this.isSpectatorInRoom(this._userManager._sfs.lastJoinedRoom)}}],[{key:"fromSFSArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new e(t.get(0),t.get(1));r._privilegeId=t.get(2),null!=n&&r._setPlayerId(t.get(3),n);var o=t.get(4);if(null!=o)for(var s=0;s<o.size();s++)r._setVariable(i.SFSUserVariable.fromSFSArray(o.get(s)));return r}}]),e}(),a=Object.freeze({GUEST:0,STANDARD:1,MODERATOR:2,ADMINISTRATOR:3});t.SFSUser=s,t.UserPrivileges=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseVariable=t.VariableType=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2);var s=Object.freeze({NULL:0,BOOLEAN:1,INT:2,DOUBLE:3,STRING:4,SFSOBJECT:5,SFSARRAY:6,getTypeName:function(e){return["null","boolean","int","double","string","SFSObject","SFSArray"][e]}}),a=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._value=n,this._type=r>-1?r:this._evalType()}return i(e,[{key:"toSFSArray",value:function(){var e=new o.SFSArray;return e.addUtfString(this.name),e.addByte(this._type),this._populateArrayWithValue(e),e}},{key:"_populateArrayWithValue",value:function(e){switch(this._type){case s.NULL:e.addNull();break;case s.BOOLEAN:e.addBool(this.value);break;case s.INT:e.addInt(this.value);break;case s.DOUBLE:e.addDouble(this.value);break;case s.STRING:e.addUtfString(this.value);break;case s.SFSOBJECT:e.addSFSObject(this.value);break;case s.SFSARRAY:e.addSFSArray(this.value)}}},{key:"_evalType",value:function(){if(null==this._value)return s.NULL;var e=r(this._value);if("boolean"===e)return s.BOOLEAN;if("number"===e){var t=this._value;return t===+t&&t===(0|t)?s.INT:s.DOUBLE}return"string"===e?s.STRING:"object"===e?this._value instanceof o.SFSArray?s.SFSARRAY:s.SFSOBJECT:void 0}},{key:"name",get:function(){return this._name}},{key:"value",get:function(){return this._value}},{key:"type",get:function(){return s.getTypeName(this._type)}},{key:"isNull",get:function(){return this._type===s.NULL}}]),e}();t.VariableType=s,t.BaseVariable=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SFSRoomVariable=t.ReservedRoomVariables=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(8);var o=Object.freeze({RV_GAME_STARTED:"$GS"}),s=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return i.isPrivate=!1,i.isPersistent=!1,Object.seal(i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseVariable),r(t,[{key:"toString",value:function(){return"[RoomVar: "+this.name+", Type: "+this.type+", Value: "+this.value+", Private: "+this.isPrivate+"]"}},{key:"toSFSArray",value:function(){var e=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toSFSArray",this).call(this);return e.addBool(this.isPrivate),e.addBool(this.isPersistent),e}}],[{key:"fromSFSArray",value:function(e){var n=new t(e.get(0),e.get(2),e.get(1));return n.isPrivate=e.get(3),n.isPersistent=e.get(4),n}}]),t}();t.ReservedRoomVariables=o,t.SFSRoomVariable=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerEvent=t.Logger=t.LogLevel=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(4);var o=Object.freeze({DEBUG:0,INFO:1,WARN:2,ERROR:3,toString:function(e){return e===this.DEBUG?"DEBUG":e===this.INFO?"INFO":e===this.WARN?"WARN":e===this.ERROR?"ERROR":void 0}}),s=Object.freeze({DEBUG:"debug",INFO:"info",WARNING:"warn",ERROR:"error"}),a=Symbol(),u=Symbol(),l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(e!==u)throw"Logger is a singleton class; you can't instantiate it";return n._enableConsoleOutput=void 0!==console,n._enableEventDispatching=!1,n._level=o.INFO,n._useBasicLog=!0,void 0!==console&&(n._useBasicLog="function"!=typeof console.debug||"function"!=typeof console.info||"function"!=typeof console.warn||"function"!=typeof console.error),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.EventDispatcher),r(t,[{key:"log",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(this.isValidLevel(e)&&e>=this._level){if(this._enableConsoleOutput){var s=function(e,n){t._useBasicLog&&(n=function(e){console.log(e)}),n("[ SFS2X | "+e+" ] "+r.join(" "))};switch(e){case o.DEBUG:s("DEBUG",function(e){console.debug(e)});break;case o.INFO:s("INFO",function(e){console.info(e)});break;case o.WARN:s("WARN",function(e){console.warn(e)});break;case o.ERROR:s("ERROR",function(e){console.error(e)})}}this._enableEventDispatching&&this.dispatchEvent(o.toString(e).toLowerCase(),{message:r.join(" ")})}}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log(o.DEBUG,t)}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log(o.INFO,t)}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log(o.WARN,t)}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log(o.ERROR,t)}},{key:"isValidLevel",value:function(e){if(!Number.isInteger(e)||e<o.DEBUG||e>o.ERROR)throw"Logging level must be set to a valid value (see LogLevel class)";return!0}},{key:"level",set:function(e){this.isValidLevel(e)&&(this._level=e)},get:function(){return this._level}},{key:"enableConsoleOutput",set:function(e){void 0!==console&&(this._enableConsoleOutput=e)},get:function(){return this._enableConsoleOutput}},{key:"enableEventDispatching",set:function(e){this._enableEventDispatching=e},get:function(){return this._enableEventDispatching}}],[{key:"instance",get:function(){return this[a]||(this[a]=new t(u)),Object.seal(this[a])}}]),t}();t.LogLevel=o,t.Logger=l,t.LoggerEvent=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=Object.freeze({IDLE:"idle",KICK:"kick",BAN:"ban",MANUAL:"manual",UNKNOWN:"unknown",getReason:function(e){switch(e){case 0:return this.IDLE;case 1:return this.KICK;case 2:return this.BAN;case 3:return this.MANUAL;case 4:return this.UNKNOWN}}}),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"prettyPrintByteArray",value:function(e){return null==e?"Null":e.length<32?e.toString():"Byte["+e.length+"]"}},{key:"prettyPrintDump",value:function(e){for(var t="",n=0,r=0;r<e.length;r++){var i=e.charAt(r);if(i==this.TOKEN_INDENT_OPEN)n++,t+=this.NEW_LINE+this.getFormatTabs(n);else if(i==this.TOKEN_INDENT_CLOSE){if(--n<0)throw"DumpFormatter: the indentPos is negative. TOKENS ARE NOT BALANCED!";t+=this.NEW_LINE+this.getFormatTabs(n)}else i==this.TOKEN_DIVIDER?t+=this.NEW_LINE+this.getFormatTabs(n):t+=i}if(0!=n)throw"DumpFormatter: the indentPos is not === 0 ("+n+"). TOKENS ARE NOT BALANCED!";return t}},{key:"getFormatTabs",value:function(e){return this.strFill(this.TAB,e)}},{key:"strFill",value:function(e,t){for(var n="",r=0;r<t;r++)n+=e;return n}},{key:"hexDump",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;-1===t&&(t=this.HEX_BYTES_PER_LINE);var n="Binary size: "+e.byteLength+this.NEW_LINE,r="",i="",o=0,s=0,a=null;do{var u=(a=e[o]).toString(16).toUpperCase();1===u.length&&(u="0"+u),r+=u+" ",i+=a>=33&&a<=126?String.fromCharCode(a):this.DOT,++s===t&&(s=0,n+=r+this.TAB+i+this.NEW_LINE,r="",i="")}while(++o<e.length);if(0!==s){for(var l=t-s;l>0;--l)r+="   ",i+=" ";n+=r+this.TAB+i+this.NEW_LINE}return n}},{key:"TOKEN_INDENT_OPEN",get:function(){return"{"}},{key:"TOKEN_INDENT_CLOSE",get:function(){return"}"}},{key:"TOKEN_DIVIDER",get:function(){return";"}},{key:"NEW_LINE",get:function(){return"\n"}},{key:"TAB",get:function(){return"\t"}},{key:"DOT",get:function(){return"."}},{key:"HEX_BYTES_PER_LINE",get:function(){return 16}}]),e}();t.ClientDisconnectionReason=i,t.DumpFormatter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageRecipientMode=t.BanMode=t.MapLimits=t.RoomExtension=t.RoomEvents=t.RoomPermissions=t.MMORoomSettings=t.SFSGameSettings=t.RoomSettings=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0);function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=function e(t){a(this,e),this.name=t,this.password="",this.groupId="default",this.isGame=!1,this.maxUsers=10,this.maxSpectators=0,this.maxVariables=5,this.variables=[],this.permissions=null,this.events=null,this.extension=null,this.allowOwnerOnlyInvitation=!0},l=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.isPublic=!0,n.minPlayersToStartGame=2,n.invitedPlayers=null,n.searchableRooms=null,n.invitationExpiryTime=15,n.leaveLastJoinedRoom=!0,n.notifyGameStarted=!1,n.playerMatchExpression=null,n.spectatorMatchExpression=null,n.invitationParams=null,Object.seal(n),n}return s(t,u),t}(),c=function(e){function t(e,n){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.defaultAOI=n,r.mapLimits=null,r.userMaxLimboSeconds=50,r.proximityListUpdateMillis=250,r.sendAOIEntryPoint=!0,Object.seal(r),r}return s(t,u),t}(),f=Object.freeze({BY_ADDRESS:0,BY_NAME:1}),h=function(){function e(t,n){if(a(this,e),t<e.TO_USER||t>e.TO_ZONE)throw new i.SFSError("Illegal recipient mode: "+t);this._mode=t,this._target=n,Object.freeze(this)}return r(e,null,[{key:"TO_USER",get:function(){return 0}},{key:"TO_ROOM",get:function(){return 1}},{key:"TO_GROUP",get:function(){return 2}},{key:"TO_ZONE",get:function(){return 3}}]),r(e,[{key:"mode",get:function(){return this._mode}},{key:"target",get:function(){return this._target}}]),e}();t.RoomSettings=u,t.SFSGameSettings=l,t.MMORoomSettings=c,t.RoomPermissions=function e(){a(this,e),this.allowNameChange=!1,this.allowPasswordStateChange=!1,this.allowPublicMessages=!0,this.allowResizing=!1,Object.seal(this)},t.RoomEvents=function e(){a(this,e),this.allowUserCountChange=!1,this.allowUserEnter=!1,this.allowUserExit=!1,this.allowUserVariablesUpdate=!1,Object.seal(this)},t.RoomExtension=function e(t,n){a(this,e),this.id=t,this.className=n,this.propertiesFile="",Object.seal(this)},t.MapLimits=function e(t,n){if(a(this,e),null==t||null==n)throw new i.SFSError("Map limits arguments must be both non null!");this.lowerLimit=t,this.higherLimit=n,Object.seal(this)},t.BanMode=f,t.MessageRecipientMode=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BuddyOnlineState=t.SFSBuddy=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(6);var o=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=t,this._name=n,this._isBlocked=r,this._isTemp=i,this._variables=new Map,Object.seal(this)}return r(e,[{key:"toString",value:function(){return"[Buddy: "+this.name+", Id: "+this.id+"]"}},{key:"getVariable",value:function(e){return this._variables.get(e)}},{key:"containsVariable",value:function(e){return this._variables.has(e)}},{key:"getVariables",value:function(){return Array.from(this._variables.values())}},{key:"getOfflineVariables",value:function(){return this.getVariables().filter(function(e){return e.name.charAt(0)===i.SFSBuddyVariable.OFFLINE_PREFIX})}},{key:"getOnlineVariables",value:function(){return this.getVariables().filter(function(e){return e.name.charAt(0)!==i.SFSBuddyVariable.OFFLINE_PREFIX})}},{key:"_setVariables",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;this._setVariable(s)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_setVariable",value:function(e){e.isNull?this._variables.delete(e.name):this._variables.set(e.name,e)}},{key:"_removeVariable",value:function(e){this._variables.delete(e)}},{key:"_clearVolatileVariables",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.getOnlineVariables()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this._removeVariable(o.name)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"isBlocked",get:function(){return this._isBlocked}},{key:"isTemp",get:function(){return this._isTemp}},{key:"isOnline",get:function(){var e=!0;return this.containsVariable(i.ReservedBuddyVariables.BV_ONLINE)&&(e=this.getVariable(i.ReservedBuddyVariables.BV_ONLINE).value),e&&this._id>-1}},{key:"state",get:function(){return this.containsVariable(i.ReservedBuddyVariables.BV_STATE)?this.getVariable(i.ReservedBuddyVariables.BV_STATE).value:null}},{key:"nickName",get:function(){return this.containsVariable(i.ReservedBuddyVariables.BV_NICKNAME)?this.getVariable(i.ReservedBuddyVariables.BV_NICKNAME).value:null}}],[{key:"fromSFSArray",value:function(t){var n=new e(t.get(0),t.get(1),t.get(2),t.size()>3&&t.get(4)),r=t.get(3);if(null!=r)for(var o=0;o<r.size();o++)n._setVariable(i.SFSBuddyVariable.fromSFSArray(r.get(o)));return n}}]),e}(),s=Object.freeze({ONLINE:0,OFFLINE:1,LEFT_THE_SERVER:2});t.SFSBuddy=o,t.BuddyOnlineState=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SFSUserVariable=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(8);var o=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return i.isPrivate=!1,Object.seal(i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseVariable),r(t,[{key:"toString",value:function(){return"[UserVar: "+this.name+", Type: "+this.type+", Value: "+this.value+", Private: "+this.isPrivate+"]"}},{key:"toSFSArray",value:function(){var e=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toSFSArray",this).call(this);return e.addBool(this.isPrivate),e}}],[{key:"fromSFSArray",value:function(e){var n=new t(e.get(0),e.get(2),e.get(1));return e.size()>3&&(n.isPrivate=e.get(3)),n}}]),t}();t.SFSUserVariable=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InviteUsersRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(7),a=n(13),u=n(2);var l=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.InviteUsers));return o._invitedUsers=e,o._secondsForAnswer=n,o._params=r,Object.seal(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_USER",get:function(){return"u"}},{key:"KEY_USER_ID",get:function(){return"ui"}},{key:"KEY_INVITATION_ID",get:function(){return"ii"}},{key:"KEY_TIME",get:function(){return"t"}},{key:"KEY_PARAMS",get:function(){return"p"}},{key:"KEY_INVITEE_ID",get:function(){return"ee"}},{key:"KEY_INVITED_USERS",get:function(){return"iu"}},{key:"KEY_REPLY_ID",get:function(){return"ri"}},{key:"MAX_INVITATIONS_FROM_CLIENT_SIDE",get:function(){return 8}},{key:"MIN_EXPIRY_TIME",get:function(){return 5}},{key:"MAX_EXPIRY_TIME",get:function(){return 300}}]),r(t,[{key:"validate",value:function(e){var n=[];if(null==this._invitedUsers?n.push("No invited users"):this._invitedUsers instanceof Array?(this._invitedUsers.length<1&&n.push("No invited users"),this._invitedUsers.length>t.MAX_INVITATIONS_FROM_CLIENT_SIDE&&n.push("Too many invitations; "+t.MAX_INVITATIONS_FROM_CLIENT_SIDE+" max are allowed from client side"),this._invitedUsers.every(function(e){return e instanceof s.SFSUser||e instanceof a.SFSBuddy})||n.push("Each invited user must be an instance of SFSUser or SFSBuddy class")):n.push("Invited users must be passed in an array"),(this._secondsForAnswer<t.MIN_EXPIRY_TIME||this._secondsForAnswer>t.MAX_EXPIRY_TIME)&&n.push("secondsForAnswer value is out of range (min: "+t.MIN_EXPIRY_TIME+"; max: "+t.MAX_EXPIRY_TIME+")"),null==this._params||this._params instanceof u.SFSObject||n.push("Custom invitation parameters must be set in a SFSObject class instance"),n.length>0)throw new o.SFSValidationError("InviteUsersRequest Error",n)}},{key:"execute",value:function(e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,l=this._invitedUsers[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=u.value;if(c instanceof s.SFSUser||c instanceof a.SFSBuddy){if(c===e.mySelf)continue;n.push(c.id)}}}catch(e){i=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}this._reqObj.putIntArray(t.KEY_INVITED_USERS,n),this._reqObj.putShort(t.KEY_TIME,this._secondsForAnswer),null!=this._params&&this._reqObj.putSFSObject(t.KEY_PARAMS,this._params)}}]),t}();t.InviteUsersRequest=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdminMessageRequest=t.ModeratorMessageRequest=t.ObjectMessageRequest=t.PrivateMessageRequest=t.PublicMessageRequest=t.GenericMessageRequest=t.GenericMessageType=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(12),a=n(2),u=n(3),l=n(7);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _=Object.freeze({PUBLIC_MSG:0,PRIVATE_MSG:1,MODERATOR_MSG:2,ADMING_MSG:3,OBJECT_MSG:4,BUDDY_MSG:5}),y=function(e){function t(){c(this,t);var e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.GenericMessage));return e._type=-1,e._room=null,e._user=null,e._message=null,e._params=null,e._recipient=null,e._sendMode=-1,Object.seal(e),e}return h(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM_ID",get:function(){return"r"}},{key:"KEY_USER_ID",get:function(){return"u"}},{key:"KEY_MESSAGE",get:function(){return"m"}},{key:"KEY_MESSAGE_TYPE",get:function(){return"t"}},{key:"KEY_RECIPIENT",get:function(){return"rc"}},{key:"KEY_RECIPIENT_MODE",get:function(){return"rm"}},{key:"KEY_XTRA_PARAMS",get:function(){return"p"}},{key:"KEY_SENDER_DATA",get:function(){return"sd"}}]),r(t,[{key:"validate",value:function(e){if(this._type<0)throw new o.SFSValidationError("GenericMessageRequest Error",["Unsupported message type: "+this._type]);var t=[];switch(this._type){case _.PUBLIC_MSG:this._validatePublicMessage(e,t);break;case _.PRIVATE_MSG:this._validatePrivateMessage(e,t);break;case _.OBJECT_MSG:this._validateObjectMessage(e,t);break;case _.BUDDY_MSG:this._validateBuddyMessage(e,t);break;default:this._validateSuperUserMessage(e,t)}if(t.length>0)throw new o.SFSValidationError("GenericMessageRequest Error",t)}},{key:"execute",value:function(e){switch(this._reqObj.putByte(t.KEY_MESSAGE_TYPE,this._type),this._type){case _.PUBLIC_MSG:this._executePublicMessage(e);break;case _.PRIVATE_MSG:this._executePrivateMessage(e);break;case _.OBJECT_MSG:this._executeObjectMessage(e);break;case _.BUDDY_MSG:this._executeBuddyMessage(e);break;default:this._executeSuperUserMessage(e)}}},{key:"_validatePublicMessage",value:function(e,t){null!=this._message&&0!==this._message.length||t.push("Public message is empty"),null==this._room&&(this._room=e.lastJoinedRoom),null==this._room?t.push("You must be joined in a Room to send a message"):this._room instanceof u.SFSRoom?e.getJoinedRooms().indexOf(this._room)<0&&t.push("You are not joined in the target Room: "+this._room):t.push("Target Room must be an instance of SFSRoom class"),null==this._params||this._params instanceof a.SFSObject||t.push("Message parameters must be set in a SFSObject class instance")}},{key:"_validatePrivateMessage",value:function(e,t){null!=this._message&&0!==this._message.length||t.push("Private message is empty"),this._recipient<0&&t.push("Invalid recipient id: "+this._recipient),null==this._params||this._params instanceof a.SFSObject||t.push("Message parameters must be set in a SFSObject class instance")}},{key:"_validateObjectMessage",value:function(e,t){null==this._params?t.push("Object message is null"):this._params instanceof a.SFSObject||t.push("Message object must be an instance of SFSObject class"),null==this._room&&(this._room=e.lastJoinedRoom),null==this._room?t.push("You must be joined in a Room to send a message"):this._room instanceof u.SFSRoom?e.getJoinedRooms().indexOf(this._room)<0&&t.push("You are not joined in the target Room: "+this._room):t.push("Target Room must be an instance of SFSRoom class"),null!=this._recipient&&(this._recipient instanceof Array?this._recipient.every(function(e){return e instanceof l.SFSUser})||t.push("Each message recipient must be an instance of SFSUser class"):t.push("Message recipients must be passed in an array"),this._recipient.length>this._room.capacity&&t.push("The number of recipients is bigger than the target Room capacity: "+this._recipient.length))}},{key:"_validateBuddyMessage",value:function(e,t){e.buddyManager.isInited||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),!1===e.buddyManager.myOnlineState&&t.push("Can't send messages while you are offline in the Buddy List system"),null!=this._message&&0!==this._message.length||t.push("Buddy message is empty"),this._recipient<0&&t.push("Recipient is offline or not in your Buddy List"),null==this._params||this._params instanceof a.SFSObject||t.push("Message parameters must be set in a SFSObject class instance")}},{key:"_validateSuperUserMessage",value:function(e,t){switch(null!=this._message&&0!==this._message.length||t.push("Moderator message is empty"),null==this._params||this._params instanceof a.SFSObject||t.push("Message parameters must be set in a SFSObject class instance"),this._sendMode){case s.MessageRecipientMode.TO_USER:this._recipient instanceof l.SFSUser||t.push("Recipient must be an instance of SFSUser class");break;case s.MessageRecipientMode.TO_ROOM:this._recipient instanceof u.SFSRoom||t.push("Recipient must be an instance of SFSRoom class");break;case s.MessageRecipientMode.TO_GROUP:"string"!=typeof this._recipient&&t.push("Recipient must be a string (the groupId)")}}},{key:"_executePublicMessage",value:function(e){this._reqObj.putInt(t.KEY_ROOM_ID,this._room.id),this._reqObj.putInt(t.KEY_USER_ID,e.mySelf.id),this._reqObj.putUtfString(t.KEY_MESSAGE,this._message),null!=this._params&&this._reqObj.putSFSObject(t.KEY_XTRA_PARAMS,this._params)}},{key:"_executePrivateMessage",value:function(e){this._reqObj.putInt(t.KEY_RECIPIENT,this._recipient),this._reqObj.putUtfString(t.KEY_MESSAGE,this._message),null!=this._params&&this._reqObj.putSFSObject(t.KEY_XTRA_PARAMS,this._params)}},{key:"_executeBuddyMessage",value:function(e){this._reqObj.putInt(t.KEY_RECIPIENT,this._recipient),this._reqObj.putUtfString(t.KEY_MESSAGE,this._message),null!=this._params&&this._reqObj.putSFSObject(t.KEY_XTRA_PARAMS,this._params)}},{key:"_executeSuperUserMessage",value:function(e){switch(this._reqObj.putUtfString(t.KEY_MESSAGE,this._message),null!=this._params&&this._reqObj.putSFSObject(t.KEY_XTRA_PARAMS,this._params),this._reqObj.putInt(t.KEY_RECIPIENT_MODE,this._sendMode),this._sendMode){case s.MessageRecipientMode.TO_USER:case s.MessageRecipientMode.TO_ROOM:this._reqObj.putInt(t.KEY_RECIPIENT,this._recipient.id);break;case s.MessageRecipientMode.TO_GROUP:this._reqObj.putUtfString(t.KEY_RECIPIENT,this._recipient)}}},{key:"_executeObjectMessage",value:function(e){this._reqObj.putInt(t.KEY_ROOM_ID,this._room.id),this._reqObj.putSFSObject(t.KEY_XTRA_PARAMS,this._params);var n=new Set;if(null!=this._recipient){var r=!0,i=!1,o=void 0;try{for(var s,a=this._recipient[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var u=s.value;n.add(u.id)}}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}}n.size>0&&this._reqObj.putIntArray(t.KEY_RECIPIENT,Array.from(n))}}]),t}(),d=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c(this,t);var i=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._type=_.OBJECT_MSG,i._params=e,i._room=n,i._recipient=r,Object.seal(i),i}return h(t,y),t}(),p=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c(this,t);var i=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._type=_.PUBLIC_MSG,i._message=e,i._room=r,i._params=n,Object.seal(i),i}return h(t,y),t}(),g=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c(this,t);var i=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._type=_.PRIVATE_MSG,i._message=e,i._recipient=n,i._params=r,Object.seal(i),i}return h(t,y),t}(),b=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c(this,t);var i=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(null==n)throw new o.SFSError("Recipient mode cannot be null");if(!(n instanceof s.MessageRecipientMode))throw new o.SFSError("Recipient mode must be an instance of MessageRecipientMode class");return i._type=_.MODERATOR_MSG,i._message=e,i._params=r,i._recipient=n.target,i._sendMode=n.mode,Object.seal(i),i}return h(t,y),t}(),v=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c(this,t);var i=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(null==n)throw new o.SFSError("Recipient mode cannot be null");if(!(n instanceof s.MessageRecipientMode))throw new o.SFSError("Recipient mode must an instance of MessageRecipientMode class");return i._type=_.ADMING_MSG,i._message=e,i._params=r,i._recipient=n.target,i._sendMode=n.mode,Object.seal(i),i}return h(t,y),t}();t.GenericMessageType=_,t.GenericMessageRequest=y,t.PublicMessageRequest=p,t.PrivateMessageRequest=g,t.ObjectMessageRequest=d,t.ModeratorMessageRequest=b,t.AdminMessageRequest=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateRoomRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(12),a=n(2),u=n(3),l=n(9);var c=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.CreateRoom));return o._settings=e,o._autoJoin=n,o._roomToLeave=r,Object.seal(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM",get:function(){return"r"}},{key:"KEY_NAME",get:function(){return"n"}},{key:"KEY_PASSWORD",get:function(){return"p"}},{key:"KEY_GROUP_ID",get:function(){return"g"}},{key:"KEY_ISGAME",get:function(){return"ig"}},{key:"KEY_MAXUSERS",get:function(){return"mu"}},{key:"KEY_MAXSPECTATORS",get:function(){return"ms"}},{key:"KEY_MAXVARS",get:function(){return"mv"}},{key:"KEY_ROOMVARS",get:function(){return"rv"}},{key:"KEY_PERMISSIONS",get:function(){return"pm"}},{key:"KEY_EVENTS",get:function(){return"ev"}},{key:"KEY_EXTID",get:function(){return"xn"}},{key:"KEY_EXTCLASS",get:function(){return"xc"}},{key:"KEY_EXTPROP",get:function(){return"xp"}},{key:"KEY_AUTOJOIN",get:function(){return"aj"}},{key:"KEY_ROOM_TO_LEAVE",get:function(){return"rl"}},{key:"KEY_ALLOW_JOIN_INVITATION_BY_OWNER",get:function(){return"aji"}},{key:"KEY_MMO_DEFAULT_AOI",get:function(){return"maoi"}},{key:"KEY_MMO_MAP_LOW_LIMIT",get:function(){return"mllm"}},{key:"KEY_MMO_MAP_HIGH_LIMIT",get:function(){return"mlhm"}},{key:"KEY_MMO_USER_MAX_LIMBO_SECONDS",get:function(){return"muls"}},{key:"KEY_MMO_PROXIMITY_UPDATE_MILLIS",get:function(){return"mpum"}},{key:"KEY_MMO_SEND_ENTRY_POINT",get:function(){return"msep"}}]),r(t,[{key:"validate",value:function(e){if(!(this._settings instanceof s.RoomSettings))throw new o.SFSValidationError("CreateRoomRequest Error",["Room configuration must be an instance of RoomSettings class"]);var t=[];if(null!=this._settings.name&&0!==this._settings.name.length||t.push("Missing Room name"),this._settings.maxUsers<=0&&t.push("Max number of users must be > 0"),this._settings.maxSpectators<0&&t.push("Max number of spectators must be >= 0"),this._settings.maxVariables<0&&t.push("Max number of Room Variables must be >= 0"),null!=this._settings.variables&&(this._settings.variables instanceof Array?this._settings.variables.every(function(e){return e instanceof l.SFSRoomVariable})||t.push("Each Room Variable must be an instance of SFSRoomVariable class"):t.push("Room Variables must be passed in an array")),null==this._settings.permissions||this._settings.permissions instanceof s.RoomPermissions||t.push("Allowed room permissions must be an instance of RoomPermissions class"),null==this._settings.events||this._settings.events instanceof s.RoomEvents||t.push("Allowed room events must be an instance of RoomEvents class"),null!=this._settings.extension&&(this._settings.extension instanceof s.RoomExtension?(null!=this._settings.extension.className&&0!==this._settings.extension.className.length||t.push("Missing Room Extension class name"),null!=this._settings.extension.id&&0!==this._settings.extension.id.length||t.push("Missing Room Extension id")):t.push("Room Extension settings must be an instance of RoomExtension class")),this._settings instanceof s.MMORoomSettings&&(null==this._settings.defaultAOI&&t.push("Missing MMORoom's default AoI (Area of Interest)"),this._settings.defaultAOI instanceof a.Vec3D||t.push("MMORoom's AoI (Area of Interest) must be an instance of Vec3D class"),null!=this._settings.mapLimits&&(this._settings.mapLimits instanceof s.MapLimits?(null!=this._settings.mapLimits.lowerLimit&&null!=this._settings.mapLimits.higherLimit||t.push("MMORoom's lower and higher map limits must be both set"),this._settings.mapLimits.lowerLimit instanceof a.Vec3D&&this._settings.mapLimits.higherLimit instanceof a.Vec3D||t.push("MMORoom's lower and higher map limits must be both instances of Vec3D class")):t.push("MMORoom's map limits must be set in an instance of MapLimits class"))),null==this._roomToLeave||this._roomToLeave instanceof u.SFSRoom||t.push("Room to leave must be an instance of SFSRoom class"),t.length>0)throw new o.SFSValidationError("CreateRoomRequest Error",t)}},{key:"execute",value:function(e){if(this._reqObj.putUtfString(t.KEY_NAME,this._settings.name),this._reqObj.putUtfString(t.KEY_GROUP_ID,this._settings.groupId),this._reqObj.putUtfString(t.KEY_PASSWORD,this._settings.password),this._reqObj.putBool(t.KEY_ISGAME,this._settings.isGame),this._reqObj.putShort(t.KEY_MAXUSERS,this._settings.maxUsers),this._reqObj.putShort(t.KEY_MAXSPECTATORS,this._settings.maxSpectators),this._reqObj.putShort(t.KEY_MAXVARS,this._settings.maxVariables),this._reqObj.putBool(t.KEY_ALLOW_JOIN_INVITATION_BY_OWNER,this._settings.allowOwnerOnlyInvitation),null!=this._settings.variables&&this._settings.variables.length>0){var n=new a.SFSArray,r=!0,i=!1,o=void 0;try{for(var u,l=this._settings.variables[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=u.value;n.addSFSArray(c.toSFSArray())}}catch(e){i=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}this._reqObj.putSFSArray(t.KEY_ROOMVARS,n)}if(null!=this._settings.permissions){var f=[];f.push(this._settings.permissions.allowNameChange),f.push(this._settings.permissions.allowPasswordStateChange),f.push(this._settings.permissions.allowPublicMessages),f.push(this._settings.permissions.allowResizing),this._reqObj.putBoolArray(t.KEY_PERMISSIONS,f)}if(null!=this._settings.events){var h=[];h.push(this._settings.events.allowUserEnter),h.push(this._settings.events.allowUserExit),h.push(this._settings.events.allowUserCountChange),h.push(this._settings.events.allowUserVariablesUpdate),this._reqObj.putBoolArray(t.KEY_EVENTS,h)}null!=this._settings.extension&&(this._reqObj.putUtfString(t.KEY_EXTID,this._settings.extension.id),this._reqObj.putUtfString(t.KEY_EXTCLASS,this._settings.extension.className),null!=this._settings.extension.propertiesFile&&this._settings.extension.propertiesFile.length>0&&this._reqObj.putUtfString(t.KEY_EXTPROP,this._settings.extension.propertiesFile)),this._settings instanceof s.MMORoomSettings&&(this._settings.defaultAOI.isFloat?(this._reqObj.putFloatArray(t.KEY_MMO_DEFAULT_AOI,this._settings.defaultAOI.toArray()),null!=this._settings.mapLimits&&(this._reqObj.putFloatArray(t.KEY_MMO_MAP_LOW_LIMIT,this._settings.mapLimits.lowerLimit.toArray()),this._reqObj.putFloatArray(t.KEY_MMO_MAP_HIGH_LIMIT,this._settings.mapLimits.higherLimit.toArray()))):(this._reqObj.putIntArray(t.KEY_MMO_DEFAULT_AOI,this._settings.defaultAOI.toArray()),null!=this._settings.mapLimits&&(this._reqObj.putIntArray(t.KEY_MMO_MAP_LOW_LIMIT,this._settings.mapLimits.lowerLimit.toArray()),this._reqObj.putIntArray(t.KEY_MMO_MAP_HIGH_LIMIT,this._settings.mapLimits.higherLimit.toArray()))),this._reqObj.putShort(t.KEY_MMO_USER_MAX_LIMBO_SECONDS,this._settings.userMaxLimboSeconds),this._reqObj.putShort(t.KEY_MMO_PROXIMITY_UPDATE_MILLIS,this._settings.proximityListUpdateMillis),this._reqObj.putBool(t.KEY_MMO_SEND_ENTRY_POINT,this._settings.sendAOIEntryPoint)),this._reqObj.putBool(t.KEY_AUTOJOIN,this._autoJoin),null!=this._roomToLeave&&this._reqObj.putInt(t.KEY_ROOM_TO_LEAVE,this._roomToLeave.id)}}]),t}();t.CreateRoomRequest=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=-1,this._inviter=t,this._invitee=n,this._secondsForAnswer=r,this._params=i,Object.seal(this)}return r(e,[{key:"id",get:function(){return this._id}},{key:"inviter",get:function(){return this._inviter}},{key:"invitee",get:function(){return this._invitee}},{key:"secondsForAnswer",get:function(){return this._secondsForAnswer}},{key:"params",get:function(){return this._params}}]),e}(),o=Object.freeze({ACCEPT:0,REFUSE:1,EXPIRED:255});t.SFSInvitation=i,t.InvitationReply=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMOItemVariable=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(8);var o=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return Object.freeze(i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseVariable),r(t,[{key:"toString",value:function(){return"[ItemVar: "+this.name+", Type: "+this.type+", Value: "+this.value+"]"}}],[{key:"fromSFSArray",value:function(e){return new t(e.get(0),e.get(2),e.get(1))}}]),t}();t.MMOItemVariable=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){throw function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"Class SFSErrorCodes cannot be instantiated. Please check the documentation for more details on its usage"}return r(e,null,[{key:"setErrorMessage",value:function(e,t){this._errorsByCode[e]=t}},{key:"getErrorMessage",value:function(e,t){return this.stringFormat(this._errorsByCode[e],t)}},{key:"stringFormat",value:function(e,t){if(null==e)return"";if(null!=t)for(var n=0;n<t.length;n++){var r="{"+n+"}";e=e.replace(r,t[n])}return e}},{key:"_errorsByCode",get:function(){return o}}]),e}();t.SFSErrorCodes=i;var o=["Client API version is obsolete: {0}; required version: {1}","Requested Zone {0} does not exist","User name {0} is not recognized","Wrong password for user {0}","User {0} is banned","Zone {0} is full","User {0} is already logged in Zone {1}","The server is full","Zone {0} is currently inactive","User name {0} contains bad words; filtered: {1}","Guest users not allowed in Zone {0}","IP address {0} is banned","A Room with the same name already exists: {0}","Requested Group is not available - Room: {0}; Group: {1}","Bad Room name length -  Min: {0}; max: {1}; passed name length: {2}","Room name contains bad words: {0}","Zone is full; can't add Rooms anymore","You have exceeded the number of Rooms that you can create per session: {0}","Room creation failed, wrong parameter: {0}","User {0} already joined in Room","Room {0} is full","Wrong password for Room {0}","Requested Room does not exist","Room {0} is locked","Group {0} is already subscribed","Group {0} does not exist","Group {0} is not subscribed","Group {0} does not exist","{0}","Room permission error; Room {0} cannot be renamed","Room permission error; Room {0} cannot change password state","Room permission error; Room {0} cannot change capacity","Switch user error; no player slots available in Room {0}","Switch user error; no spectator slots available in Room {0}","Switch user error; Room {0} is not a Game Room","Switch user error; you are not joined in Room {0}","Buddy Manager initialization error, could not load buddy list: {0}","Buddy Manager error, your buddy list is full; size is {0}","Buddy Manager error, was not able to block buddy {0} because offline","Buddy Manager error, you are attempting to set too many Buddy Variables; limit is {0}","Game {0} access denied, user does not match access criteria","QuickJoinGame action failed: no matching Rooms were found","Your previous invitation reply was invalid or arrived too late"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(2),a=n(3);var u=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.CallExtension));return o._targetController=1,o._extCmd=e,o._params=n,o._room=r,null==o._params&&(o._params=new s.SFSObject),Object.seal(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_CMD",get:function(){return"c"}},{key:"KEY_PARAMS",get:function(){return"p"}},{key:"KEY_ROOM",get:function(){return"r"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null!=this._extCmd&&0!==this._extCmd.length||t.push("Missing extension command"),null==this._params||this._params instanceof s.SFSObject||t.push("Custom parameters must be set in a SFSObject class instance"),null==this._room||this._room instanceof a.SFSRoom||t.push("Room must be an instance of SFSRoom class"),t.length>0)throw new o.SFSValidationError("ExtensionRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putUtfString(t.KEY_CMD,this._extCmd),this._reqObj.putInt(t.KEY_ROOM,null==this._room?-1:this._room.id),this._reqObj.putSFSObject(t.KEY_PARAMS,this._params)}}]),t}();t.ExtensionRequest=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetBuddyVariablesRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(2),a=n(6);var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.SetBuddyVariables));return n._buddyVariables=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_BUDDY_NAME",get:function(){return"bn"}},{key:"KEY_BUDDY_VARS",get:function(){return"bv"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(e.buddyManager.isInited||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),!1===e.buddyManager.getMyOnlineState()&&t.push("Can't set Buddy Variables while you are offline in the Buddy List system"),null==this._buddyVariables?t.push("No Buddy Variables specified"):this._buddyVariables instanceof Array?0===this._buddyVariables.length?t.push("No Buddy Variables specified"):this._buddyVariables.every(function(e){return e instanceof a.SFSBuddyVariable})||t.push("Buddy Variables must be passed as instances of SFSBuddyVariable class"):t.push("Buddy Variables must be passed in an array"),t.length>0)throw new o.SFSValidationError("SetBuddyVariablesRequest Error",t)}},{key:"execute",value:function(e){var n=new s.SFSArray,r=!0,i=!1,o=void 0;try{for(var a,u=this._buddyVariables[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var l=a.value;n.addSFSArray(l.toSFSArray())}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}this._reqObj.putSFSArray(t.KEY_BUDDY_VARS,n)}}]),t}();t.SetBuddyVariablesRequest=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoOnlineRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.GoOnline));return n._online=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ONLINE",get:function(){return"o"}},{key:"KEY_BUDDY_NAME",get:function(){return"bn"}},{key:"KEY_BUDDY_ID",get:function(){return"bi"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(e.buddyManager.isInited||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),t.length>0)throw new o.SFSValidationError("GoOnlineRequest Error",t)}},{key:"execute",value:function(e){e.buddyManager._setMyOnlineState(this._online),this._reqObj.putBool(t.KEY_ONLINE,this._online)}}]),t}();t.GoOnlineRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockBuddyRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.BlockBuddy));return r._name=e,r._blocked=n,Object.seal(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_BUDDY_NAME",get:function(){return"bn"}},{key:"KEY_BUDDY_BLOCK_STATE",get:function(){return"bs"}},{key:"KEY_BUDDY",get:function(){return"bd"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(e.buddyManager.isInited||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),!1===e.buddyManager.getMyOnlineState()&&t.push("Can't block a buddy while you are offline in the Buddy List system"),null==this._name||this._name.length<1)t.push("Invalid buddy name (null or empty string)");else{var n=e.buddyManager.getBuddyByName(this._name);null==n?t.push("Can't block buddy '"+this._name+"' because it isn't in your list"):n.isBlocked==this._blocked&&t.push("Block flag is already in the requested '"+this._blocked+"' state for buddy '"+this._name+"'")}if(t.length>0)throw new o.SFSValidationError("BlockBuddyRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putUtfString(t.KEY_BUDDY_NAME,this._name),this._reqObj.putBool(t.KEY_BUDDY_BLOCK_STATE,this._blocked)}}]),t}();t.BlockBuddyRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveBuddyRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.RemoveBuddy));return n._name=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_BUDDY_NAME",get:function(){return"bn"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(e.buddyManager.isInited||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),!1===e.buddyManager.getMyOnlineState()&&t.push("Can't remove a buddy while you are offline in the Buddy List system"),null==this._name||this._name.length<1?t.push("Invalid buddy name (null or empty string)"):e.buddyManager.containsBuddy(this._name)||t.push("Can't remove buddy '"+this._name+"' because it isn't in your list"),t.length>0)throw new o.SFSValidationError("RemoveBuddyRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putUtfString(t.KEY_BUDDY_NAME,this._name)}}]),t}();t.RemoveBuddyRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddBuddyRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.AddBuddy));return n._name=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_BUDDY_NAME",get:function(){return"bn"}}]),r(t,[{key:"validate",value:function(e){var t=[];e.buddyManager.isInited||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),(null==this._name||this._name.length<1)&&t.push("Invalid buddy name (null or empty string)"),!1===e.buddyManager.getMyOnlineState()&&t.push("Can't add a buddy while you are offline in the Buddy List system");var n=e.buddyManager.getBuddyByName(this._name);if(null==n||n.isTemp||t.push("Can't add buddy '"+this._name+"' because it is already in your list"),t.length>0)throw new o.SFSValidationError("AddBuddyRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putUtfString(t.KEY_BUDDY_NAME,this._name)}}]),t}();t.AddBuddyRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InitBuddyListRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.InitBuddyList));return Object.seal(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_BLIST",get:function(){return"bl"}},{key:"KEY_BUDDY_STATES",get:function(){return"bs"}},{key:"KEY_MY_VARS",get:function(){return"mv"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(e.buddyManager.isInited&&t.push("Buddy List is already initialized"),t.length>0)throw new o.SFSValidationError("InitBuddyListRequest Error",t)}},{key:"execute",value:function(e){}}]),t}();t.InitBuddyListRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetUserPositionRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(2),a=n(3);var u=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.SetUserPosition));return r._pos=e,r._room=n,Object.seal(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM",get:function(){return"r"}},{key:"KEY_VEC3D",get:function(){return"v"}},{key:"KEY_PLUS_USER_LIST",get:function(){return"p"}},{key:"KEY_MINUS_USER_LIST",get:function(){return"m"}},{key:"KEY_PLUS_ITEM_LIST",get:function(){return"q"}},{key:"KEY_MINUS_ITEM_LIST",get:function(){return"n"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null!=this._pos&&this._pos instanceof s.Vec3D||t.push("Position must be an instance of Vec3D class"),null==this._room&&(this._room=e.lastJoinedRoom),null==this._room&&t.push("You are not joined in any room"),this._room instanceof a.MMORoom||t.push("Target room must be an instance of MMORoom class"),t.length>0)throw new o.SFSValidationError("SetUserPosition Error",t)}},{key:"execute",value:function(e){this._reqObj.putInt(t.KEY_ROOM,this._room.id),this._pos.isFloat?this._reqObj.putFloatArray(t.KEY_VEC3D,this._pos.toArray()):this._reqObj.putIntArray(t.KEY_VEC3D,this._pos.toArray())}}]),t}();t.SetUserPositionRequest=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FindUsersRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3),a=n(5);var u=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.FindUsers));return o._matchExpr=e,o._target=n,o._limit=r,Object.seal(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_EXPRESSION",get:function(){return"e"}},{key:"KEY_GROUP",get:function(){return"g"}},{key:"KEY_ROOM",get:function(){return"r"}},{key:"KEY_LIMIT",get:function(){return"l"}},{key:"KEY_FILTERED_USERS",get:function(){return"fu"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null==this._matchExpr&&t.push("Missing match expression"),null==this._matchExpr||this._matchExpr instanceof a.MatchExpression||t.push("Match expression must be passed as an instance of MatchExpression class"),t.length>0)throw new o.SFSValidationError("FindUsersRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putSFSArray(t.KEY_EXPRESSION,this._matchExpr.toSFSArray()),null!=this._target&&(this._target instanceof s.SFSRoom?this._reqObj.putInt(t.KEY_ROOM,this._target.id):"string"==typeof this._target?this._reqObj.putUtfString(t.KEY_GROUP,this._target):this._logger.warn("Unsupported target type for FindUsersRequest: "+this._target)),this._limit>0&&this._reqObj.putShort(t.KEY_LIMIT,this._limit)}}]),t}();t.FindUsersRequest=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FindRoomsRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(5);var a=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.FindRooms));return o._matchExpr=e,o._groupId=n,o._limit=r,Object.seal(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_EXPRESSION",get:function(){return"e"}},{key:"KEY_GROUP",get:function(){return"g"}},{key:"KEY_LIMIT",get:function(){return"l"}},{key:"KEY_FILTERED_ROOMS",get:function(){return"fr"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null==this._matchExpr&&t.push("Missing match expression"),null==this._matchExpr||this._matchExpr instanceof s.MatchExpression||t.push("Match expression must be passed as an instance of MatchExpression class"),t.length>0)throw new o.SFSValidationError("FindRoomsRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putSFSArray(t.KEY_EXPRESSION,this._matchExpr.toSFSArray()),null!=this._groupId&&this._reqObj.putUtfString(t.KEY_GROUP,this._groupId),this._limit>0&&this._reqObj.putShort(t.KEY_LIMIT,this._limit)}}]),t}();t.FindRoomsRequest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerToSpectatorRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3);var a=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.PlayerToSpectator));return n._room=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM_ID",get:function(){return"r"}},{key:"KEY_USER_ID",get:function(){return"u"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(e.getJoinedRooms().length<1&&t.push("You are not joined in any Room"),null==this._room||this._room instanceof s.SFSRoom||t.push("Target Room must be an instance of SFSRoom class"),t.length>0)throw new o.SFSValidationError("PlayerToSpectatorRequest Error",t)}},{key:"execute",value:function(e){null==this._room&&(this._room=e.lastJoinedRoom),this._reqObj.putInt(t.KEY_ROOM_ID,this._room.id)}}]),t}();t.PlayerToSpectatorRequest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpectatorToPlayerRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3);var a=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.SpectatorToPlayer));return n._room=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM_ID",get:function(){return"r"}},{key:"KEY_USER_ID",get:function(){return"u"}},{key:"KEY_PLAYER_ID",get:function(){return"p"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(e.getJoinedRooms().length<1&&t.push("You are not joined in any Room"),null==this._room||this._room instanceof s.SFSRoom||t.push("Target Room must be an instance of SFSRoom class"),t.length>0)throw new o.SFSValidationError("SpectatorToPlayerRequest Error",t)}},{key:"execute",value:function(e){null==this._room&&(this._room=e.lastJoinedRoom),this._reqObj.putInt(t.KEY_ROOM_ID,this._room.id)}}]),t}();t.SpectatorToPlayerRequest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnsubscribeRoomGroupRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.UnsubscribeRoomGroup));return n._groupId=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_GROUP_ID",get:function(){return"g"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null!=this._groupId&&0!==this._groupId.length||t.push("Invalid group id passed; must be a string with at least one character"),t.length>0)throw new o.SFSValidationError("UnsubscribeGroupRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putUtfString(t.KEY_GROUP_ID,this._groupId)}}]),t}();t.UnsubscribeRoomGroupRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubscribeRoomGroupRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.SubscribeRoomGroup));return n._groupId=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_GROUP_ID",get:function(){return"g"}},{key:"KEY_ROOM_LIST",get:function(){return"rl"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null!=this._groupId&&0!==this._groupId.length||t.push("Invalid group id passed; must be a string with at least one character"),t.length>0)throw new o.SFSValidationError("SubscribeGroupRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putUtfString(t.KEY_GROUP_ID,this._groupId)}}]),t}();t.SubscribeRoomGroupRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetUserVariablesRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(2),a=n(14);var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.SetUserVariables));return n._userVariables=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_USER",get:function(){return"u"}},{key:"KEY_VAR_LIST",get:function(){return"vl"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null==this._userVariables?t.push("No User Variables specified"):this._userVariables instanceof Array?0===this._userVariables.length?t.push("No User Variables specified"):this._userVariables.every(function(e){return e instanceof a.SFSUserVariable})||t.push("User Variables must be passed as instances of SFSUserVariable class"):t.push("User Variables must be passed in an array"),t.length>0)throw new o.SFSValidationError("SetUserVariablesRequest Error",t)}},{key:"execute",value:function(e){var n=new s.SFSArray,r=!0,i=!1,o=void 0;try{for(var a,u=this._userVariables[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var l=a.value;n.addSFSArray(l.toSFSArray())}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}this._reqObj.putSFSArray(t.KEY_VAR_LIST,n)}}]),t}();t.SetUserVariablesRequest=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetRoomVariablesRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(2),a=n(3),u=n(9);var l=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.SetRoomVariables));return r._roomVariables=e,r._room=n,Object.seal(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_VAR_ROOM",get:function(){return"r"}},{key:"KEY_VAR_LIST",get:function(){return"vl"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null==this._room&&(this._room=e.lastJoinedRoom),null==this._room?t.push("You must be joined in a Room to send a message"):this._room instanceof a.SFSRoom?e.getJoinedRooms().indexOf(this._room)<0&&t.push("You are not joined in the target Room: "+this._room):t.push("Target Room must be an instance of SFSRoom class"),null==this._roomVariables?t.push("No Room Variables specified"):this._roomVariables instanceof Array?0===this._roomVariables.length?t.push("No Room Variables specified"):this._roomVariables.every(function(e){return e instanceof u.SFSRoomVariable})||t.push("Room Variables must be passed as instances of SFSRoomVariable class"):t.push("Room Variables must be passed in an array"),t.length>0)throw new o.SFSValidationError("SetRoomVariablesRequest Error",t)}},{key:"execute",value:function(e){var n=new s.SFSArray,r=!0,i=!1,o=void 0;try{for(var a,u=this._roomVariables[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var l=a.value;n.addSFSArray(l.toSFSArray())}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}this._reqObj.putSFSArray(t.KEY_VAR_LIST,n),this._reqObj.putInt(t.KEY_VAR_ROOM,this._room.id)}}]),t}();t.SetRoomVariablesRequest=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeRoomCapacityRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3);var a=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.ChangeRoomCapacity));return o._room=e,o._newMaxUsers=n,o._newMaxSpect=r,Object.seal(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM",get:function(){return"r"}},{key:"KEY_USER_SIZE",get:function(){return"u"}},{key:"KEY_SPEC_SIZE",get:function(){return"s"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(this._room instanceof s.SFSRoom||t.push("Room must be an instance of SFSRoom class"),t.length>0)throw new o.SFSValidationError("ChangeRoomCapacityRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putInt(t.KEY_ROOM,this._room.id),this._reqObj.putInt(t.KEY_USER_SIZE,this._newMaxUsers),this._reqObj.putInt(t.KEY_SPEC_SIZE,this._newMaxSpect)}}]),t}();t.ChangeRoomCapacityRequest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeRoomPasswordStateRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3);var a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.ChangeRoomPassword));return r._room=e,r._newPass=n,Object.seal(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM",get:function(){return"r"}},{key:"KEY_PASS",get:function(){return"p"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(this._room instanceof s.SFSRoom||t.push("Room must be an instance of SFSRoom class"),null==this._newPass&&t.push("New room password must be a non-null string (empty string to remove the password)"),t.length>0)throw new o.SFSValidationError("ChangeRoomPasswordStateRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putInt(t.KEY_ROOM,this._room.id),this._reqObj.putUtfString(t.KEY_PASS,this._newPass)}}]),t}();t.ChangeRoomPasswordStateRequest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeRoomNameRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3);var a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.ChangeRoomName));return r._room=e,r._newName=n,Object.seal(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM",get:function(){return"r"}},{key:"KEY_NAME",get:function(){return"n"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(this._room instanceof s.SFSRoom||t.push("Room must be an instance of SFSRoom class"),null!=this._newName&&0!==this._newName.length||t.push("New room name must be a non-null and non-empty string"),t.length>0)throw new o.SFSValidationError("ChangeRoomNameRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putInt(t.KEY_ROOM,this._room.id),this._reqObj.putUtfString(t.KEY_NAME,this._newName)}}]),t}();t.ChangeRoomNameRequest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JoinRoomRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3);var a=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.JoinRoom));return"string"==typeof e?a._rName=e:"number"==typeof e?a._rId=e:e instanceof s.SFSRoom&&(a._rId=e.id,a._rName=e.name),a._password=n,a._roomIdToLeave=r,a._asSpectator=o,Object.seal(a),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM",get:function(){return"r"}},{key:"KEY_USER_LIST",get:function(){return"ul"}},{key:"KEY_ROOM_NAME",get:function(){return"n"}},{key:"KEY_ROOM_ID",get:function(){return"i"}},{key:"KEY_PASS",get:function(){return"p"}},{key:"KEY_ROOM_TO_LEAVE",get:function(){return"rl"}},{key:"KEY_AS_SPECTATOR",get:function(){return"sp"}}]),r(t,[{key:"validate",value:function(e){if(null==this._rId&&null==this._rName)throw new o.SFSValidationError("JoinRoomRequest Error",["Missing Room id or name, please provide one of the two or an existing SFSRoom object"])}},{key:"execute",value:function(e){e._isJoining=!0,this._rId>=0?this._reqObj.putInt(t.KEY_ROOM_ID,this._rId):null!=this._rName&&this._reqObj.putUtfString(t.KEY_ROOM_NAME,this._rName),null!=this._password&&this._reqObj.putUtfString(t.KEY_PASS,this._password),null!=this._roomIdToLeave&&this._reqObj.putInt(t.KEY_ROOM_TO_LEAVE,this._roomIdToLeave),this._asSpectator&&this._reqObj.putBool(t.KEY_AS_SPECTATOR,this._asSpectator)}}]),t}();t.JoinRoomRequest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogoutRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.Logout));return Object.seal(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ZONE_NAME",get:function(){return"zn"}}]),r(t,[{key:"validate",value:function(e){if(null==e.mySelf)throw new o.SFSValidationError("LogoutRequest error",["You are not logged in"])}},{key:"execute",value:function(e){}}]),t}();t.LogoutRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(65),o=n(1),s=n(0),a=n(2);var u=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o.Requests.Login));return s._userName=e,s._password=n,s._params=r,s._zoneName=i,Object.seal(s),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.BaseRequest),r(t,null,[{key:"KEY_ZONE_NAME",get:function(){return"zn"}},{key:"KEY_USER_NAME",get:function(){return"un"}},{key:"KEY_PASSWORD",get:function(){return"pw"}},{key:"KEY_PARAMS",get:function(){return"p"}},{key:"KEY_PRIVILEGE_ID",get:function(){return"pi"}},{key:"KEY_ID",get:function(){return"id"}},{key:"KEY_ROOMLIST",get:function(){return"rl"}},{key:"KEY_RECONNECTION_SECONDS",get:function(){return"rs"}}]),r(t,[{key:"validate",value:function(e){if(null!=e.mySelf)throw new s.SFSValidationError("LoginRequest error",["You are already logged in; logout before attempting a new login"]);var t=[],n=null!=e.config&&null!=e.config.zone?e.config.zone:null;if(null!=this._zoneName&&(n=this._zoneName),null==n||0===n.length?t.push("Missing Zone name"):this._zoneName=n,null==this._params||this._params instanceof a.SFSObject||t.push("Custom parameters must be passed in a SFSObject"),t.length>0)throw new s.SFSValidationError("LoginRequest Error",t)}},{key:"execute",value:function(e){null==this._userName&&(this._userName=""),null==this._password&&(this._password=""),this._reqObj.putUtfString(t.KEY_ZONE_NAME,this._zoneName),this._reqObj.putUtfString(t.KEY_USER_NAME,this._userName),this._reqObj.putUtfString(t.KEY_PASSWORD,this._password.length>0?(new i.MD5).hex_md5(e.sessionToken+this._password):""),null!=this._params&&this._reqObj.putSFSObject(t.KEY_PARAMS,this._params)}}]),t}();t.LoginRequest=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t){i(this,e),this._sfs=t,this._usersById=new Map,this._usersByName=new Map}return r(e,[{key:"containsUserName",value:function(e){return this._usersByName.has(e)}},{key:"containsUserId",value:function(e){return this._usersById.has(e)}},{key:"containsUser",value:function(e){return this._usersById.has(e.id)}},{key:"getUserById",value:function(e){return this._usersById.get(e)}},{key:"getUserByName",value:function(e){return this._usersByName.get(e)}},{key:"getUserCount",value:function(){return this._usersById.size}},{key:"getUserList",value:function(){return Array.from(this._usersById.values())}},{key:"_addUser",value:function(e){this._usersById.has(e.id)&&this._sfs.debug&&this._sfs.logger.warn("Unexpected, duplicate user in UserManager: "+e.toString()),this.__addUser(e)}},{key:"__addUser",value:function(e){this._usersByName.set(e.name,e),this._usersById.set(e.id,e)}},{key:"_removeUser",value:function(e){this._usersById.delete(e.id),this._usersByName.delete(e.name)}},{key:"_clearAll",value:function(){this._usersById.clear(),this._usersByName.clear()}}]),e}(),s=function(e){function t(e){i(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._roomRefCount=new Map,Object.freeze(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"_addUser",value:function(e){this._roomRefCount.has(e)?this._roomRefCount.set(e,this._roomRefCount.get(e)+1):this._roomRefCount.set(e,1),this.__addUser(e)}},{key:"_removeUser",value:function(e){this._removeUserReference(e,!1)}},{key:"_removeUserReference",value:function(e,n){var r=this._roomRefCount.get(e);r<1?this._sfs.logger.warn("GlobalUserManager RefCount is already at zero. User: "+e):(this._roomRefCount.set(e,this._roomRefCount.get(e)-1),(0===r||n)&&(function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_removeUser",this).call(this,e),this._roomRefCount.delete(e)))}}]),t}();t.SFSUserManager=o,t.GlobalUserManager=s},function(e,t,n){(function(e){var n;DataStream=function(e,t,n){this._byteOffset=t||0,e instanceof ArrayBuffer?this.buffer=e:"object"==typeof e?(this.dataView=e,t&&(this._byteOffset+=t)):this.buffer=new ArrayBuffer(e||1),this.position=0,this.endianness=null==n?DataStream.LITTLE_ENDIAN:n},DataStream.prototype={},void 0===Uint8Array.prototype.BYTES_PER_ELEMENT&&(Uint8Array.prototype.BYTES_PER_ELEMENT=Uint8Array.BYTES_PER_ELEMENT,Int8Array.prototype.BYTES_PER_ELEMENT=Int8Array.BYTES_PER_ELEMENT,Uint8ClampedArray.prototype.BYTES_PER_ELEMENT=Uint8ClampedArray.BYTES_PER_ELEMENT,Uint16Array.prototype.BYTES_PER_ELEMENT=Uint16Array.BYTES_PER_ELEMENT,Int16Array.prototype.BYTES_PER_ELEMENT=Int16Array.BYTES_PER_ELEMENT,Uint32Array.prototype.BYTES_PER_ELEMENT=Uint32Array.BYTES_PER_ELEMENT,Int32Array.prototype.BYTES_PER_ELEMENT=Int32Array.BYTES_PER_ELEMENT,Float64Array.prototype.BYTES_PER_ELEMENT=Float64Array.BYTES_PER_ELEMENT),DataStream.prototype.save=function(e){var t=new Blob(this.buffer),n=window.webkitURL||window.URL;if(!n||!n.createObjectURL)throw"DataStream.save: Can't create object URL.";var r=n.createObjectURL(t),i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download",e),i.click(),n.revokeObjectURL(r)},DataStream.BIG_ENDIAN=!1,DataStream.LITTLE_ENDIAN=!0,DataStream.prototype._dynamicSize=!0,Object.defineProperty(DataStream.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(e){e||this._trimAlloc(),this._dynamicSize=e}}),DataStream.prototype._byteLength=0,Object.defineProperty(DataStream.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(DataStream.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(e){this._buffer=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(DataStream.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(e){this._byteOffset=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(DataStream.prototype,"dataView",{get:function(){return this._dataView},set:function(e){this._byteOffset=e.byteOffset,this._buffer=e.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+e.byteLength}}),DataStream.prototype._realloc=function(e){if(this._dynamicSize){var t=this._byteOffset+this.position+e,n=this._buffer.byteLength;if(t<=n)t>this._byteLength&&(this._byteLength=t);else{for(n<1&&(n=1);t>n;)n*=2;var r=new ArrayBuffer(n),i=new Uint8Array(this._buffer);new Uint8Array(r,0,i.length).set(i),this.buffer=r,this._byteLength=t}}},DataStream.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var e=new ArrayBuffer(this._byteLength),t=new Uint8Array(e),n=new Uint8Array(this._buffer,0,t.length);t.set(n),this.buffer=e}},DataStream.prototype.seek=function(e){var t=Math.max(0,Math.min(this.byteLength,e));this.position=isNaN(t)||!isFinite(t)?0:t},DataStream.prototype.isEof=function(){return this.position>=this.byteLength},DataStream.prototype.mapInt32Array=function(e,t){this._realloc(4*e);var n=new Int32Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=4*e,n},DataStream.prototype.mapInt16Array=function(e,t){this._realloc(2*e);var n=new Int16Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=2*e,n},DataStream.prototype.mapInt8Array=function(e){this._realloc(1*e);var t=new Int8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=1*e,t},DataStream.prototype.mapUint32Array=function(e,t){this._realloc(4*e);var n=new Uint32Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=4*e,n},DataStream.prototype.mapUint16Array=function(e,t){this._realloc(2*e);var n=new Uint16Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=2*e,n},DataStream.prototype.mapUint8Array=function(e){this._realloc(1*e);var t=new Uint8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=1*e,t},DataStream.prototype.mapFloat64Array=function(e,t){this._realloc(8*e);var n=new Float64Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=8*e,n},DataStream.prototype.mapFloat32Array=function(e,t){this._realloc(4*e);var n=new Float32Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=4*e,n},DataStream.prototype.readInt32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var n=new Int32Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readInt16Array=function(e,t){e=null==e?this.byteLength-this.position/2:e;var n=new Int16Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readInt8Array=function(e){e=null==e?this.byteLength-this.position:e;var t=new Int8Array(e);return DataStream.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},DataStream.prototype.readUint32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var n=new Uint32Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readUint16Array=function(e,t){e=null==e?this.byteLength-this.position/2:e;var n=new Uint16Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readUint8Array=function(e){e=null==e?this.byteLength-this.position:e;var t=new Uint8Array(e);return DataStream.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},DataStream.prototype.readFloat64Array=function(e,t){e=null==e?this.byteLength-this.position/8:e;var n=new Float64Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readFloat32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var n=new Float32Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,null==t?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.writeInt32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Int32Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapInt32Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeInt32(e[n],t)},DataStream.prototype.writeInt16Array=function(e,t){if(this._realloc(2*e.length),e instanceof Int16Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapInt16Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeInt16(e[n],t)},DataStream.prototype.writeInt8Array=function(e){if(this._realloc(1*e.length),e instanceof Int8Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapInt8Array(e.length);else for(var t=0;t<e.length;t++)this.writeInt8(e[t])},DataStream.prototype.writeUint32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Uint32Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapUint32Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeUint32(e[n],t)},DataStream.prototype.writeUint16Array=function(e,t){if(this._realloc(2*e.length),e instanceof Uint16Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapUint16Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeUint16(e[n],t)},DataStream.prototype.writeUint8Array=function(e){if(this._realloc(1*e.length),e instanceof Uint8Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapUint8Array(e.length);else for(var t=0;t<e.length;t++)this.writeUint8(e[t])},DataStream.prototype.writeFloat64Array=function(e,t){if(this._realloc(8*e.length),e instanceof Float64Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapFloat64Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeFloat64(e[n],t)},DataStream.prototype.writeFloat32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Float32Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapFloat32Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeFloat32(e[n],t)},DataStream.prototype.readInt32=function(e){var t=this._dataView.getInt32(this.position,null==e?this.endianness:e);return this.position+=4,t},DataStream.prototype.readInt16=function(e){var t=this._dataView.getInt16(this.position,null==e?this.endianness:e);return this.position+=2,t},DataStream.prototype.readInt8=function(){var e=this._dataView.getInt8(this.position);return this.position+=1,e},DataStream.prototype.readUint32=function(e){var t=this._dataView.getUint32(this.position,null==e?this.endianness:e);return this.position+=4,t},DataStream.prototype.readUint16=function(e){var t=this._dataView.getUint16(this.position,null==e?this.endianness:e);return this.position+=2,t},DataStream.prototype.readUint8=function(){var e=this._dataView.getUint8(this.position);return this.position+=1,e},DataStream.prototype.readFloat32=function(e){var t=this._dataView.getFloat32(this.position,null==e?this.endianness:e);return this.position+=4,t},DataStream.prototype.readFloat64=function(e){var t=this._dataView.getFloat64(this.position,null==e?this.endianness:e);return this.position+=8,t},DataStream.prototype.writeInt32=function(e,t){this._realloc(4),this._dataView.setInt32(this.position,e,null==t?this.endianness:t),this.position+=4},DataStream.prototype.writeInt16=function(e,t){this._realloc(2),this._dataView.setInt16(this.position,e,null==t?this.endianness:t),this.position+=2},DataStream.prototype.writeInt8=function(e){this._realloc(1),this._dataView.setInt8(this.position,e),this.position+=1},DataStream.prototype.writeUint32=function(e,t){this._realloc(4),this._dataView.setUint32(this.position,e,null==t?this.endianness:t),this.position+=4},DataStream.prototype.writeUint16=function(e,t){this._realloc(2),this._dataView.setUint16(this.position,e,null==t?this.endianness:t),this.position+=2},DataStream.prototype.writeUint8=function(e){this._realloc(1),this._dataView.setUint8(this.position,e),this.position+=1},DataStream.prototype.writeFloat32=function(e,t){this._realloc(4),this._dataView.setFloat32(this.position,e,null==t?this.endianness:t),this.position+=4},DataStream.prototype.writeFloat64=function(e,t){this._realloc(8),this._dataView.setFloat64(this.position,e,null==t?this.endianness:t),this.position+=8},DataStream.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,DataStream.memcpy=function(e,t,n,r,i){var o=new Uint8Array(e,t,i),s=new Uint8Array(n,r,i);o.set(s)},DataStream.arrayToNative=function(e,t){return t==this.endianness?e:this.flipArrayEndianness(e)},DataStream.nativeToEndian=function(e,t){return this.endianness==t?e:this.flipArrayEndianness(e)},DataStream.flipArrayEndianness=function(e){for(var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=0;n<e.byteLength;n+=e.BYTES_PER_ELEMENT)for(var r=n+e.BYTES_PER_ELEMENT-1,i=n;r>i;r--,i++){var o=t[i];t[i]=t[r],t[r]=o}return e},DataStream.createStringFromArray=function(e){for(var t=[],n=0;n<e.length;n+=32768)t.push(String.fromCharCode.apply(null,e.subarray(n,n+32768)));return t.join("")},DataStream.prototype.failurePosition=0,DataStream.prototype.readStruct=function(e){for(var t,n,r={},i=this.position,o=0;o<e.length;o+=2){if(t=e[o+1],null==(n=this.readType(t,r)))return 0==this.failurePosition&&(this.failurePosition=this.position),this.position=i,null;r[e[o]]=n}return r},DataStream.prototype.readUCS2String=function(e,t){return DataStream.createStringFromArray(this.readUint16Array(e,t))},DataStream.prototype.writeUCS2String=function(e,t,n){null==n&&(n=e.length);for(var r=0;r<e.length&&r<n;r++)this.writeUint16(e.charCodeAt(r),t);for(;r<n;r++)this.writeUint16(0)},DataStream.prototype.readString=function(e,t){return null==t||"ASCII"==t?DataStream.createStringFromArray(this.mapUint8Array(null==e?this.byteLength-this.position:e)):new TextDecoder(t).decode(this.mapUint8Array(e))},DataStream.prototype.writeString=function(e,t,n){if(null==t||"ASCII"==t)if(null!=n){var r=0,i=Math.min(e.length,n);for(r=0;r<i;r++)this.writeUint8(e.charCodeAt(r));for(;r<n;r++)this.writeUint8(0)}else for(r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r));else this.writeUint8Array(new TextEncoder(t).encode(e.substring(0,n)))},DataStream.prototype.readCString=function(e){var t=this.byteLength-this.position,n=new Uint8Array(this._buffer,this._byteOffset+this.position),r=t;null!=e&&(r=Math.min(e,t));for(var i=0;i<r&&0!=n[i];i++);var o=DataStream.createStringFromArray(this.mapUint8Array(i));return null!=e?this.position+=r-i:i!=t&&(this.position+=1),o},DataStream.prototype.writeCString=function(e,t){if(null!=t){var n=0,r=Math.min(e.length,t);for(n=0;n<r;n++)this.writeUint8(e.charCodeAt(n));for(;n<t;n++)this.writeUint8(0)}else{for(n=0;n<e.length;n++)this.writeUint8(e.charCodeAt(n));this.writeUint8(0)}},DataStream.prototype.readType=function(e,t){if("function"==typeof e)return e(this,t);if(!("object"!=typeof e||e instanceof Array))return e.get(this,t);if(e instanceof Array&&3!=e.length)return this.readStruct(e,t);var n,r=null,i=null,o="ASCII",s=this.position;"string"==typeof e&&/:/.test(e)&&(e=(n=e.split(":"))[0],i=null!=t[a=n[1]]?parseInt(t[a]):parseInt(n[1]));"string"==typeof e&&/,/.test(e)&&(e=(n=e.split(","))[0],o=parseInt(n[1]));switch(e){case"uint8":r=this.readUint8();break;case"int8":r=this.readInt8();break;case"uint16":r=this.readUint16(this.endianness);break;case"int16":r=this.readInt16(this.endianness);break;case"uint32":r=this.readUint32(this.endianness);break;case"int32":r=this.readInt32(this.endianness);break;case"float32":r=this.readFloat32(this.endianness);break;case"float64":r=this.readFloat64(this.endianness);break;case"uint16be":r=this.readUint16(DataStream.BIG_ENDIAN);break;case"int16be":r=this.readInt16(DataStream.BIG_ENDIAN);break;case"uint32be":r=this.readUint32(DataStream.BIG_ENDIAN);break;case"int32be":r=this.readInt32(DataStream.BIG_ENDIAN);break;case"float32be":r=this.readFloat32(DataStream.BIG_ENDIAN);break;case"float64be":r=this.readFloat64(DataStream.BIG_ENDIAN);break;case"uint16le":r=this.readUint16(DataStream.LITTLE_ENDIAN);break;case"int16le":r=this.readInt16(DataStream.LITTLE_ENDIAN);break;case"uint32le":r=this.readUint32(DataStream.LITTLE_ENDIAN);break;case"int32le":r=this.readInt32(DataStream.LITTLE_ENDIAN);break;case"float32le":r=this.readFloat32(DataStream.LITTLE_ENDIAN);break;case"float64le":r=this.readFloat64(DataStream.LITTLE_ENDIAN);break;case"cstring":r=this.readCString(i);break;case"string":r=this.readString(i,o);break;case"u16string":r=this.readUCS2String(i,this.endianness);break;case"u16stringle":r=this.readUCS2String(i,DataStream.LITTLE_ENDIAN);break;case"u16stringbe":r=this.readUCS2String(i,DataStream.BIG_ENDIAN);break;default:if(3==e.length){var a,u=e[1],l=0;if(l="function"==typeof(a=e[2])?a(t,this,e):"string"==typeof a&&null!=t[a]?parseInt(t[a]):parseInt(a),"string"==typeof u){var c=u.replace(/(le|be)$/,""),f=null;switch(/le$/.test(u)?f=DataStream.LITTLE_ENDIAN:/be$/.test(u)&&(f=DataStream.BIG_ENDIAN),"*"==a&&(l=null),c){case"uint8":r=this.readUint8Array(l);break;case"uint16":r=this.readUint16Array(l,f);break;case"uint32":r=this.readUint32Array(l,f);break;case"int8":r=this.readInt8Array(l);break;case"int16":r=this.readInt16Array(l,f);break;case"int32":r=this.readInt32Array(l,f);break;case"float32":r=this.readFloat32Array(l,f);break;case"float64":r=this.readFloat64Array(l,f);break;case"cstring":case"utf16string":case"string":if(null==l)for(r=[];!this.isEof();){if(null==(d=this.readType(u,t)))break;r.push(d)}else{r=new Array(l);for(var h=0;h<l;h++)r[h]=this.readType(u,t)}}}else if("*"==a)for(r=[],this.buffer;;){var _=this.position;try{var y=this.readType(u,t);if(null==y){this.position=_;break}r.push(y)}catch(e){this.position=_;break}}else{r=new Array(l);for(h=0;h<l;h++){var d;if(null==(d=this.readType(u,t)))return null;r[h]=d}}break}}return null!=i&&(this.position=s+i),r},DataStream.prototype.writeStruct=function(e,t){for(var n=0;n<e.length;n+=2){var r=e[n+1];this.writeType(r,t[e[n]],t)}},DataStream.prototype.writeType=function(e,t,n){if("function"==typeof e)return e(this,t);if("object"==typeof e&&!(e instanceof Array))return e.set(this,t,n);var r,i=null,o="ASCII",s=this.position;"string"==typeof e&&/:/.test(e)&&(e=(r=e.split(":"))[0],i=parseInt(r[1]));"string"==typeof e&&/,/.test(e)&&(e=(r=e.split(","))[0],o=parseInt(r[1]));switch(e){case"uint8":this.writeUint8(t);break;case"int8":this.writeInt8(t);break;case"uint16":this.writeUint16(t,this.endianness);break;case"int16":this.writeInt16(t,this.endianness);break;case"uint32":this.writeUint32(t,this.endianness);break;case"int32":this.writeInt32(t,this.endianness);break;case"float32":this.writeFloat32(t,this.endianness);break;case"float64":this.writeFloat64(t,this.endianness);break;case"uint16be":this.writeUint16(t,DataStream.BIG_ENDIAN);break;case"int16be":this.writeInt16(t,DataStream.BIG_ENDIAN);break;case"uint32be":this.writeUint32(t,DataStream.BIG_ENDIAN);break;case"int32be":this.writeInt32(t,DataStream.BIG_ENDIAN);break;case"float32be":this.writeFloat32(t,DataStream.BIG_ENDIAN);break;case"float64be":this.writeFloat64(t,DataStream.BIG_ENDIAN);break;case"uint16le":this.writeUint16(t,DataStream.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(t,DataStream.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(t,DataStream.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(t,DataStream.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(t,DataStream.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(t,DataStream.LITTLE_ENDIAN);break;case"cstring":this.writeCString(t,i);break;case"string":this.writeString(t,o,i);break;case"u16string":this.writeUCS2String(t,this.endianness,i);break;case"u16stringle":this.writeUCS2String(t,DataStream.LITTLE_ENDIAN,i);break;case"u16stringbe":this.writeUCS2String(t,DataStream.BIG_ENDIAN,i);break;default:if(3==e.length){for(var a=e[1],u=0;u<t.length;u++)this.writeType(a,t[u]);break}this.writeStruct(e,t)}null!=i&&(this.position=s,this._realloc(i),this.position=s+i)},void 0===(n=function(){return DataStream}.apply(t,[]))||(e.exports=n),"object"==typeof e&&e&&e.exports&&(e.exports=DataStream)}).call(this,n(68)(e))},function(e,t,n){"use strict";Number.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=9007199254740991),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},Number.isSafeInteger=Number.isSafeInteger||function(e){return Number.isInteger(e)&&Math.abs(e)<=Number.MAX_SAFE_INTEGER},Number.isFinite=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t=Object(this),n=t.length>>>0,r=arguments[1],i=0;i!==n;i++)if(e.call(r,this[i],i,t))return this[i]}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BuddyMessageRequest=void 0;var r=n(16),i=n(0),o=n(13);var s=function(e){function t(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(null!=n&&!(n instanceof o.SFSBuddy))throw new i.SFSError("Target buddy must be an instance of SFSBuddy class");return a._type=r.GenericMessageType.BUDDY_MSG,a._message=e,a._recipient=null!=n?n.id:-1,a._params=s,Object.seal(a),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.GenericMessageRequest),t}();t.BuddyMessageRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickJoinGameRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3),a=n(5);var u=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.QuickJoinGame));return o._matchExpression=e,o._whereToSearch=n,o._roomToLeave=r,Object.seal(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM_LIST",get:function(){return"rl"}},{key:"KEY_GROUP_LIST",get:function(){return"gl"}},{key:"KEY_ROOM_TO_LEAVE",get:function(){return"tl"}},{key:"KEY_MATCH_EXPRESSION",get:function(){return"me"}},{key:"MAX_ROOMS",get:function(){return 32}}]),r(t,[{key:"validate",value:function(e){var n=[];if(null==this._matchExpression||this._matchExpression instanceof a.MatchExpression||n.push("Match expression must be an instance of MatchExpression class"),null==this._whereToSearch||this._whereToSearch.length<1?n.push("Missing list of Rooms or Group names where to search the game to join"):this._whereToSearch.length>t.MAX_ROOMS&&n.push("Too many Rooms specified in list where to search the game to join; client limit is: "+t.MAX_ROOMS),null==this._roomToLeave||this._roomToLeave instanceof s.SFSRoom||n.push("Room to leave must be an instance of SFSRoom class"),n.length>0)throw new o.SFSValidationError("CreateSFSGameRequest Error",n)}},{key:"execute",value:function(e){if("string"==typeof this._whereToSearch[0])this._reqObj.putUtfStringArray(t.KEY_GROUP_LIST,this._whereToSearch);else{if(!(this._whereToSearch[0]instanceof s.SFSRoom))throw new o.SFSError("Invalid type in whereToSearch parameter");var n=[],r=!0,i=!1,a=void 0;try{for(var u,l=this._whereToSearch[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=u.value;c instanceof s.SFSRoom&&n.push(c.id)}}catch(e){i=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw a}}this._reqObj.putIntArray(t.KEY_ROOM_LIST,n)}null!=this._roomToLeave&&this._reqObj.putInt(t.KEY_ROOM_TO_LEAVE,this._roomToLeave.id),null!=this._matchExpression&&this._reqObj.putSFSArray(t.KEY_MATCH_EXPRESSION,this._matchExpression.toSFSArray())}}]),t}();t.QuickJoinGameRequest=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JoinRoomInvitationRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3),a=n(2);var u=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.JoinRoomInvite));return a._targetRoom=e,a._invitedUserNames=n,a._params=r,a._expirySeconds=o,a._asSpectator=s,Object.seal(a),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM_ID",get:function(){return"r"}},{key:"KEY_EXPIRY_SECONDS",get:function(){return"es"}},{key:"KEY_INVITED_NAMES",get:function(){return"in"}},{key:"KEY_AS_SPECT",get:function(){return"as"}},{key:"KEY_OPTIONAL_PARAMS",get:function(){return"op"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null==this._targetRoom&&t.push("Missing target room"),null==this._targetRoom||this._targetRoom instanceof s.SFSRoom||t.push("Target room must be an instance of SFSRoom class"),null==this._invitedUserNames?t.push("No invitees provided"):this._invitedUserNames instanceof Array?this._invitedUserNames.length<1&&t.push("No invitees provided"):t.push("Invited user names must be passed in an array"),null==this._params||this._params instanceof a.SFSObject||t.push("Custom invitation parameters must be set in a SFSObject class instance"),t.length>0)throw new o.SFSValidationError("JoinRoomInvitationRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putInt(t.KEY_ROOM_ID,this._targetRoom.id),this._reqObj.putUtfStringArray(t.KEY_INVITED_NAMES,this._invitedUserNames),this._reqObj.putInt(t.KEY_EXPIRY_SECONDS,this._expirySeconds),this._reqObj.putBool(t.KEY_AS_SPECT,this._asSpectator),null!=this._params&&this._reqObj.putSFSObject(t.KEY_OPTIONAL_PARAMS,this._params)}}]),t}();t.JoinRoomInvitationRequest=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvitationReplyRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(2),a=n(18);var u=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.InvitationReply));return o._invitation=e,o._reply=n,o._params=r,Object.seal(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_INVITATION_ID",get:function(){return"i"}},{key:"KEY_INVITATION_REPLY",get:function(){return"r"}},{key:"KEY_INVITATION_PARAMS",get:function(){return"p"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(null==this._invitation?t.push("Missing invitation object"):this._invitation instanceof a.SFSInvitation||t.push("Invitation object must be an instance of Invitation class"),null==this._params||this._params instanceof s.SFSObject||t.push("Custom invitation parameters must be set in a SFSObject class instance"),t.length>0)throw new o.SFSValidationError("InvitationReplyRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putInt(t.KEY_INVITATION_ID,this._invitation.id),this._reqObj.putByte(t.KEY_INVITATION_REPLY,this._reply),null!=this._params&&this._reqObj.putSFSObject(t.KEY_INVITATION_PARAMS,this._params)}}]),t}();t.InvitationReplyRequest=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateSFSGameRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(12),a=n(17),u=n(15),l=n(7),c=n(13),f=n(2),h=n(5);var _=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.CreateSFSGame));return n._settings=e,n._createRoomRequest=new a.CreateRoomRequest(e,!1,null),Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_IS_PUBLIC",get:function(){return"gip"}},{key:"KEY_MIN_PLAYERS",get:function(){return"gmp"}},{key:"KEY_INVITED_PLAYERS",get:function(){return"ginp"}},{key:"KEY_SEARCHABLE_ROOMS",get:function(){return"gsr"}},{key:"KEY_PLAYER_MATCH_EXP",get:function(){return"gpme"}},{key:"KEY_SPECTATOR_MATCH_EXP",get:function(){return"gsme"}},{key:"KEY_INVITATION_EXPIRY",get:function(){return"gie"}},{key:"KEY_LEAVE_ROOM",get:function(){return"glr"}},{key:"KEY_NOTIFY_GAME_STARTED",get:function(){return"gns"}},{key:"KEY_INVITATION_PARAMS",get:function(){return"ip"}}]),r(t,[{key:"validate",value:function(e){if(!(this._settings instanceof s.SFSGameSettings))throw new o.SFSValidationError("CreateSFSGameRequest Error",["Room configuration must be an instance of SFSGameSettings class"]);var t=[];try{this._createRoomRequest.validate(e)}catch(e){t=e.getErrors()}if(this._settings.minPlayersToStartGame>this._settings.maxUsers&&t.push("Minimum number of players to start the game can't be greater than the Room's maximum number of users"),(this._settings.invitationExpiryTime<u.InviteUsersRequest.MIN_EXPIRY_TIME||this._settings.invitationExpiryTime>u.InviteUsersRequest.MAX_EXPIRY_TIME)&&t.push("Invitation expiration time value is out of range (min: "+u.InviteUsersRequest.MIN_EXPIRY_TIME+"; max: "+u.InviteUsersRequest.MAX_EXPIRY_TIME+")"),null!=this._settings.invitedPlayers&&(this._settings.invitedPlayers instanceof Array?(this._settings.invitedPlayers.length>u.InviteUsersRequest.MAX_INVITATIONS_FROM_CLIENT_SIDE&&t.push("Can't invite more than "+u.InviteUsersRequest.MAX_INVITATIONS_FROM_CLIENT_SIDE+" players from client side"),this._settings.invitedPlayers.every(function(e){return e instanceof l.SFSUser||e instanceof c.SFSBuddy})||t.push("Each invited player must be an instance of SFSUser or SFSBuddy classes")):t.push("Invited players must be passed in an array")),null==this._settings.playerMatchExpression||this._settings.playerMatchExpression instanceof h.MatchExpression||t.push("Player match expression must be an instance of MatchExpression class"),null==this._settings.spectatorMatchExpression||this._settings.spectatorMatchExpression instanceof h.MatchExpression||t.push("Spectator match expression must be an instance of MatchExpression class"),null==this._settings.invitationParams||this._settings.invitationParams instanceof f.SFSObject||t.push("Custom invitation parameters must be set in a SFSObject class instance"),t.length>0)throw new o.SFSValidationError("CreateSFSGameRequest Error",t)}},{key:"execute",value:function(e){if(this._createRoomRequest.execute(e),this._reqObj=this._createRoomRequest._reqObj,this._reqObj.putBool(t.KEY_IS_PUBLIC,this._settings.isPublic),this._reqObj.putShort(t.KEY_MIN_PLAYERS,this._settings.minPlayersToStartGame),this._reqObj.putShort(t.KEY_INVITATION_EXPIRY,this._settings.invitationExpiryTime),this._reqObj.putBool(t.KEY_LEAVE_ROOM,this._settings.leaveLastJoinedRoom),this._reqObj.putBool(t.KEY_NOTIFY_GAME_STARTED,this._settings.notifyGameStarted),null!=this._settings.playerMatchExpression&&this._reqObj.putSFSArray(t.KEY_PLAYER_MATCH_EXP,this._settings.playerMatchExpression.toSFSArray()),null!=this._settings.spectatorMatchExpression&&this._reqObj.putSFSArray(t.KEY_SPECTATOR_MATCH_EXP,this._settings.spectatorMatchExpression.toSFSArray()),null!=this._settings.invitedPlayers){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=this._settings.invitedPlayers[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var u=s.value;n.push(u.id)}}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}this._reqObj.putIntArray(t.KEY_INVITED_PLAYERS,n)}null!=this._settings.searchableRooms&&this._reqObj.putUtfStringArray(t.KEY_SEARCHABLE_ROOMS,this._settings.searchableRooms),null!=this._settings.invitationParams&&this._reqObj.putSFSObject(t.KEY_INVITATION_PARAMS,this._settings.invitationParams)}}]),t}();t.CreateSFSGameRequest=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BanUserRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:24;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.BanUser));return a._userId=e,a._message=n,a._banMode=r,a._delay=o,a._durationHours=s,Object.seal(a),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_USER_ID",get:function(){return"u"}},{key:"KEY_MESSAGE",get:function(){return"m"}},{key:"KEY_DELAY",get:function(){return"d"}},{key:"KEY_BAN_MODE",get:function(){return"b"}},{key:"KEY_BAN_DURATION_HOURS",get:function(){return"dh"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(t.length>0)throw new o.SFSValidationError("BanUserRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putInt(t.KEY_USER_ID,this._userId),this._reqObj.putInt(t.KEY_DELAY,this._delay),this._reqObj.putInt(t.KEY_BAN_MODE,this._banMode),this._reqObj.putInt(t.KEY_BAN_DURATION_HOURS,this._durationHours),null!=this._message&&this._message.length>0&&this._reqObj.putUtfString(t.KEY_MESSAGE,this._message)}}]),t}();t.BanUserRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KickUserRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0);var s=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.KickUser));return r<0&&(r=0),o._userId=e,o._message=n,o._delay=r,Object.seal(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_USER_ID",get:function(){return"u"}},{key:"KEY_MESSAGE",get:function(){return"m"}},{key:"KEY_DELAY",get:function(){return"d"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(t.length>0)throw new o.SFSValidationError("KickUserRequest Error",t)}},{key:"execute",value:function(e){this._reqObj.putInt(t.KEY_USER_ID,this._userId),this._reqObj.putInt(t.KEY_DELAY,this._delay),null!=this._message&&this._message.length>0&&this._reqObj.putUtfString(t.KEY_MESSAGE,this._message)}}]),t}();t.KickUserRequest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LeaveRoomRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(0),s=n(3);var a=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.LeaveRoom));return n._room=e,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_ROOM_ID",get:function(){return"r"}}]),r(t,[{key:"validate",value:function(e){var t=[];if(e.getJoinedRooms().length<1&&t.push("You are not joined in any Room"),null==this._room||this._room instanceof s.SFSRoom||t.push("Room must be an instance of SFSRoom class"),t.length>0)throw new o.SFSValidationError("LeaveRoomRequest Error",t)}},{key:"execute",value:function(e){null!=this._room&&this._reqObj.putInt(t.KEY_ROOM_ID,this._room.id)}}]),t}();t.LeaveRoomRequest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.freeze({NAME:"${N}",GROUP_ID:"${G}",MAX_USERS:"${MXU}",MAX_SPECTATORS:"${MXS}",USER_COUNT:"${UC}",SPECTATOR_COUNT:"${SC}",IS_GAME:"${ISG}",IS_PRIVATE:"${ISP}",HAS_FREE_PLAYER_SLOTS:"${HFP}",IS_TYPE_SFSGAME:"${IST}"}),i=Object.freeze({NAME:"${N}",IS_PLAYER:"${ISP}",IS_SPECTATOR:"${ISS}",IS_NPC:"${ISN}",PRIVILEGE_ID:"${PRID}",IS_IN_ANY_ROOM:"${IAR}"});t.RoomProperties=r,t.UserProperties=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(t,n){s(this,e),this._type=t,this._symbol=n,Object.freeze(this)}return r(e,[{key:"type",get:function(){return this._type}},{key:"symbol",get:function(){return this._symbol}}]),e}(),u=function(e){function t(e){s(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,0,e));return Object.freeze(n),n}return o(t,a),r(t,null,[{key:"EQUALS",get:function(){return new t("==")}},{key:"NOT_EQUALS",get:function(){return new t("!=")}}]),t}(),l=function(e){function t(e){s(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,1,e));return Object.freeze(n),n}return o(t,a),r(t,null,[{key:"EQUALS",get:function(){return new t("==")}},{key:"NOT_EQUALS",get:function(){return new t("!=")}},{key:"GREATER_THAN",get:function(){return new t(">")}},{key:"GREATER_THAN_OR_EQUAL_TO",get:function(){return new t(">=")}},{key:"LESS_THAN",get:function(){return new t("<")}},{key:"LESS_THAN_OR_EQUAL_TO",get:function(){return new t("<=")}}]),t}(),c=function(e){function t(e){s(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,2,e));return Object.freeze(n),n}return o(t,a),r(t,null,[{key:"EQUALS",get:function(){return new t("==")}},{key:"NOT_EQUALS",get:function(){return new t("!=")}},{key:"CONTAINS",get:function(){return new t("contains")}},{key:"STARTS_WITH",get:function(){return new t("startsWith")}},{key:"ENDS_WITH",get:function(){return new t("endsWith")}}]),t}();t.BoolMatch=u,t.NumberMatch=l,t.StringMatch=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PingPongRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1);var o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.PingPong));return Object.seal(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,[{key:"validate",value:function(e){}},{key:"execute",value:function(e){}}]),t}();t.PingPongRequest=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LagMonitor=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(56);var o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._sfs=t,this._valueQueue=[],this._interval=n,this._queueSize=r,this._thread=null,this._lastReqTime=-1}return r(e,[{key:"start",value:function(){this.isRunning||null==this._sfs||(this._thread=setInterval(this._threadRunner,1e3*this._interval,this))}},{key:"stop",value:function(){this.isRunning&&(clearInterval(this._thread),this._thread=null,this._valueQueue=[])}},{key:"destroy",value:function(){this.stop(),this._sfs=null}},{key:"getLastPingTime",value:function(){return this._valueQueue.length>0?this._valueQueue[this._valueQueue.length-1]:0}},{key:"_threadRunner",value:function(e){e._lastReqTime=(new Date).getTime(),e._sfs.send(new i.PingPongRequest)}},{key:"_onPingPong",value:function(){var e=(new Date).getTime()-this._lastReqTime;return this._valueQueue.length>=this._queueSize&&this._valueQueue.shift(),this._valueQueue.push(e),this._getAveragePingTime()}},{key:"_getAveragePingTime",value:function(){if(0==this._valueQueue.length)return 0;for(var e=0,t=0;t<this._valueQueue.length;t++)e+=this._valueQueue[t];return e/this._valueQueue.length}},{key:"isRunning",get:function(){return null!=this._thread}}]),e}();t.LagMonitor=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HandshakeRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1);var o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.Requests.Handshake));return r._apiVersion=e,r._clientDetails=n,Object.seal(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.BaseRequest),r(t,null,[{key:"KEY_SESSION_TOKEN",get:function(){return"tk"}},{key:"KEY_API",get:function(){return"api"}},{key:"KEY_COMPRESSION_THRESHOLD",get:function(){return"ct"}},{key:"KEY_CLIENT_TYPE",get:function(){return"cl"}},{key:"KEY_MAX_MESSAGE_SIZE",get:function(){return"ms"}}]),r(t,[{key:"validate",value:function(e){}},{key:"execute",value:function(e){this._reqObj.putUtfString(t.KEY_API,this._apiVersion),this._reqObj.putUtfString(t.KEY_CLIENT_TYPE,this._clientDetails)}}]),t}();t.HandshakeRequest=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SFSBuddyManager=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(6);var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._sfs=t,this._buddiesByName=new Map,this._myVariables=new Map,this._inited=!1,this._buddyStates=new Set,Object.seal(this)}return r(e,[{key:"containsBuddy",value:function(e){return this._buddiesByName.has(e)}},{key:"getBuddyById",value:function(e){return this.getBuddyList().find(function(t){return t.id===e})}},{key:"getBuddyByName",value:function(e){return this._buddiesByName.get(e)}},{key:"getBuddyByNickName",value:function(e){return this.getBuddyList().find(function(t){return t.nickName===e})}},{key:"getOfflineBuddies",value:function(){return this.getBuddyList().filter(function(e){return!e.isOnline})}},{key:"getOnlineBuddies",value:function(){return this.getBuddyList().filter(function(e){return e.isOnline})}},{key:"getBuddyList",value:function(){return Array.from(this._buddiesByName.values())}},{key:"getMyVariable",value:function(e){return this._myVariables.get(e)}},{key:"getMyVariables",value:function(){return Array.from(this._myVariables.values())}},{key:"getMyOnlineState",value:function(){if(!this._inited)return!1;var e=this.getMyVariable(i.ReservedBuddyVariables.BV_ONLINE);return null==e||e.value}},{key:"getMyNickName",value:function(){var e=this.getMyVariable(i.ReservedBuddyVariables.BV_NICKNAME);return null!=e?e.value:null}},{key:"getMyState",value:function(){var e=this.getMyVariable(i.ReservedBuddyVariables.BV_STATE);return null!=e?e.value:null}},{key:"getBuddyStates",value:function(){return Array.from(this._buddyStates.values())}},{key:"_setInited",value:function(){this._inited=!0}},{key:"_addBuddy",value:function(e){this._buddiesByName.set(e.name,e)}},{key:"_clearAll",value:function(){this._buddiesByName.clear()}},{key:"_removeBuddyById",value:function(e){var t=this.getBuddyById(e);return null!=t&&this._buddiesByName.delete(t.name),t}},{key:"_removeBuddyByName",value:function(e){var t=this.getBuddyByName(e);return null!=t&&this._buddiesByName.delete(e),t}},{key:"_setMyVariables",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;this._setMyVariable(s)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_setMyVariable",value:function(e){e.isNull?this._myVariables.delete(e.name):this._myVariables.set(e.name,e)}},{key:"_setMyOnlineState",value:function(e){this._setMyVariable(new i.SFSBuddyVariable(i.ReservedBuddyVariables.BV_ONLINE,e))}},{key:"_setMyNickName",value:function(e){this._setMyVariable(new i.SFSBuddyVariable(i.ReservedBuddyVariables.BV_NICKNAME,e))}},{key:"_setMyState",value:function(e){this._setMyVariable(new i.SFSBuddyVariable(i.ReservedBuddyVariables.BV_STATE,e))}},{key:"_setBuddyStates",value:function(e){this._buddyStates=new Set(e)}},{key:"isInited",get:function(){return this._inited}}]),e}();t.SFSBuddyManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._sfs=t,this._groups=new Set,this._roomsById=new Map,this._roomsByName=new Map,Object.seal(this)}return r(e,[{key:"getRoomGroups",value:function(){return Array.from(this._groups)}},{key:"containsGroup",value:function(e){return this._groups.has(e)}},{key:"containsRoom",value:function(e){return"number"==typeof e?this._roomsById.has(e):this._roomsByName.has(e)}},{key:"containsRoomInGroup",value:function(e,t){var n=this.getRoomListFromGroup(t);return"number"==typeof e?n.some(function(t){return t.id===e}):n.some(function(t){return t.name===e})}},{key:"getRoomById",value:function(e){return this._roomsById.get(e)}},{key:"getRoomByName",value:function(e){return this._roomsByName.get(e)}},{key:"getRoomList",value:function(){return Array.from(this._roomsById.values())}},{key:"getRoomCount",value:function(){return this._roomsById.size}},{key:"getRoomListFromGroup",value:function(e){return this.getRoomList().filter(function(t){return t.groupId===e})}},{key:"getJoinedRooms",value:function(){return this.getRoomList().filter(function(e){return e.isJoined})}},{key:"getUserRooms",value:function(e){return this.getRoomList().filter(function(t){return t.containsUser(e)})}},{key:"_addRoom",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._roomsById.set(e.id,e),this._roomsByName.set(e.name,e),e._setRoomManager(this),t?this.containsGroup(e.groupId)||this._addGroup(e.groupId):e._isManaged=!1}},{key:"_replaceRoom",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getRoomById(e.id);return null!=n?(n._merge(e),n):(this._addRoom(e,t),e)}},{key:"_removeRoom",value:function(e){this._roomsById.delete(e.id),this._roomsByName.delete(e.name)}},{key:"_removeRoomById",value:function(e){var t=this.getRoomById(e);null!=t&&this._removeRoom(t)}},{key:"_removeRoomByName",value:function(e){var t=this.getRoomByName(e);null!=t&&this._removeRoom(t)}},{key:"_changeRoomName",value:function(e,t){var n=e.name;e._name=t,this._roomsByName.set(t,e),this._roomsByName.delete(n)}},{key:"_changeRoomPasswordState",value:function(e,t){e._isPasswordProtected=t}},{key:"_changeRoomCapacity",value:function(e,t,n){e._maxUsers=t,e._maxSpectators=n}},{key:"_addGroup",value:function(e){this._groups.add(e)}},{key:"_removeGroup",value:function(e){this._groups.delete(e);var t=this.getRoomListFromGroup(e),n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;a.isJoined?a._isManaged=!1:this._removeRoom(a)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}},{key:"_removeUser",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.getUserRooms(e)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value._removeUser(e)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}}]),e}();t.SFSRoomManager=i},function(e,t){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";function e(e){throw e}var t=void 0,n=!0,r=this;function i(e,n){var i,o=e.split("."),s=r;!(o[0]in s)&&s.execScript&&s.execScript("var "+o[0]);for(;o.length&&(i=o.shift());)o.length||n===t?s=s[i]?s[i]:s[i]={}:s[i]=n}var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function s(t,n){this.index="number"==typeof n?n:0,this.i=0,this.buffer=t instanceof(o?Uint8Array:Array)?t:new(o?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&e(Error("invalid index")),this.buffer.length<=this.index&&this.f()}s.prototype.f=function(){var e,t=this.buffer,n=t.length,r=new(o?Uint8Array:Array)(n<<1);if(o)r.set(t);else for(e=0;e<n;++e)r[e]=t[e];return this.buffer=r},s.prototype.d=function(e,t,n){var r,i=this.buffer,o=this.index,s=this.i,a=i[o];if(n&&1<t&&(e=8<t?(h[255&e]<<24|h[e>>>8&255]<<16|h[e>>>16&255]<<8|h[e>>>24&255])>>32-t:h[e]>>8-t),8>t+s)a=a<<t|e,s+=t;else for(r=0;r<t;++r)a=a<<1|e>>t-r-1&1,8==++s&&(s=0,i[o++]=h[a],a=0,o===i.length&&(i=this.f()));i[o]=a,this.buffer=i,this.i=s,this.index=o},s.prototype.finish=function(){var e,t=this.buffer,n=this.index;return 0<this.i&&(t[n]<<=8-this.i,t[n]=h[t[n]],n++),o?e=t.subarray(0,n):(t.length=n,e=t),e};var a,u=new(o?Uint8Array:Array)(256);for(a=0;256>a;++a){for(var l=f=a,c=7,f=f>>>1;f;f>>>=1)l<<=1,l|=1&f,--c;u[a]=(l<<c&255)>>>0}var h=u;function _(e){this.buffer=new(o?Uint16Array:Array)(2*e),this.length=0}function y(e){var t,n,r,i,s,a,u,l,c,f,h=e.length,_=0,y=Number.POSITIVE_INFINITY;for(l=0;l<h;++l)e[l]>_&&(_=e[l]),e[l]<y&&(y=e[l]);for(t=1<<_,n=new(o?Uint32Array:Array)(t),r=1,i=0,s=2;r<=_;){for(l=0;l<h;++l)if(e[l]===r){for(a=0,u=i,c=0;c<r;++c)a=a<<1|1&u,u>>=1;for(f=r<<16|l,c=a;c<t;c+=s)n[c]=f;++i}++r,i<<=1,s<<=1}return[n,_,y]}function d(e,t){this.h=g,this.w=0,this.input=o&&e instanceof Array?new Uint8Array(e):e,this.b=0,t&&(t.lazy&&(this.w=t.lazy),"number"==typeof t.compressionType&&(this.h=t.compressionType),t.outputBuffer&&(this.a=o&&t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex&&(this.b=t.outputIndex)),this.a||(this.a=new(o?Uint8Array:Array)(32768))}_.prototype.getParent=function(e){return 2*((e-2)/4|0)},_.prototype.push=function(e,t){var n,r,i,o=this.buffer;for(n=this.length,o[this.length++]=t,o[this.length++]=e;0<n&&(r=this.getParent(n),o[n]>o[r]);)i=o[n],o[n]=o[r],o[r]=i,i=o[n+1],o[n+1]=o[r+1],o[r+1]=i,n=r;return this.length},_.prototype.pop=function(){var e,t,n,r,i,o=this.buffer;for(t=o[0],e=o[1],this.length-=2,o[0]=o[this.length],o[1]=o[this.length+1],i=0;!((r=2*i+2)>=this.length)&&(r+2<this.length&&o[r+2]>o[r]&&(r+=2),o[r]>o[i]);)n=o[i],o[i]=o[r],o[r]=n,n=o[i+1],o[i+1]=o[r+1],o[r+1]=n,i=r;return{index:e,value:t,length:this.length}};var p,g=2,b={NONE:0,r:1,k:g,O:3},v=[];for(p=0;288>p;p++)switch(n){case 143>=p:v.push([p+48,8]);break;case 255>=p:v.push([p-144+400,9]);break;case 279>=p:v.push([p-256+0,7]);break;case 287>=p:v.push([p-280+192,8]);break;default:e("invalid literal: "+p)}d.prototype.j=function(){var r,i,a,u,l=this.input;switch(this.h){case 0:for(a=0,u=l.length;a<u;){var c,f,h,_=i=o?l.subarray(a,a+65535):l.slice(a,a+65535),y=(a+=i.length)===u,d=t,p=t,b=this.a,m=this.b;if(o){for(b=new Uint8Array(this.a.buffer);b.length<=m+_.length+5;)b=new Uint8Array(b.length<<1);b.set(this.a)}if(c=y?1:0,b[m++]=0|c,h=65536+~(f=_.length)&65535,b[m++]=255&f,b[m++]=f>>>8&255,b[m++]=255&h,b[m++]=h>>>8&255,o)b.set(_,m),m+=_.length,b=b.subarray(0,m);else{for(d=0,p=_.length;d<p;++d)b[m++]=_[d];b.length=m}this.b=m,this.a=b}break;case 1:var S=new s(o?new Uint8Array(this.a.buffer):this.a,this.b);S.d(1,1,n),S.d(1,2,n);var R,w,T,I=E(this,l);for(R=0,w=I.length;R<w;R++)if(T=I[R],s.prototype.d.apply(S,v[T]),256<T)S.d(I[++R],I[++R],n),S.d(I[++R],5),S.d(I[++R],I[++R],n);else if(256===T)break;this.a=S.finish(),this.b=this.a.length;break;case g:var k,M,P,U,j,D,N,F,B,L,Y,C,q,V,K,x=new s(o?new Uint8Array(this.a.buffer):this.a,this.b),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=Array(19);for(k=g,x.d(1,1,n),x.d(k,2,n),M=E(this,l),N=A(D=O(this.M,15)),B=A(F=O(this.L,7)),P=286;257<P&&0===D[P-1];P--);for(U=30;1<U&&0===F[U-1];U--);var H,J,X,W,Z,Q,$=P,ee=U,te=new(o?Uint32Array:Array)($+ee),ne=new(o?Uint32Array:Array)(316),re=new(o?Uint8Array:Array)(19);for(H=J=0;H<$;H++)te[J++]=D[H];for(H=0;H<ee;H++)te[J++]=F[H];if(!o)for(H=0,W=re.length;H<W;++H)re[H]=0;for(H=Z=0,W=te.length;H<W;H+=J){for(J=1;H+J<W&&te[H+J]===te[H];++J);if(X=J,0===te[H])if(3>X)for(;0<X--;)ne[Z++]=0,re[0]++;else for(;0<X;)(Q=138>X?X:138)>X-3&&Q<X&&(Q=X-3),10>=Q?(ne[Z++]=17,ne[Z++]=Q-3,re[17]++):(ne[Z++]=18,ne[Z++]=Q-11,re[18]++),X-=Q;else if(ne[Z++]=te[H],re[te[H]]++,3>--X)for(;0<X--;)ne[Z++]=te[H],re[te[H]]++;else for(;0<X;)(Q=6>X?X:6)>X-3&&Q<X&&(Q=X-3),ne[Z++]=16,ne[Z++]=Q-3,re[16]++,X-=Q}for(r=o?ne.subarray(0,Z):ne.slice(0,Z),L=O(re,7),V=0;19>V;V++)z[V]=L[G[V]];for(j=19;4<j&&0===z[j-1];j--);for(Y=A(L),x.d(P-257,5,n),x.d(U-1,5,n),x.d(j-4,4,n),V=0;V<j;V++)x.d(z[V],3,n);for(V=0,K=r.length;V<K;V++)if(C=r[V],x.d(Y[C],L[C],n),16<=C){switch(V++,C){case 16:q=2;break;case 17:q=3;break;case 18:q=7;break;default:e("invalid code: "+C)}x.d(r[V],q,n)}var ie,oe,se,ae,ue,le,ce,fe,he=[N,D],_e=[B,F];for(ue=he[0],le=he[1],ce=_e[0],fe=_e[1],ie=0,oe=M.length;ie<oe;++ie)if(se=M[ie],x.d(ue[se],le[se],n),256<se)x.d(M[++ie],M[++ie],n),ae=M[++ie],x.d(ce[ae],fe[ae],n),x.d(M[++ie],M[++ie],n);else if(256===se)break;this.a=x.finish(),this.b=this.a.length;break;default:e("invalid compression type")}return this.a};var m=function(){function t(t){switch(n){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var r,i,o=[];for(r=3;258>=r;r++)i=t(r),o[r]=i[2]<<24|i[1]<<16|i[0];return o}(),S=o?new Uint32Array(m):m;function E(r,i){function s(t,r){var i,o,s,a,u=t.H,l=[],c=0;switch(i=S[t.length],l[c++]=65535&i,l[c++]=i>>16&255,l[c++]=i>>24,n){case 1===u:o=[0,u-1,0];break;case 2===u:o=[1,u-2,0];break;case 3===u:o=[2,u-3,0];break;case 4===u:o=[3,u-4,0];break;case 6>=u:o=[4,u-5,1];break;case 8>=u:o=[5,u-7,1];break;case 12>=u:o=[6,u-9,2];break;case 16>=u:o=[7,u-13,2];break;case 24>=u:o=[8,u-17,3];break;case 32>=u:o=[9,u-25,3];break;case 48>=u:o=[10,u-33,4];break;case 64>=u:o=[11,u-49,4];break;case 96>=u:o=[12,u-65,5];break;case 128>=u:o=[13,u-97,5];break;case 192>=u:o=[14,u-129,6];break;case 256>=u:o=[15,u-193,6];break;case 384>=u:o=[16,u-257,7];break;case 512>=u:o=[17,u-385,7];break;case 768>=u:o=[18,u-513,8];break;case 1024>=u:o=[19,u-769,8];break;case 1536>=u:o=[20,u-1025,9];break;case 2048>=u:o=[21,u-1537,9];break;case 3072>=u:o=[22,u-2049,10];break;case 4096>=u:o=[23,u-3073,10];break;case 6144>=u:o=[24,u-4097,11];break;case 8192>=u:o=[25,u-6145,11];break;case 12288>=u:o=[26,u-8193,12];break;case 16384>=u:o=[27,u-12289,12];break;case 24576>=u:o=[28,u-16385,13];break;case 32768>=u:o=[29,u-24577,13];break;default:e("invalid distance")}for(i=o,l[c++]=i[0],l[c++]=i[1],l[c++]=i[2],s=0,a=l.length;s<a;++s)g[b++]=l[s];m[l[0]]++,E[l[3]]++,v=t.length+r-1,y=null}var a,u,l,c,f,h,_,y,d,p={},g=o?new Uint16Array(2*i.length):[],b=0,v=0,m=new(o?Uint32Array:Array)(286),E=new(o?Uint32Array:Array)(30),O=r.w;if(!o){for(l=0;285>=l;)m[l++]=0;for(l=0;29>=l;)E[l++]=0}for(m[256]=1,a=0,u=i.length;a<u;++a){for(l=f=0,c=3;l<c&&a+l!==u;++l)f=f<<8|i[a+l];if(p[f]===t&&(p[f]=[]),h=p[f],!(0<v--)){for(;0<h.length&&32768<a-h[0];)h.shift();if(a+3>=u){for(y&&s(y,-1),l=0,c=u-a;l<c;++l)d=i[a+l],g[b++]=d,++m[d];break}0<h.length?(_=R(i,a,h),y?y.length<_.length?(d=i[a-1],g[b++]=d,++m[d],s(_,0)):s(y,-1):_.length<O?y=_:s(_,0)):y?s(y,-1):(d=i[a],g[b++]=d,++m[d])}h.push(a)}return g[b++]=256,m[256]++,r.M=m,r.L=E,o?g.subarray(0,b):g}function R(e,t,n){var r,i,o,s,a,u,l=0,c=e.length;s=0,u=n.length;e:for(;s<u;s++){if(r=n[u-s-1],o=3,3<l){for(a=l;3<a;a--)if(e[r+a-1]!==e[t+a-1])continue e;o=l}for(;258>o&&t+o<c&&e[r+o]===e[t+o];)++o;if(o>l&&(i=r,l=o),258===o)break}return new function(e,t){this.length=e,this.H=t}(l,t-i)}function O(e,t){var n,r,i,s,a,u=e.length,l=new _(572),c=new(o?Uint8Array:Array)(u);if(!o)for(s=0;s<u;s++)c[s]=0;for(s=0;s<u;++s)0<e[s]&&l.push(s,e[s]);if(n=Array(l.length/2),r=new(o?Uint32Array:Array)(l.length/2),1===n.length)return c[l.pop().index]=1,c;for(s=0,a=l.length/2;s<a;++s)n[s]=l.pop(),r[s]=n[s].value;for(i=function(e,t,n){function r(e){var n=y[e][d[e]];n===t?(r(e+1),r(e+1)):--h[n],++d[e]}var i,s,a,u,l,c=new(o?Uint16Array:Array)(n),f=new(o?Uint8Array:Array)(n),h=new(o?Uint8Array:Array)(t),_=Array(n),y=Array(n),d=Array(n),p=(1<<n)-t,g=1<<n-1;for(c[n-1]=t,s=0;s<n;++s)p<g?f[s]=0:(f[s]=1,p-=g),p<<=1,c[n-2-s]=(c[n-1-s]/2|0)+t;for(c[0]=f[0],_[0]=Array(c[0]),y[0]=Array(c[0]),s=1;s<n;++s)c[s]>2*c[s-1]+f[s]&&(c[s]=2*c[s-1]+f[s]),_[s]=Array(c[s]),y[s]=Array(c[s]);for(i=0;i<t;++i)h[i]=n;for(a=0;a<c[n-1];++a)_[n-1][a]=e[a],y[n-1][a]=a;for(i=0;i<n;++i)d[i]=0;for(1===f[n-1]&&(--h[0],++d[n-1]),s=n-2;0<=s;--s){for(u=i=0,l=d[s+1],a=0;a<c[s];a++)(u=_[s+1][l]+_[s+1][l+1])>e[i]?(_[s][a]=u,y[s][a]=t,l+=2):(_[s][a]=e[i],y[s][a]=i,++i);d[s]=0,1===f[s]&&r(s)}return h}(r,r.length,t),s=0,a=n.length;s<a;++s)c[n[s].index]=i[s];return c}function A(e){var t,n,r,i,s=new(o?Uint16Array:Array)(e.length),a=[],u=[],l=0;for(t=0,n=e.length;t<n;t++)a[e[t]]=1+(0|a[e[t]]);for(t=1,n=16;t<=n;t++)u[t]=l,l+=0|a[t],l<<=1;for(t=0,n=e.length;t<n;t++)for(l=u[e[t]],u[e[t]]+=1,r=s[t]=0,i=e[t];r<i;r++)s[t]=s[t]<<1|1&l,l>>>=1;return s}function w(t,n){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=o?new Uint8Array(t):t,this.s=!1,this.n=I,this.C=!1,!n&&(n={})||(n.index&&(this.c=n.index),n.bufferSize&&(this.m=n.bufferSize),n.bufferType&&(this.n=n.bufferType),n.resize&&(this.C=n.resize)),this.n){case T:this.b=32768,this.a=new(o?Uint8Array:Array)(32768+this.m+258);break;case I:this.b=0,this.a=new(o?Uint8Array:Array)(this.m),this.f=this.K,this.t=this.I,this.o=this.J;break;default:e(Error("invalid inflate mode"))}}var T=0,I=1,k={F:T,D:I};w.prototype.p=function(){for(;!this.s;){var r=J(this,3);switch(1&r&&(this.s=n),r>>>=1){case 0:var i=this.input,s=this.c,a=this.a,u=this.b,l=i.length,c=t,f=a.length,h=t;switch(this.e=this.g=0,s+1>=l&&e(Error("invalid uncompressed block header: LEN")),c=i[s++]|i[s++]<<8,s+1>=l&&e(Error("invalid uncompressed block header: NLEN")),c===~(i[s++]|i[s++]<<8)&&e(Error("invalid uncompressed block header: length verify")),s+c>i.length&&e(Error("input buffer is broken")),this.n){case T:for(;u+c>a.length;){if(c-=h=f-u,o)a.set(i.subarray(s,s+h),u),u+=h,s+=h;else for(;h--;)a[u++]=i[s++];this.b=u,a=this.f(),u=this.b}break;case I:for(;u+c>a.length;)a=this.f({v:2});break;default:e(Error("invalid inflate mode"))}if(o)a.set(i.subarray(s,s+c),u),u+=c,s+=c;else for(;c--;)a[u++]=i[s++];this.c=s,this.b=u,this.a=a;break;case 1:this.o(G,H);break;case 2:W(this);break;default:e(Error("unknown BTYPE: "+r))}}return this.t()};var M,P,U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=o?new Uint16Array(U):U,D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],N=o?new Uint16Array(D):D,F=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],B=o?new Uint8Array(F):F,L=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Y=o?new Uint16Array(L):L,C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],q=o?new Uint8Array(C):C,V=new(o?Uint8Array:Array)(288);for(M=0,P=V.length;M<P;++M)V[M]=143>=M?8:255>=M?9:279>=M?7:8;var K,x,G=y(V),z=new(o?Uint8Array:Array)(30);for(K=0,x=z.length;K<x;++K)z[K]=5;var H=y(z);function J(t,n){for(var r,i=t.g,o=t.e,s=t.input,a=t.c,u=s.length;o<n;)a>=u&&e(Error("input buffer is broken")),i|=s[a++]<<o,o+=8;return r=i&(1<<n)-1,t.g=i>>>n,t.e=o-n,t.c=a,r}function X(e,t){for(var n,r,i=e.g,o=e.e,s=e.input,a=e.c,u=s.length,l=t[0],c=t[1];o<c&&!(a>=u);)i|=s[a++]<<o,o+=8;return r=(n=l[i&(1<<c)-1])>>>16,e.g=i>>r,e.e=o-r,e.c=a,65535&n}function W(e){function t(e,t,n){var r,i,o,s=this.z;for(o=0;o<e;)switch(r=X(this,t),r){case 16:for(i=3+J(this,2);i--;)n[o++]=s;break;case 17:for(i=3+J(this,3);i--;)n[o++]=0;s=0;break;case 18:for(i=11+J(this,7);i--;)n[o++]=0;s=0;break;default:s=n[o++]=r}return this.z=s,n}var n,r,i,s,a=J(e,5)+257,u=J(e,5)+1,l=J(e,4)+4,c=new(o?Uint8Array:Array)(j.length);for(s=0;s<l;++s)c[j[s]]=J(e,3);if(!o)for(s=l,l=c.length;s<l;++s)c[j[s]]=0;n=y(c),r=new(o?Uint8Array:Array)(a),i=new(o?Uint8Array:Array)(u),e.z=0,e.o(y(t.call(e,a,n,r)),y(t.call(e,u,n,i)))}function Z(e){if("string"==typeof e){var t,n,r=e.split("");for(t=0,n=r.length;t<n;t++)r[t]=(255&r[t].charCodeAt(0))>>>0;e=r}for(var i,o=1,s=0,a=e.length,u=0;0<a;){a-=i=1024<a?1024:a;do{s+=o+=e[u++]}while(--i);o%=65521,s%=65521}return(s<<16|o)>>>0}function Q(t,n){var r,i;switch(this.input=t,this.c=0,!n&&(n={})||(n.index&&(this.c=n.index),n.verify&&(this.N=n.verify)),r=t[this.c++],i=t[this.c++],15&r){case $:this.method=$;break;default:e(Error("unsupported compression method"))}0!=((r<<8)+i)%31&&e(Error("invalid fcheck flag:"+((r<<8)+i)%31)),32&i&&e(Error("fdict flag is not supported")),this.B=new w(t,{index:this.c,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}w.prototype.o=function(e,t){var n=this.a,r=this.b;this.u=e;for(var i,o,s,a,u=n.length-258;256!==(i=X(this,e));)if(256>i)r>=u&&(this.b=r,n=this.f(),r=this.b),n[r++]=i;else for(a=N[o=i-257],0<B[o]&&(a+=J(this,B[o])),i=X(this,t),s=Y[i],0<q[i]&&(s+=J(this,q[i])),r>=u&&(this.b=r,n=this.f(),r=this.b);a--;)n[r]=n[r++-s];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},w.prototype.J=function(e,t){var n=this.a,r=this.b;this.u=e;for(var i,o,s,a,u=n.length;256!==(i=X(this,e));)if(256>i)r>=u&&(u=(n=this.f()).length),n[r++]=i;else for(a=N[o=i-257],0<B[o]&&(a+=J(this,B[o])),i=X(this,t),s=Y[i],0<q[i]&&(s+=J(this,q[i])),r+a>u&&(u=(n=this.f()).length);a--;)n[r]=n[r++-s];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},w.prototype.f=function(){var e,t,n=new(o?Uint8Array:Array)(this.b-32768),r=this.b-32768,i=this.a;if(o)n.set(i.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=i[e+32768];if(this.l.push(n),this.q+=n.length,o)i.set(i.subarray(r,r+32768));else for(e=0;32768>e;++e)i[e]=i[r+e];return this.b=32768,i},w.prototype.K=function(e){var t,n,r,i=this.input.length/this.c+1|0,s=this.input,a=this.a;return e&&("number"==typeof e.v&&(i=e.v),"number"==typeof e.G&&(i+=e.G)),2>i?n=(r=(s.length-this.c)/this.u[2]/2*258|0)<a.length?a.length+r:a.length<<1:n=a.length*i,o?(t=new Uint8Array(n)).set(a):t=a,this.a=t},w.prototype.t=function(){var e,t,n,r,i,s=0,a=this.a,u=this.l,l=new(o?Uint8Array:Array)(this.q+(this.b-32768));if(0===u.length)return o?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(t=0,n=u.length;t<n;++t)for(r=0,i=(e=u[t]).length;r<i;++r)l[s++]=e[r];for(t=32768,n=this.b;t<n;++t)l[s++]=a[t];return this.l=[],this.buffer=l},w.prototype.I=function(){var e,t=this.b;return o?this.C?(e=new Uint8Array(t)).set(this.a.subarray(0,t)):e=this.a.subarray(0,t):(this.a.length>t&&(this.a.length=t),e=this.a),this.buffer=e},Q.prototype.p=function(){var t,n=this.input;return t=this.B.p(),this.c=this.B.c,this.N&&((n[this.c++]<<24|n[this.c++]<<16|n[this.c++]<<8|n[this.c++])>>>0!==Z(t)&&e(Error("invalid adler-32 checksum"))),t};var $=8;function ee(e,t){this.input=e,this.a=new(o?Uint8Array:Array)(32768),this.h=te.k;var n,r={};for(n in!t&&(t={})||"number"!=typeof t.compressionType||(this.h=t.compressionType),t)r[n]=t[n];r.outputBuffer=this.a,this.A=new d(this.input,r)}var te=b;function ne(e,t){var n,r,o,s;if(Object.keys)n=Object.keys(t);else for(r in n=[],o=0,t)n[o++]=r;for(o=0,s=n.length;o<s;++o)i(e+"."+(r=n[o]),t[r])}ee.prototype.j=function(){var t,n,r,i,s,a,u,l=0;switch(u=this.a,t=$){case $:n=Math.LOG2E*Math.log(32768)-8;break;default:e(Error("invalid compression method"))}switch(r=n<<4|t,u[l++]=r,t){case $:switch(this.h){case te.NONE:s=0;break;case te.r:s=1;break;case te.k:s=2;break;default:e(Error("unsupported compression type"))}break;default:e(Error("invalid compression method"))}return i=s<<6|0,u[l++]=i|31-(256*r+i)%31,a=Z(this.input),this.A.b=l,l=(u=this.A.j()).length,o&&((u=new Uint8Array(u.buffer)).length<=l+4&&(this.a=new Uint8Array(u.length+4),this.a.set(u),u=this.a),u=u.subarray(0,l+4)),u[l++]=a>>24&255,u[l++]=a>>16&255,u[l++]=a>>8&255,u[l++]=255&a,u},i("Zlib.Inflate",Q),i("Zlib.Inflate.prototype.decompress",Q.prototype.p),ne("Zlib.Inflate.BufferType",{ADAPTIVE:k.D,BLOCK:k.F}),i("Zlib.Deflate",ee),i("Zlib.Deflate.compress",function(e,t){return new ee(e,t).j()}),i("Zlib.Deflate.prototype.compress",ee.prototype.j),ne("Zlib.Deflate.CompressionType",{NONE:te.NONE,FIXED:te.r,DYNAMIC:te.k})}).call(this)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SocketEngine=t.SocketEvent=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(44),s=(r=o)&&r.__esModule?r:{default:r},a=n(61),u=n(4),l=n(2),c=n(1),f=n(10),h=n(11),_=n(0);function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var d=Object.freeze({CONNECT:"socketConnect",DISCONNECT:"socketDisconnect",DATA:"socketData",IOERROR:"socketIOError"}),p=function(e){function t(e){y(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._sfs=e,n._logger=f.Logger.instance,n._isConnected=!1,n._isConnecting=!1,n._socket=null,n._protocolCodec=new g(e),n._disconnectionReason=h.ClientDisconnectionReason.UNKNOWN,Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.EventDispatcher),i(t,[{key:"connect",value:function(e,t,n){this._isConnecting=!0;var r="ws"+(n?"s":"");this._socket=new WebSocket(r+"://"+e+":"+t+"/BlueBox/websocket"),this._socket.binaryType="arraybuffer",this._socket._scope=this,this._socket.onopen=this._onSocketConnect,this._socket.onclose=this._onSocketDisconnect,this._socket.onmessage=this._onSocketData,this._socket.onerror=this._onSocketError}},{key:"disconnect",value:function(e){this._disconnectionReason=e,this._socket.close()}},{key:"addController",value:function(e,t){null==this._controllers[e]&&(this._controllers[e]=t)}},{key:"removeController",value:function(e){delete this._controllers[e]}},{key:"send",value:function(e){this._sfs.debug&&this._logger.debug("OUTGOING MESSAGE: "+e.dump());var t=this._protocolCodec.onPacketWrite(e);this._socket.send(t)}},{key:"_onSocketConnect",value:function(){this._scope._sfs.debug&&this._scope._logger.debug("Socket connection established"),this._scope._isConnected=!0,this._scope._isConnecting=!1,this._scope.dispatchEvent(d.CONNECT,{success:!0})}},{key:"_onSocketDisconnect",value:function(){this._scope._isConnected=!1,this._scope.isConnecting?(this._scope._sfs.debug&&this._scope._logger.debug("Can't establish socket connection"),this._scope._isConnecting=!1,this._scope.dispatchEvent(d.CONNECT,{success:!1})):(this._scope._sfs.debug&&this._scope._logger.debug("Socket disconnection occurred"),this._scope.dispatchEvent(d.DISCONNECT,{reason:this._scope._disconnectionReason}),this._scope._disconnectionReason=h.ClientDisconnectionReason.UNKNOWN)}},{key:"_onSocketData",value:function(e){var t=this._scope._protocolCodec.onPacketRead(e.data);this._scope._sfs.debug&&this._scope._logger.debug("INCOMING MESSAGE: "+t.dump()),this._scope.dispatchEvent(d.DATA,t)}},{key:"_onSocketError",value:function(e){this._scope.dispatchEvent(d.IOERROR,e.data)}},{key:"isConnected",get:function(){return this._isConnected}},{key:"isConnecting",get:function(){return this._isConnecting}},{key:"maxMessageSize",get:function(){return this._protocolCodec.maxMessageSize},set:function(e){this._protocolCodec.maxMessageSize=e}},{key:"compressionThreshold",get:function(){return this._protocolCodec.compressionThreshold},set:function(e){this._protocolCodec.compressionThreshold=e}}]),t}(),g=function(){function e(t){y(this,e),this.CONTROLLER_ID="c",this.ACTION_ID="a",this.PARAM_ID="p",this._maxMessageSize=1e4,this._compressionThreshold=1024,this._sfs=t,this._logger=f.Logger.instance,Object.seal(this)}return i(e,[{key:"onPacketRead",value:function(e){if(0!==e.byteLength){var t=new s.default(e,0,s.default.BIG_ENDIAN),n=t.readUint8(),r=(32&n)>0,i=(8&n)>0?t.readUint32():t.readUint16(),o=t.readUint8Array(i);r&&(o=this.decompress(o)),this._sfs.debug&&(e.byteLength>1024?this._logger.debug("DATA READ - Binary size > 1024; dump omitted"):this._logger.debug("DATA READ - "+h.DumpFormatter.hexDump(o)));var a=l.SFSObject.newFromBinaryData(o);return new c.Message(a.get(this.ACTION_ID),a.get(this.CONTROLLER_ID),a.get(this.PARAM_ID))}this._logger.error("Unexpected empty packet data: no readable bytes available!")}},{key:"onPacketWrite",value:function(e){var t=new l.SFSObject;t.put(this.CONTROLLER_ID,e.targetController,l.SFSDataType.BYTE),t.put(this.ACTION_ID,e.id,l.SFSDataType.SHORT),t.put(this.PARAM_ID,e.content,l.SFSDataType.SFS_OBJECT);var n=t.toBinary(),r=n.byteLength,i=new s.default(new ArrayBuffer(0),0,s.default.BIG_ENDIAN),o=128;r>this.compressionThreshold&&(o+=32,r=(n=this.compress(n)).byteLength);var a=r>65335;a&&(o+=8),i.writeUint8(o),a?i.writeUint32(r):i.writeUint16(r),i.writeUint8Array(n);var u=new Uint8Array(i.buffer);if(u.byteLength>this.maxMessageSize)throw new _.SFSError("Message size is too big: "+u.byteLength+"; the server limit is: "+this.maxMessageSize);return this._sfs.debug&&this._logger.debug("DATA WRITTEN - "+h.DumpFormatter.hexDump(u)),u}},{key:"decompress",value:function(e){return new a.Zlib.Inflate(e).decompress()}},{key:"compress",value:function(e){return new a.Zlib.Deflate(e).compress()}},{key:"maxMessageSize",get:function(){return this._maxMessageSize},set:function(e){this._maxMessageSize=e}},{key:"compressionThreshold",get:function(){return this._compressionThreshold},set:function(e){this._compressionThreshold=e}}]),e}();t.SocketEvent=d,t.SocketEngine=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionController=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(4),o=n(21);var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._sfs=t,this._logger=t.logger,this._id=1,Object.freeze(this)}return r(e,[{key:"handleMessage",value:function(e,t){this._sfs.debug&&this._logger.info("Handling Extension response");var n={};n.cmd=e.get(o.ExtensionRequest.KEY_CMD),n.params=e.get(o.ExtensionRequest.KEY_PARAMS);var r=e.get(o.ExtensionRequest.KEY_ROOM);null!=r&&(n.room=this._sfs.roomManager.getRoomById(r)),this._sfs.dispatchEvent(i.SFSEvent.EXTENSION_RESPONSE,n)}},{key:"id",get:function(){return this._id}}]),e}();t.ExtensionController=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"KEY_ROOM_ID",get:function(){return"r"}},{key:"KEY_ITEM_ID",get:function(){return"i"}},{key:"KEY_VAR_LIST",get:function(){return"v"}}]),e}();t.SetMMOItemVariables=i},function(e,t,n){"use strict";n.r(t),n.d(t,"MD5",function(){return r});var r=function(){this.hexcase=0,this.b64pad=""};r.prototype={},r.prototype.hex_md5=function(e){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(e)))},r.prototype.b64_md5=function(e){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(e)))},r.prototype.any_md5=function(e,t){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(e)),t)},r.prototype.hex_hmac_md5=function(e,t){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},r.prototype.b64_hmac_md5=function(e,t){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},r.prototype.any_hmac_md5=function(e,t,n){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)),n)},r.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},r.prototype.rstr_md5=function(e){return this.binl2rstr(this.binl_md5(this.rstr2binl(e),8*e.length))},r.prototype.rstr_hmac_md5=function(e,t){var n=this.rstr2binl(e);n.length>16&&(n=this.binl_md5(n,8*e.length));for(var r=Array(16),i=Array(16),o=0;o<16;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var s=this.binl_md5(r.concat(this.rstr2binl(t)),512+8*t.length);return this.binl2rstr(this.binl_md5(i.concat(s),640))},r.prototype.rstr2hex=function(e){try{this.hexcase}catch(e){this.hexcase=0}for(var t,n=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",i=0;i<e.length;i++)t=e.charCodeAt(i),r+=n.charAt(t>>>4&15)+n.charAt(15&t);return r},r.prototype.rstr2b64=function(e){try{this.b64pad}catch(e){this.b64pad=""}for(var t="",n=e.length,r=0;r<n;r+=3)for(var i=e.charCodeAt(r)<<16|(r+1<n?e.charCodeAt(r+1)<<8:0)|(r+2<n?e.charCodeAt(r+2):0),o=0;o<4;o++)8*r+6*o>8*e.length?t+=this.b64pad:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-o)&63);return t},r.prototype.rstr2any=function(e,t){var n,r,i,o,s,a=t.length,u=Array(Math.ceil(e.length/2));for(n=0;n<u.length;n++)u[n]=e.charCodeAt(2*n)<<8|e.charCodeAt(2*n+1);var l=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),c=Array(l);for(r=0;r<l;r++){for(s=Array(),o=0,n=0;n<u.length;n++)o=(o<<16)+u[n],o-=(i=Math.floor(o/a))*a,(s.length>0||i>0)&&(s[s.length]=i);c[r]=o,u=s}var f="";for(n=c.length-1;n>=0;n--)f+=t.charAt(c[n]);return f},r.prototype.str2rstr_utf8=function(e){for(var t,n,r="",i=-1;++i<e.length;)t=e.charCodeAt(i),n=i+1<e.length?e.charCodeAt(i+1):0,55296<=t&&t<=56319&&56320<=n&&n<=57343&&(t=65536+((1023&t)<<10)+(1023&n),i++),t<=127?r+=String.fromCharCode(t):t<=2047?r+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?r+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(r+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return r},r.prototype.str2rstr_utf16le=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(255&e.charCodeAt(n),e.charCodeAt(n)>>>8&255);return t},r.prototype.str2rstr_utf16be=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,255&e.charCodeAt(n));return t},r.prototype.rstr2binl=function(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},r.prototype.binl2rstr=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},r.prototype.binl_md5=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=n,u=r,l=i,c=o;n=this.md5_ff(n,r,i,o,e[s+0],7,-680876936),o=this.md5_ff(o,n,r,i,e[s+1],12,-389564586),i=this.md5_ff(i,o,n,r,e[s+2],17,606105819),r=this.md5_ff(r,i,o,n,e[s+3],22,-1044525330),n=this.md5_ff(n,r,i,o,e[s+4],7,-176418897),o=this.md5_ff(o,n,r,i,e[s+5],12,1200080426),i=this.md5_ff(i,o,n,r,e[s+6],17,-1473231341),r=this.md5_ff(r,i,o,n,e[s+7],22,-45705983),n=this.md5_ff(n,r,i,o,e[s+8],7,1770035416),o=this.md5_ff(o,n,r,i,e[s+9],12,-1958414417),i=this.md5_ff(i,o,n,r,e[s+10],17,-42063),r=this.md5_ff(r,i,o,n,e[s+11],22,-1990404162),n=this.md5_ff(n,r,i,o,e[s+12],7,1804603682),o=this.md5_ff(o,n,r,i,e[s+13],12,-40341101),i=this.md5_ff(i,o,n,r,e[s+14],17,-1502002290),r=this.md5_ff(r,i,o,n,e[s+15],22,1236535329),n=this.md5_gg(n,r,i,o,e[s+1],5,-165796510),o=this.md5_gg(o,n,r,i,e[s+6],9,-1069501632),i=this.md5_gg(i,o,n,r,e[s+11],14,643717713),r=this.md5_gg(r,i,o,n,e[s+0],20,-373897302),n=this.md5_gg(n,r,i,o,e[s+5],5,-701558691),o=this.md5_gg(o,n,r,i,e[s+10],9,38016083),i=this.md5_gg(i,o,n,r,e[s+15],14,-660478335),r=this.md5_gg(r,i,o,n,e[s+4],20,-405537848),n=this.md5_gg(n,r,i,o,e[s+9],5,568446438),o=this.md5_gg(o,n,r,i,e[s+14],9,-1019803690),i=this.md5_gg(i,o,n,r,e[s+3],14,-187363961),r=this.md5_gg(r,i,o,n,e[s+8],20,1163531501),n=this.md5_gg(n,r,i,o,e[s+13],5,-1444681467),o=this.md5_gg(o,n,r,i,e[s+2],9,-51403784),i=this.md5_gg(i,o,n,r,e[s+7],14,1735328473),r=this.md5_gg(r,i,o,n,e[s+12],20,-1926607734),n=this.md5_hh(n,r,i,o,e[s+5],4,-378558),o=this.md5_hh(o,n,r,i,e[s+8],11,-2022574463),i=this.md5_hh(i,o,n,r,e[s+11],16,1839030562),r=this.md5_hh(r,i,o,n,e[s+14],23,-35309556),n=this.md5_hh(n,r,i,o,e[s+1],4,-1530992060),o=this.md5_hh(o,n,r,i,e[s+4],11,1272893353),i=this.md5_hh(i,o,n,r,e[s+7],16,-155497632),r=this.md5_hh(r,i,o,n,e[s+10],23,-1094730640),n=this.md5_hh(n,r,i,o,e[s+13],4,681279174),o=this.md5_hh(o,n,r,i,e[s+0],11,-358537222),i=this.md5_hh(i,o,n,r,e[s+3],16,-722521979),r=this.md5_hh(r,i,o,n,e[s+6],23,76029189),n=this.md5_hh(n,r,i,o,e[s+9],4,-640364487),o=this.md5_hh(o,n,r,i,e[s+12],11,-421815835),i=this.md5_hh(i,o,n,r,e[s+15],16,530742520),r=this.md5_hh(r,i,o,n,e[s+2],23,-995338651),n=this.md5_ii(n,r,i,o,e[s+0],6,-198630844),o=this.md5_ii(o,n,r,i,e[s+7],10,1126891415),i=this.md5_ii(i,o,n,r,e[s+14],15,-1416354905),r=this.md5_ii(r,i,o,n,e[s+5],21,-57434055),n=this.md5_ii(n,r,i,o,e[s+12],6,1700485571),o=this.md5_ii(o,n,r,i,e[s+3],10,-1894986606),i=this.md5_ii(i,o,n,r,e[s+10],15,-1051523),r=this.md5_ii(r,i,o,n,e[s+1],21,-2054922799),n=this.md5_ii(n,r,i,o,e[s+8],6,1873313359),o=this.md5_ii(o,n,r,i,e[s+15],10,-30611744),i=this.md5_ii(i,o,n,r,e[s+6],15,-1560198380),r=this.md5_ii(r,i,o,n,e[s+13],21,1309151649),n=this.md5_ii(n,r,i,o,e[s+4],6,-145523070),o=this.md5_ii(o,n,r,i,e[s+11],10,-1120210379),i=this.md5_ii(i,o,n,r,e[s+2],15,718787259),r=this.md5_ii(r,i,o,n,e[s+9],21,-343485551),n=this.safe_add(n,a),r=this.safe_add(r,u),i=this.safe_add(i,l),o=this.safe_add(o,c)}return Array(n,r,i,o)},r.prototype.md5_cmn=function(e,t,n,r,i,o){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,o)),i),n)},r.prototype.md5_ff=function(e,t,n,r,i,o,s){return this.md5_cmn(t&n|~t&r,e,t,i,o,s)},r.prototype.md5_gg=function(e,t,n,r,i,o,s){return this.md5_cmn(t&r|n&~r,e,t,i,o,s)},r.prototype.md5_hh=function(e,t,n,r,i,o,s){return this.md5_cmn(t^n^r,e,t,i,o,s)},r.prototype.md5_ii=function(e,t,n,r,i,o,s){return this.md5_cmn(n^(t|~r),e,t,i,o,s)},r.prototype.safe_add=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},r.prototype.bit_rol=function(e,t){return e<<t|e>>>32-t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMOItem=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(19);var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=t,this._aoiEntryPoint=null,this._variables=new Map,Object.seal(this)}return r(e,[{key:"toString",value:function(){return"[Item: "+this.id+"]"}},{key:"getVariable",value:function(e){return this._variables.get(e)}},{key:"containsVariable",value:function(e){return this._variables.has(e)}},{key:"getVariables",value:function(){return Array.from(this._variables.values())}},{key:"_setVariables",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;this._setVariable(s)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_setVariable",value:function(e){e.isNull?this._variables.delete(e.name):this._variables.set(e.name,e)}},{key:"id",get:function(){return this._id}},{key:"aoiEntryPoint",get:function(){return this._aoiEntryPoint}}],[{key:"fromSFSArray",value:function(t){var n=new e(t.get(0)),r=t.get(1);if(null!=r)for(var o=0;o<r.size();o++)n._setVariable(i.MMOItemVariable.fromSFSArray(r.get(o)));return n}}]),e}();t.MMOItem=o},function(e,t){!function(e){"use strict";function t(e,t,n){return t<=e&&e<=n}function n(e,t){return Math.floor(e/t)}var r=-1,i=-1;function o(e,t){if(e)throw new Error("EncodingError");return t||65533}function s(e){throw new Error("EncodingError")}function a(e){if(e=String(e).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(l,e))return l[e];throw new Error("EncodingError: Unknown encoding: "+e)}var u={},l={};function c(e,t){return(t||[])[e]||null}function f(e,t){var n=t.indexOf(e);return-1===n?null:n}[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso_8859-2","l2","latin2"],name:"iso-8859-2"},{labels:["csisolatin3","iso-8859-3","iso_8859-3","iso-ir-109","l3","latin3"],name:"iso-8859-3"},{labels:["csisolatin4","iso-8859-4","iso_8859-4","iso-ir-110","l4","latin4"],name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5","iso-ir-144"],name:"iso-8859-5"},{labels:["arabic","csisolatinarabic","ecma-114","iso-8859-6","iso_8859-6","iso-ir-127"],name:"iso-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso_8859-7","iso-ir-126"],name:"iso-8859-7"},{labels:["csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-i","iso-ir-138","iso_8859-8","visual"],name:"iso-8859-8"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","l6","latin6"],name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620","windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ascii","ansi_x3.4-1968","csisolatin1","iso-8859-1","iso8859-1","iso_8859-1","l1","latin1","us-ascii","windows-1252"],name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:["csisolatin5","iso-8859-9","iso-ir-148","l5","latin5","windows-1254"],name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256","windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gbk","gb_2312","gb_2312-80","iso-ir-58","x-gbk"],name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:["csshiftjis","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}].forEach(function(e){e.encodings.forEach(function(e){u[e.name]=e,e.labels.forEach(function(t){l[t]=e})})});var h=e["encoding-indexes"]||{};function _(e,n){var s=n.fatal,a=0,u=0,l=0;this.decode=function(n){var f,_=n.get();if(_===r&&0===a&&0===u&&0===l)return i;if(_!==r||0===a&&0===u&&0===l||(a=0,u=0,l=0,o(s)),n.offset(1),0!==l)return f=null,t(_,48,57)&&(f=function(e){if(e>39419&&e<189e3||e>1237575)return null;var t,n=0,r=0,i=h.gb18030;for(t=0;t<i.length;++t){var o=i[t];if(!(o[0]<=e))break;n=o[0],r=o[1]}return r+e-n}(10*(126*(10*(a-129)+(u-48))+(l-129))+_-48)),a=0,u=0,l=0,null===f?(n.offset(-3),o(s)):f;if(0!==u)return t(_,129,254)?(l=_,null):(n.offset(-2),a=0,u=0,o(s));if(0!==a){if(t(_,48,57)&&e)return u=_,null;var y=a,d=null;a=0;var p=_<127?64:65;return(t(_,64,126)||t(_,128,254))&&(d=190*(y-129)+(_-p)),f=null===d?null:c(d,h.gbk),null===d&&n.offset(-1),null===f?o(s):f}return t(_,0,127)?_:128===_?8364:t(_,129,254)?(a=_,null):o(s)}}function y(e,o){o.fatal;this.encode=function(o,a){var u=a.get();if(u===i)return r;if(a.offset(1),t(u,0,127))return o.emit(u);var l=f(u,h.gbk);if(null!==l){var c=n(l,190)+129,_=l%190,y=_<63?64:65;return o.emit(c,_+y)}if(null===l&&!e)return s();var d=n(n(n(l=function(e){var t,n=0,r=0,i=h.gb18030;for(t=0;t<i.length;++t){var o=i[t];if(!(o[1]<=e))break;n=o[1],r=o[0]}return r+e-n}(u),10),126),10),p=n(n(l-=10*d*126*10,10),126),g=n(l-=10*p*126,10),b=l-10*g;return o.emit(d+129,p+48,g+129,b+48)}}function d(e,n){var s=n.fatal,a=null,u=null;this.decode=function(n){var l,c=n.get();if(c===r&&null===a&&null===u)return i;if(c===r&&(null!==a||null!==u))return o(s);if(n.offset(1),null===a)return a=c,null;if(l=e?(a<<8)+c:(c<<8)+a,a=null,null!==u){var f=u;return u=null,t(l,56320,57343)?65536+1024*(f-55296)+(l-56320):(n.offset(-2),o(s))}return t(l,55296,56319)?(u=l,null):t(l,56320,57343)?o(s):l}}function p(e,o){o.fatal;this.encode=function(o,a){function u(t){var n=t>>8,r=255&t;return e?o.emit(n,r):o.emit(r,n)}var l=a.get();if(l===i)return r;if(a.offset(1),t(l,55296,57343)&&s(),l<=65535)return u(l);var c=(l-65536)%1024+56320;return u(n(l-65536,1024)+55296),u(c)}}u["utf-8"].getEncoder=function(e){return new function(e){e.fatal,this.encode=function(e,o){var a,u,l=o.get();if(l===i)return r;if(o.offset(1),t(l,55296,57343))return s();if(t(l,0,127))return e.emit(l);t(l,128,2047)?(a=1,u=192):t(l,2048,65535)?(a=2,u=224):t(l,65536,1114111)&&(a=3,u=240);for(var c=e.emit(n(l,Math.pow(64,a))+u);a>0;){var f=n(l,Math.pow(64,a-1));c=e.emit(128+f%64),a-=1}return c}}(e)},u["utf-8"].getDecoder=function(e){return new function(e){var n=e.fatal,s=0,a=0,u=0,l=0;this.decode=function(e){var c=e.get();if(c===r)return 0!==a?o(n):i;if(e.offset(1),0===a){if(t(c,0,127))return c;if(t(c,194,223))a=1,l=128,s=c-192;else if(t(c,224,239))a=2,l=2048,s=c-224;else{if(!t(c,240,244))return o(n);a=3,l=65536,s=c-240}return s*=Math.pow(64,a),null}if(!t(c,128,191))return s=0,a=0,u=0,l=0,e.offset(-1),o(n);if(u+=1,s+=(c-128)*Math.pow(64,a-u),u!==a)return null;var f=s,h=l;return s=0,a=0,u=0,l=0,t(f,h,1114111)&&!t(f,55296,57343)?f:o(n)}}(e)},["ibm864","ibm866","iso-8859-2","iso-8859-3","iso-8859-4","iso-8859-5","iso-8859-6","iso-8859-7","iso-8859-8","iso-8859-10","iso-8859-13","iso-8859-14","iso-8859-15","iso-8859-16","koi8-r","koi8-u","macintosh","windows-874","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1255","windows-1256","windows-1257","windows-1258","x-mac-cyrillic"].forEach(function(e){var n=u[e],a=h[e];n.getDecoder=function(e){return new function(e,n){var s=n.fatal;this.decode=function(n){var a=n.get();if(a===r)return i;if(n.offset(1),t(a,0,127))return a;var u=e[a-128];return null===u?o(s):u}}(a,e)},n.getEncoder=function(e){return new function(e,n){n.fatal,this.encode=function(n,o){var a=o.get();if(a===i)return r;if(o.offset(1),t(a,0,127))return n.emit(a);var u=f(a,e);return null===u&&s(),n.emit(u+128)}}(a,e)}}),u.gbk.getEncoder=function(e){return new y(!1,e)},u.gbk.getDecoder=function(e){return new _(!1,e)},u.gb18030.getEncoder=function(e){return new y(!0,e)},u.gb18030.getDecoder=function(e){return new _(!0,e)},u["hz-gb-2312"].getEncoder=function(e){return new function(e){e.fatal;var o=!1;this.encode=function(e,a){var u=a.get();if(u===i)return r;if(a.offset(1),t(u,0,127)&&o)return a.offset(-1),o=!1,e.emit(126,125);if(126===u)return e.emit(126,126);if(t(u,0,127))return e.emit(u);if(!o)return a.offset(-1),o=!0,e.emit(126,123);var l=f(u,h.gbk);if(null===l)return s();var c=n(l,190)+1,_=l%190-63;return t(c,33,126)&&t(_,33,126)?e.emit(c,_):s()}}(e)},u["hz-gb-2312"].getDecoder=function(e){return new function(e){var n=e.fatal,s=!1,a=0;this.decode=function(e){var u=e.get();if(u===r&&0===a)return i;if(u===r&&0!==a)return a=0,o(n);if(e.offset(1),126===a)return a=0,123===u?(s=!0,null):125===u?(s=!1,null):126===u?126:10===u?null:(e.offset(-1),o(n));if(0!==a){var l=a;a=0;var f=null;return t(u,33,126)&&(f=c(190*(l-1)+(u+63),h.gbk)),10===u&&(s=!1),null===f?o(n):f}return 126===u?(a=126,null):s?t(u,32,127)?(a=u,null):(10===u&&(s=!1),o(n)):t(u,0,127)?u:o(n)}}(e)},u.big5.getEncoder=function(e){return new function(e){e.fatal,this.encode=function(e,o){var a=o.get();if(a===i)return r;if(o.offset(1),t(a,0,127))return e.emit(a);var u=f(a,h.big5);if(null===u)return s();var l=n(u,157)+129,c=u%157,_=c<63?64:98;return e.emit(l,c+_)}}(e)},u.big5.getDecoder=function(e){return new function(e){var n=e.fatal,s=0,a=null;this.decode=function(e){if(null!==a){var u=a;return a=null,u}var l=e.get();if(l===r&&0===s)return i;if(l===r&&0!==s)return s=0,o(n);if(e.offset(1),0!==s){var f=s,_=null;s=0;var y=l<127?64:98;if((t(l,64,126)||t(l,161,254))&&(_=157*(f-129)+(l-y)),1133===_)return a=772,202;if(1135===_)return a=780,202;if(1164===_)return a=772,234;if(1166===_)return a=780,234;var d=null===_?null:c(_,h.big5);return null===_&&e.offset(-1),null===d?o(n):d}return t(l,0,127)?l:t(l,129,254)?(s=l,null):o(n)}}(e)},u["euc-jp"].getEncoder=function(e){return new function(e){e.fatal,this.encode=function(e,o){var a=o.get();if(a===i)return r;if(o.offset(1),t(a,0,127))return e.emit(a);if(165===a)return e.emit(92);if(8254===a)return e.emit(126);if(t(a,65377,65439))return e.emit(142,a-65377+161);var u=f(a,h.jis0208);if(null===u)return s();var l=n(u,94)+161,c=u%94+161;return e.emit(l,c)}}(e)},u["euc-jp"].getDecoder=function(e){return new function(e){var n=e.fatal,s=0,a=0;this.decode=function(e){var u,l,f=e.get();return f===r?0===s&&0===a?i:(s=0,a=0,o(n)):(e.offset(1),0!==a?(u=a,a=0,l=null,t(u,161,254)&&t(f,161,254)&&(l=c(94*(u-161)+f-161,h.jis0212)),t(f,161,254)||e.offset(-1),null===l?o(n):l):142===s&&t(f,161,223)?(s=0,65377+f-161):143===s&&t(f,161,254)?(s=0,a=f,null):0!==s?(u=s,s=0,l=null,t(u,161,254)&&t(f,161,254)&&(l=c(94*(u-161)+f-161,h.jis0208)),t(f,161,254)||e.offset(-1),null===l?o(n):l):t(f,0,127)?f:142===f||143===f||t(f,161,254)?(s=f,null):o(n))}}(e)},u["iso-2022-jp"].getEncoder=function(e){return new function(e){e.fatal;var o=0,a=1,u=2,l=o;this.encode=function(e,c){var _=c.get();if(_===i)return r;if(c.offset(1),(t(_,0,127)||165===_||8254===_)&&l!==o)return c.offset(-1),l=o,e.emit(27,40,66);if(t(_,0,127))return e.emit(_);if(165===_)return e.emit(92);if(8254===_)return e.emit(126);if(t(_,65377,65439)&&l!==u)return c.offset(-1),l=u,e.emit(27,40,73);if(t(_,65377,65439))return e.emit(_-65377-33);if(l!==a)return c.offset(-1),l=a,e.emit(27,36,66);var y=f(_,h.jis0208);if(null===y)return s();var d=n(y,94)+33,p=y%94+33;return e.emit(d,p)}}(e)},u["iso-2022-jp"].getDecoder=function(e){return new function(e){var n=e.fatal,s=0,a=1,u=2,l=3,f=4,_=5,y=6,d=s,p=!1,g=0;this.decode=function(e){var b=e.get();switch(b!==r&&e.offset(1),d){default:case s:return 27===b?(d=a,null):t(b,0,127)?b:b===r?i:o(n);case a:return 36===b||40===b?(g=b,d=u,null):(b!==r&&e.offset(-1),d=s,o(n));case u:var v=g;return g=0,36!==v||64!==b&&66!==b?36===v&&40===b?(d=l,null):40!==v||66!==b&&74!==b?40===v&&73===b?(d=y,null):(b===r?e.offset(-1):e.offset(-2),d=s,o(n)):(d=s,null):(p=!1,d=f,null);case l:return 68===b?(p=!0,d=f,null):(b===r?e.offset(-2):e.offset(-3),d=s,o(n));case f:return 10===b?(d=s,o(n,10)):27===b?(d=a,null):b===r?i:(g=b,d=_,null);case _:if(d=f,b===r)return o(n);var m=null,S=94*(g-33)+b-33;return t(g,33,126)&&t(b,33,126)&&(m=c(S,!1===p?h.jis0208:h.jis0212)),null===m?o(n):m;case y:return 27===b?(d=a,null):t(b,33,95)?65377+b-33:b===r?i:o(n)}}}(e)},u.shift_jis.getEncoder=function(e){return new function(e){e.fatal,this.encode=function(e,o){var a=o.get();if(a===i)return r;if(o.offset(1),t(a,0,128))return e.emit(a);if(165===a)return e.emit(92);if(8254===a)return e.emit(126);if(t(a,65377,65439))return e.emit(a-65377+161);var u=f(a,h.jis0208);if(null===u)return s();var l=n(u,188),c=l<31?129:193,_=u%188,y=_<63?64:65;return e.emit(l+c,_+y)}}(e)},u.shift_jis.getDecoder=function(e){return new function(e){var n=e.fatal,s=0;this.decode=function(e){var a=e.get();if(a===r&&0===s)return i;if(a===r&&0!==s)return s=0,o(n);if(e.offset(1),0!==s){var u=s;if(s=0,t(a,64,126)||t(a,128,252)){var l=c(188*(u-(u<160?129:193))+a-(a<127?64:65),h.jis0208);return null===l?o(n):l}return e.offset(-1),o(n)}return t(a,0,128)?a:t(a,161,223)?65377+a-161:t(a,129,159)||t(a,224,252)?(s=a,null):o(n)}}(e)},u["euc-kr"].getEncoder=function(e){return new function(e){e.fatal,this.encode=function(e,o){var a=o.get();if(a===i)return r;if(o.offset(1),t(a,0,127))return e.emit(a);var u,l,c=f(a,h["euc-kr"]);if(null===c)return s();if(c<12460){u=n(c,178)+129;var _=(l=c%178)<26?65:l<52?71:77;return e.emit(u,l+_)}return u=n(c-=12460,94)+199,l=c%94+161,e.emit(u,l)}}(e)},u["euc-kr"].getDecoder=function(e){return new function(e){var n=e.fatal,s=0;this.decode=function(e){var a=e.get();if(a===r&&0===s)return i;if(a===r&&0!==s)return s=0,o(n);if(e.offset(1),0!==s){var u=s,l=null;if(s=0,t(u,129,198)){var f=178*(u-129);t(a,65,90)?l=f+a-65:t(a,97,122)?l=f+26+a-97:t(a,129,254)&&(l=f+26+26+a-129)}t(u,199,253)&&t(a,161,254)&&(l=12460+94*(u-199)+(a-161));var _=null===l?null:c(l,h["euc-kr"]);return null===l&&e.offset(-1),null===_?o(n):_}return t(a,0,127)?a:t(a,129,253)?(s=a,null):o(n)}}(e)},u["iso-2022-kr"].getEncoder=function(e){return new function(e){e.fatal;var o=0,a=1,u=!1,l=o;this.encode=function(e,c){var _=c.get();if(_===i)return r;if(u||(u=!0,e.emit(27,36,41,67)),c.offset(1),t(_,0,127)&&l!==o)return c.offset(-1),l=o,e.emit(15);if(t(_,0,127))return e.emit(_);if(l!==a)return c.offset(-1),l=a,e.emit(14);var y,d,p=f(_,h["euc-kr"]);return null===p?s():p<12460?(d=p%178-26-26+1,t(y=n(p,178)+1,33,70)&&t(d,33,126)?e.emit(y,d):s()):(d=(p-=12460)%94+33,t(y=n(p,94)+71,71,126)&&t(d,33,126)?e.emit(y,d):s())}}(e)},u["iso-2022-kr"].getDecoder=function(e){return new function(e){var n=e.fatal,s=0,a=1,u=2,l=3,f=4,_=5,y=s,d=0;this.decode=function(e){var p=e.get();switch(p!==r&&e.offset(1),y){default:case s:return 14===p?(y=f,null):15===p?null:27===p?(y=a,null):t(p,0,127)?p:p===r?i:o(n);case a:return 36===p?(y=u,null):(p!==r&&e.offset(-1),y=s,o(n));case u:return 41===p?(y=l,null):(p===r?e.offset(-1):e.offset(-2),y=s,o(n));case l:return 67===p?(y=s,null):(p===r?e.offset(-2):e.offset(-3),y=s,o(n));case f:return 10===p?(y=s,o(n,10)):14===p?null:15===p?(y=s,null):p===r?i:(d=p,y=_,null);case _:if(y=f,p===r)return o(n);var g=null;return t(d,33,70)&&t(p,33,126)?g=c(178*(d-1)+26+26+p-1,h["euc-kr"]):t(d,71,126)&&t(p,33,126)&&(g=c(12460+94*(d-71)+(p-33),h["euc-kr"])),null!==g?g:o(n)}}}(e)},u["utf-16"].getEncoder=function(e){return new p(!1,e)},u["utf-16"].getDecoder=function(e){return new d(!1,e)},u["utf-16be"].getEncoder=function(e){return new p(!0,e)},u["utf-16be"].getDecoder=function(e){return new d(!0,e)};var g="utf-8";function b(t,n){return this&&this!==e?(t=t?String(t):g,n=Object(n),this._encoding=a(t),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(n.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new b(t,n)}function v(t,n){return this&&this!==e?(t=t?String(t):g,n=Object(n),this._encoding=a(t),this._streaming=!1,this._decoder=null,this._options={fatal:Boolean(n.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new v(t,n)}b.prototype={encode:function(e,n){e=e?String(e):"",n=Object(n),this._streaming||(this._encoder=this._encoding.getEncoder(this._options)),this._streaming=Boolean(n.stream);for(var o=[],s=new function(e){var t=0;this.emit=function(n){var i,o=r;for(i=0;i<arguments.length;++i)o=Number(arguments[i]),e[t++]=o;return o}}(o),a=new function(e){var n=0,r=function(){for(var n=[],r=0,i=e.length;r<e.length;){var o=e.charCodeAt(r);if(t(o,55296,57343))if(t(o,56320,57343))n.push(65533);else if(r===i-1)n.push(65533);else{var s=e.charCodeAt(r+1);if(t(s,56320,57343)){var a=1023&o,u=1023&s;r+=1,n.push(65536+(a<<10)+u)}else n.push(65533)}else n.push(o);r+=1}return n}();this.offset=function(e){if((n+=e)<0)throw new Error("Seeking past start of the buffer");if(n>r.length)throw new Error("Seeking past EOF")},this.get=function(){return n>=r.length?i:r[n]}}(e);a.get()!==i;)this._encoder.encode(s,a);if(!this._streaming){var u;do{u=this._encoder.encode(s,a)}while(u!==r);this._encoder=null}return new Uint8Array(o)}},v.prototype={decode:function(e,t){if(e&&!("buffer"in e&&"byteOffset"in e&&"byteLength"in e))throw new TypeError("Expected ArrayBufferView");e||(e=new Uint8Array(0)),t=Object(t),this._streaming||(this._decoder=this._encoding.getDecoder(this._options)),this._streaming=Boolean(t.stream);var n=new function(e){var t=0;this.get=function(){return t>=e.length?r:Number(e[t])},this.offset=function(n){if((t+=n)<0)throw new Error("Seeking past start of the buffer");if(t>e.length)throw new Error("Seeking past EOF")},this.match=function(n){if(n.length>t+e.length)return!1;var r;for(r=0;r<n.length;r+=1)if(Number(e[t+r])!==n[r])return!1;return!0}}(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));if(a(function(e,t){return t.match([255,254])?(t.offset(2),"utf-16"):t.match([254,255])?(t.offset(2),"utf-16be"):t.match([239,187,191])?(t.offset(3),"utf-8"):e}(this._encoding.name,n))!==this._encoding)throw new Error("BOM mismatch");for(var o,s=new function(){var e="";this.string=function(){return e},this.emit=function(t){t<=65535?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode(55296+(t>>10&1023)),e+=String.fromCharCode(56320+(1023&t)))}};n.get()!==r;)null!==(o=this._decoder.decode(n))&&o!==i&&s.emit(o);if(!this._streaming){do{null!==(o=this._decoder.decode(n))&&o!==i&&s.emit(o)}while(o!==i);this._decoder=null}return s.string()}},e.TextEncoder=e.TextEncoder||b,e.TextDecoder=e.TextDecoder||v}(this)},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SFSDataSerializer=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(44),s=(r=o)&&r.__esModule?r:{default:r},a=n(67),u=n(2);var l=Symbol(),c=Symbol(),f=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t!==c)throw"SFSDataSerializer is a singleton class; you can't instantiate it"}return i(e,[{key:"object2binary",value:function(e){var t=new s.default(new ArrayBuffer(0),0,s.default.BIG_ENDIAN);return t.writeInt8(u.SFSDataType.SFS_OBJECT),t.writeInt16(e.size()),this.obj2bin(e,t),new Uint8Array(t.buffer)}},{key:"obj2bin",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,s=e.keys()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value,u=e.getWrappedItem(a);this.encodeSFSObjectKey(t,a),this.encodeObject(t,u)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}},{key:"array2binary",value:function(e){var t=new s.default(new ArrayBuffer(0),0,s.default.BIG_ENDIAN);return t.writeInt8(u.SFSDataType.SFS_ARRAY),t.writeInt16(e.size()),this.arr2bin(e,t),new Uint8Array(t.buffer)}},{key:"arr2bin",value:function(e,t){for(var n=0;n<e.size();n++){var r=e.getWrappedItem(n);this.encodeObject(t,r)}}},{key:"encodeSFSObjectKey",value:function(e,t){e.writeInt16(t.length),e.writeUint8Array(new a.TextEncoder("utf-8").encode(t))}},{key:"encodeObject",value:function(e,t){var n=t.type;if(n===u.SFSDataType.NULL)this.binEncode_NULL(e,t);else if(n===u.SFSDataType.BOOL)this.binEncode_BOOL(e,t);else if(n===u.SFSDataType.BOOL_ARRAY)this.binEncode_BOOL_ARRAY(e,t);else if(n===u.SFSDataType.BYTE)this.binEncode_BYTE(e,t);else if(n===u.SFSDataType.BYTE_ARRAY)this.binEncode_BYTE_ARRAY(e,t);else if(n===u.SFSDataType.SHORT)this.binEncode_SHORT(e,t);else if(n===u.SFSDataType.SHORT_ARRAY)this.binEncode_SHORT_ARRAY(e,t);else if(n===u.SFSDataType.INT)this.binEncode_INT(e,t);else if(n===u.SFSDataType.INT_ARRAY)this.binEncode_INT_ARRAY(e,t);else if(n===u.SFSDataType.LONG)this.binEncode_LONG(e,t);else if(n===u.SFSDataType.LONG_ARRAY)this.binEncode_LONG_ARRAY(e,t);else if(n===u.SFSDataType.FLOAT)this.binEncode_FLOAT(e,t);else if(n===u.SFSDataType.FLOAT_ARRAY)this.binEncode_FLOAT_ARRAY(e,t);else if(n===u.SFSDataType.DOUBLE)this.binEncode_DOUBLE(e,t);else if(n===u.SFSDataType.DOUBLE_ARRAY)this.binEncode_DOUBLE_ARRAY(e,t);else if(n===u.SFSDataType.UTF_STRING)this.binEncode_UTF_STRING(e,t);else if(n===u.SFSDataType.TEXT)this.binEncode_TEXT(e,t);else if(n===u.SFSDataType.UTF_STRING_ARRAY)this.binEncode_UTF_STRING_ARRAY(e,t);else if(n===u.SFSDataType.SFS_ARRAY)e.writeUint8Array(this.array2binary(t.value));else{if(n!==u.SFSDataType.SFS_OBJECT)throw"Unknow SFSDataType ID: "+n;e.writeUint8Array(this.object2binary(t.value))}return e}},{key:"binEncode_NULL",value:function(e,t){e.writeUint8(t.type)}},{key:"binEncode_BOOL",value:function(e,t){e.writeUint8(t.type),e.writeUint8(t.value?1:0)}},{key:"binEncode_BOOL_ARRAY",value:function(e,t){var n=t.value;e.writeUint8(t.type),e.writeUint16(n.length);for(var r=0;r<n.length;r++)e.writeUint8(n[r]?1:0)}},{key:"binEncode_BYTE",value:function(e,t){e.writeUint8(t.type),e.writeUint8(t.value)}},{key:"binEncode_BYTE_ARRAY",value:function(e,t){var n=t.value;e.writeUint8(t.type),e.writeUint32(n.length),e.writeUint8Array(new Uint8Array(t.value))}},{key:"binEncode_SHORT",value:function(e,t){e.writeUint8(t.type),e.writeUint16(t.value)}},{key:"binEncode_SHORT_ARRAY",value:function(e,t){var n=t.value;e.writeUint8(t.type),e.writeUint16(n.length);for(var r=0;r<n.length;r++)e.writeUint16(n[r])}},{key:"binEncode_INT",value:function(e,t){e.writeUint8(t.type),e.writeUint32(t.value)}},{key:"binEncode_INT_ARRAY",value:function(e,t){var n=t.value;e.writeUint8(t.type),e.writeUint16(n.length);for(var r=0;r<n.length;r++)e.writeUint32(n[r])}},{key:"binEncode_LONG",value:function(e,t){var n=t.value,r=Math.floor(n/Math.pow(2,32)),i=n%Math.pow(2,32);e.writeUint8(t.type),e.writeInt32(r),e.writeInt32(i)}},{key:"binEncode_LONG_ARRAY",value:function(e,t){var n=t.value;e.writeUint8(t.type),e.writeUint16(n.length);for(var r=0;r<n.length;r++){var i=n[r],o=Math.floor(i/Math.pow(2,32)),s=i%Math.pow(2,32);e.writeInt32(o),e.writeInt32(s)}}},{key:"binEncode_FLOAT",value:function(e,t){e.writeUint8(t.type),e.writeFloat32(t.value)}},{key:"binEncode_FLOAT_ARRAY",value:function(e,t){var n=t.value;e.writeUint8(t.type),e.writeUint16(n.length);for(var r=0;r<n.length;r++)e.writeFloat32(n[r])}},{key:"binEncode_DOUBLE",value:function(e,t){e.writeUint8(t.type),e.writeFloat64(t.value)}},{key:"binEncode_DOUBLE_ARRAY",value:function(e,t){var n=t.value;e.writeUint8(t.type),e.writeUint16(n.length);for(var r=0;r<n.length;r++)e.writeFloat64(n[r])}},{key:"binEncode_UTF_STRING",value:function(e,t){var n=new a.TextEncoder("utf-8").encode(t.value);e.writeUint8(t.type),e.writeUint16(n.length),e.writeUint8Array(n)}},{key:"binEncode_TEXT",value:function(e,t){var n=new a.TextEncoder("utf-8").encode(t.value);e.writeUint8(t.type),e.writeUint32(n.length),e.writeUint8Array(n)}},{key:"binEncode_UTF_STRING_ARRAY",value:function(e,t){var n=t.value;e.writeUint8(t.type),e.writeUint16(n.length);for(var r=0;r<n.length;r++){var i=new a.TextEncoder("utf-8").encode(n[r]);e.writeUint16(i.byteLength),e.writeUint8Array(i)}}},{key:"binary2object",value:function(e){if(e.byteLength<3)throw"Can't decode an SFSObject. Byte data is insufficient. Size: "+e.byteLength+" bytes";return this.decodeSFSObject(new s.default(e,0,s.default.BIG_ENDIAN))}},{key:"binary2array",value:function(e){if(e.byteLength<3)throw"Can't decode an SFSArray. Byte data is insufficient. Size: "+e.byteLength+" bytes";return this.decodeSFSArray(new s.default(e,0,s.default.BIG_ENDIAN))}},{key:"decodeSFSObject",value:function(e){var t=new u.SFSObject,n=e.readUint8();if(n!==u.SFSDataType.SFS_OBJECT)throw"Invalid SFSDataType. Expected: "+u.SFSDataType.SFS_OBJECT+", found: "+n;var r=e.readUint16();if(r<0)throw"Can't decode SFSObject. Size is negative: "+r;try{for(var i=0;i<r;i++){var o=e.readUint16();if(o<0||o>255)throw"Invalid SFSObject key length. Found: "+o;var s=e.readUint8Array(o),a=String.fromCharCode.apply(String,s),l=this.decodeObject(e);if(null==l)throw"Could not decode value for key: "+a;t.put(a,l.value,l.type,!0)}}catch(e){throw e}return t}},{key:"decodeSFSArray",value:function(e){var t=new u.SFSArray,n=e.readUint8();if(n!==u.SFSDataType.SFS_ARRAY)throw"Invalid SFSDataType. Expected: "+u.SFSDataType.SFS_ARRAY+", found: "+n;var r=e.readInt16();if(r<0)throw"Can't decode SFSArray. Size is negative: "+r;try{for(var i=0;i<r;i++){var o=this.decodeObject(e);if(null==o)throw"Could not decode value for index: "+i;t.add(o.value,o.type,!0)}}catch(e){throw e}return t}},{key:"decodeObject",value:function(e){var t=null,n=e.readUint8();if(n===u.SFSDataType.NULL)t=this.binDecode_NULL(e);else if(n===u.SFSDataType.BOOL)t=this.binDecode_BOOL(e);else if(n===u.SFSDataType.BOOL_ARRAY)t=this.binDecode_BOOL_ARRAY(e);else if(n===u.SFSDataType.BYTE)t=this.binDecode_BYTE(e);else if(n===u.SFSDataType.BYTE_ARRAY)t=this.binDecode_BYTE_ARRAY(e);else if(n===u.SFSDataType.SHORT)t=this.binDecode_SHORT(e);else if(n===u.SFSDataType.SHORT_ARRAY)t=this.binDecode_SHORT_ARRAY(e);else if(n===u.SFSDataType.INT)t=this.binDecode_INT(e);else if(n===u.SFSDataType.INT_ARRAY)t=this.binDecode_INT_ARRAY(e);else if(n===u.SFSDataType.LONG)t=this.binDecode_LONG(e);else if(n===u.SFSDataType.LONG_ARRAY)t=this.binDecode_LONG_ARRAY(e);else if(n===u.SFSDataType.FLOAT)t=this.binDecode_FLOAT(e);else if(n===u.SFSDataType.FLOAT_ARRAY)t=this.binDecode_FLOAT_ARRAY(e);else if(n===u.SFSDataType.DOUBLE)t=this.binDecode_DOUBLE(e);else if(n===u.SFSDataType.DOUBLE_ARRAY)t=this.binDecode_DOUBLE_ARRAY(e);else if(n===u.SFSDataType.UTF_STRING)t=this.binDecode_UTF_STRING(e);else if(n===u.SFSDataType.TEXT)t=this.binDecode_TEXT(e);else if(n===u.SFSDataType.UTF_STRING_ARRAY)t=this.binDecode_UTF_STRING_ARRAY(e);else if(n===u.SFSDataType.SFS_ARRAY){e.seek(e.position-1);var r=this.decodeSFSArray(e);t=new u.SFSDataWrapper(n,r)}else{if(n!==u.SFSDataType.SFS_OBJECT)throw"Unknow SFSDataType ID: "+n;e.seek(e.position-1);var i=this.decodeSFSObject(e);t=new u.SFSDataWrapper(n,i)}return t}},{key:"binDecode_NULL",value:function(e){return new u.SFSDataWrapper(u.SFSDataType.NULL,null)}},{key:"binDecode_BOOL",value:function(e){var t=e.readUint8(),n=null;if(0===t)n=!1;else{if(1!==t)throw"Error decoding Bool type. Illegal value: "+t;n=!0}return new u.SFSDataWrapper(u.SFSDataType.BOOL,n)}},{key:"binDecode_BOOL_ARRAY",value:function(e){for(var t=this.getTypedArraySize(e),n=[],r=0;r<t;r++){var i=e.readUint8(),o=null;if(0===i)o=!1;else{if(1!==i)throw"Error decoding Bool type. Illegal value: "+i;o=!0}n.push(o)}return new u.SFSDataWrapper(u.SFSDataType.BOOL_ARRAY,n)}},{key:"binDecode_BYTE",value:function(e){var t=e.readUint8();return new u.SFSDataWrapper(u.SFSDataType.BYTE,t)}},{key:"binDecode_BYTE_ARRAY",value:function(e){var t=e.readInt32();if(t<0)throw"Error decoding typed array size. Negative size: "+t;for(var n=[],r=0;r<t;r++)n.push(e.readUint8());return new u.SFSDataWrapper(u.SFSDataType.BYTE_ARRAY,n)}},{key:"binDecode_SHORT",value:function(e){var t=e.readInt16();return new u.SFSDataWrapper(u.SFSDataType.SHORT,t)}},{key:"binDecode_SHORT_ARRAY",value:function(e){for(var t=this.getTypedArraySize(e),n=[],r=0;r<t;r++)n.push(e.readInt16());return new u.SFSDataWrapper(u.SFSDataType.SHORT_ARRAY,n)}},{key:"binDecode_INT",value:function(e){var t=e.readInt32();return new u.SFSDataWrapper(u.SFSDataType.INT,t)}},{key:"binDecode_INT_ARRAY",value:function(e){for(var t=this.getTypedArraySize(e),n=[],r=0;r<t;r++)n.push(e.readInt32());return new u.SFSDataWrapper(u.SFSDataType.INT_ARRAY,n)}},{key:"binDecode_LONG",value:function(e){var t=e.readInt32(),n=e.readUint32(),r=t*Math.pow(2,32)+n;return new u.SFSDataWrapper(u.SFSDataType.LONG,r)}},{key:"binDecode_LONG_ARRAY",value:function(e){for(var t=this.getTypedArraySize(e),n=[],r=0;r<t;r++){var i=e.readInt32(),o=e.readUint32(),s=i*Math.pow(2,32)+o;n.push(s)}return new u.SFSDataWrapper(u.SFSDataType.LONG_ARRAY,n)}},{key:"binDecode_FLOAT",value:function(e){var t=e.readFloat32();return new u.SFSDataWrapper(u.SFSDataType.FLOAT,t)}},{key:"binDecode_FLOAT_ARRAY",value:function(e){for(var t=this.getTypedArraySize(e),n=[],r=0;r<t;r++)n.push(e.readFloat32());return new u.SFSDataWrapper(u.SFSDataType.FLOAT_ARRAY,n)}},{key:"binDecode_DOUBLE",value:function(e){var t=e.readFloat64();return new u.SFSDataWrapper(u.SFSDataType.DOUBLE,t)}},{key:"binDecode_DOUBLE_ARRAY",value:function(e){for(var t=this.getTypedArraySize(e),n=[],r=0;r<t;r++)n.push(e.readFloat64());return new u.SFSDataWrapper(u.SFSDataType.DOUBLE_ARRAY,n)}},{key:"binDecode_UTF_STRING",value:function(e){var t=e.readInt16();if(t<0)throw"Error decoding UTF_STRING. Negative size: "+t;var n=e.readUint8Array(t),r=new a.TextDecoder("utf-8").decode(n);return new u.SFSDataWrapper(u.SFSDataType.UTF_STRING,r)}},{key:"binDecode_UTF_STRING_ARRAY",value:function(e){for(var t=this.getTypedArraySize(e),n=[],r=0;r<t;r++){var i=e.readInt16();if(i<0)throw"Error decoding UTF_STRING. Negative size: "+i;var o=e.readUint8Array(i),s=new a.TextDecoder("utf-8").decode(o);n.push(s)}return new u.SFSDataWrapper(u.SFSDataType.UTF_STRING_ARRAY,n)}},{key:"binDecode_TEXT",value:function(e){var t=e.readInt32();if(t<0)throw"Error decoding TEXT. Negative size: "+t;var n=e.readUint8Array(t),r=new a.TextDecoder("utf-8").decode(n);return new u.SFSDataWrapper(u.SFSDataType.TEXT,r)}},{key:"getTypedArraySize",value:function(e){var t=e.readUint16();if(t<0)throw"Error decoding typed array size. Negative size: "+t;return t}}],[{key:"instance",get:function(){return this[l]||(this[l]=new e(c)),Object.seal(this[l])}}]),e}();t.SFSDataSerializer=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SystemController=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(4),s=n(20),a=n(2),u=n(3),l=n(7),c=n(66),f=n(13),h=n(18),_=n(14),y=n(9),d=n(19),p=n(6),g=n(11),b=n(42),v=n(41),m=n(40),S=n(17),E=n(39),R=n(38),O=n(37),A=n(16),w=n(36),T=n(35),I=n(34),k=n(33),M=n(32),P=n(31),U=n(30),j=n(29),D=n(15),N=n(64),F=n(28),B=n(27),L=n(26),Y=n(25),C=n(24),q=n(23),V=n(22);var K=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._sfs=t,this._logger=t.logger,this._id=0,this._messageHandlers=new Map,this._initMessageHandlers(),Object.freeze(this)}return r(e,null,[{key:"KEY_ERROR_CODE",get:function(){return"ec"}},{key:"KEY_ERROR_PARAMS",get:function(){return"ep"}},{key:"ROOM_PARAM",get:function(){return"r"}},{key:"USER_PARAM",get:function(){return"u"}},{key:"USER_COUNT_PARAM",get:function(){return"uc"}},{key:"SPECT_COUNT_PARAM",get:function(){return"sc"}},{key:"DISCONNECTION_REASON_PARAM",get:function(){return"dr"}}]),r(e,[{key:"handleMessage",value:function(e,t){var n=this._messageHandlers.get(t);null!=n?(this._sfs.debug&&this._logger.info("Handling server event: "+n.name+" ("+t+")"),n.handler.call(this,e)):this._logger.warn("Unknown server event received; id: "+t)}},{key:"_initMessageHandlers",value:function(){this._setHandler(i.Requests.Handshake,this._fnHandshake),this._setHandler(i.Requests.Login,this._fnLogin),this._setHandler(i.Requests.Logout,this._fnLogout),this._setHandler(i.Requests.JoinRoom,this._fnJoinRoom),this._setHandler(i.Requests.CreateRoom,this._fnCreateRoom),this._setHandler(i.Requests.ChangeRoomName,this._fnChangeRoomName),this._setHandler(i.Requests.ChangeRoomPassword,this._fnChangeRoomPassword),this._setHandler(i.Requests.ChangeRoomCapacity,this._fnChangeRoomCapacity),this._setHandler(i.Requests.GenericMessage,this._fnGenericMessage),this._setHandler(i.Requests.SetRoomVariables,this._fnSetRoomVariables),this._setHandler(i.Requests.SetUserVariables,this._fnSetUserVariables),this._setHandler(i.Requests.SubscribeRoomGroup,this._fnSubscribeRoomGroup),this._setHandler(i.Requests.UnsubscribeRoomGroup,this._fnUnsubscribeRoomGroup),this._setHandler(i.Requests.SpectatorToPlayer,this._fnSpectatorToPlayer),this._setHandler(i.Requests.PlayerToSpectator,this._fnPlayerToSpectator),this._setHandler(i.Requests.FindRooms,this._fnFindRooms),this._setHandler(i.Requests.FindUsers,this._fnFindUsers),this._setHandler(i.Requests.PingPong,this._fnPingPong),this._setHandler(i.Requests.InitBuddyList,this._fnInitBuddyList),this._setHandler(i.Requests.AddBuddy,this._fnAddBuddy),this._setHandler(i.Requests.RemoveBuddy,this._fnRemoveBuddy),this._setHandler(i.Requests.BlockBuddy,this._fnBlockBuddy),this._setHandler(i.Requests.GoOnline,this._fnGoOnline),this._setHandler(i.Requests.SetBuddyVariables,this._fnSetBuddyVariables),this._setHandler(i.Requests.QuickJoinGame,this._fnQuickJoinGame),this._setHandler(i.Requests.InviteUsers,this._fnInviteUsers),this._setHandler(i.Requests.InvitationReply,this._fnInvitationReply),this._setHandler(i.Requests.SetUserPosition,this._fnSetUserPosition),this._setHandler(1e3,this._fnUserEnterRoom,"UserEnterRoom"),this._setHandler(1001,this._fnUserCountChange,"UserCountChange"),this._setHandler(1002,this._fnUserLost,"UserLost"),this._setHandler(1003,this._fnRoomLost,"RoomLost"),this._setHandler(1004,this._fnUserExitRoom,"UserExitRoom"),this._setHandler(1005,this._fnClientDisconnection,"ClientDisconnection"),this._setHandler(1007,this._fnSetMMOItemVariables,"SetMMOItemVariables")}},{key:"_setHandler",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null==n&&(n=i.Requests.getNameFromId(e)),this._messageHandlers.set(e,{name:n,handler:t})}},{key:"_fnHandshake",value:function(e){this._sfs._handleHandShake(e)}},{key:"_fnLogin",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){this._populateRoomList(t.get(b.LoginRequest.KEY_ROOMLIST)),this._sfs._mySelf=new l.SFSUser(t.get(b.LoginRequest.KEY_ID),t.get(b.LoginRequest.KEY_USER_NAME),!0),this._sfs.mySelf._setUserManager(this._sfs.userManager),this._sfs.mySelf._privilegeId=t.get(b.LoginRequest.KEY_PRIVILEGE_ID),this._sfs.userManager._addUser(this._sfs.mySelf);var n={};n.zone=t.get(b.LoginRequest.KEY_ZONE_NAME),n.user=this._sfs.mySelf,n.data=t.get(b.LoginRequest.KEY_PARAMS),this._sfs.dispatchEvent(o.SFSEvent.LOGIN,n)}else this._dispatchError(o.SFSEvent.LOGIN_ERROR,t)}},{key:"_fnLogout",value:function(e){this._sfs._handleLogout();var t={};t.zone=e.get(v.LogoutRequest.KEY_ZONE_NAME),this._sfs.dispatchEvent(o.SFSEvent.LOGOUT,t)}},{key:"_fnJoinRoom",value:function(t){if(this._sfs._isJoining=!1,null==t.get(e.KEY_ERROR_CODE)){var n=t.get(m.JoinRoomRequest.KEY_ROOM),r=t.get(m.JoinRoomRequest.KEY_USER_LIST),i=this._sfs.roomManager,s=u.SFSRoom.fromSFSArray(n);s=i._replaceRoom(s,i.containsGroup(s.groupId));for(var a=0;a<r.size();a++){var l=r.get(a),c=this._getOrCreateUser(l,!0,s);s._addUser(c)}s._isJoined=!0,this._sfs._lastJoinedRoom=s;var f={};f.room=s,this._sfs.dispatchEvent(o.SFSEvent.ROOM_JOIN,f)}else this._dispatchError(o.SFSEvent.ROOM_JOIN_ERROR,t)}},{key:"_fnCreateRoom",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=u.SFSRoom.fromSFSArray(t.get(S.CreateRoomRequest.KEY_ROOM));this._sfs.roomManager._addRoom(n);var r={};r.room=n,this._sfs.dispatchEvent(o.SFSEvent.ROOM_ADD,r)}else this._dispatchError(o.SFSEvent.ROOM_CREATION_ERROR,t)}},{key:"_fnChangeRoomName",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(E.ChangeRoomNameRequest.KEY_ROOM),r=this._sfs.roomManager.getRoomById(n);if(null!=r){var i=r.name;this._sfs.roomManager._changeRoomName(r,t.get(E.ChangeRoomNameRequest.KEY_NAME));var s={};s.oldName=i,s.room=r,this._sfs.dispatchEvent(o.SFSEvent.ROOM_NAME_CHANGE,s)}else this._logger.warn("Unexpected RoomNameChange event error; unknown Room id: "+n)}else this._dispatchError(o.SFSEvent.ROOM_NAME_CHANGE_ERROR,t)}},{key:"_fnChangeRoomPassword",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(R.ChangeRoomPasswordStateRequest.KEY_ROOM),r=this._sfs.roomManager.getRoomById(n);if(null!=r){this._sfs.roomManager._changeRoomPasswordState(r,t.get(R.ChangeRoomPasswordStateRequest.KEY_PASS));var i={};i.room=r,this._sfs.dispatchEvent(o.SFSEvent.ROOM_PASSWORD_STATE_CHANGE,i)}else this._logger.warn("Unexpected RoomPasswordChange event error; unknown Room id: "+n)}else this._dispatchError(o.SFSEvent.ROOM_PASSWORD_STATE_CHANGE_ERROR,t)}},{key:"_fnChangeRoomCapacity",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(O.ChangeRoomCapacityRequest.KEY_ROOM),r=this._sfs.roomManager.getRoomById(n);if(null!=r){this._sfs.roomManager._changeRoomCapacity(r,t.get(O.ChangeRoomCapacityRequest.KEY_USER_SIZE),t.get(O.ChangeRoomCapacityRequest.KEY_SPEC_SIZE));var i={};i.room=r,this._sfs.dispatchEvent(o.SFSEvent.ROOM_CAPACITY_CHANGE,i)}else this._logger.warn("Unexpected RoomCapacityChange event error; unknown Room id: "+n)}else this._dispatchError(o.SFSEvent.ROOM_CAPACITY_CHANGE_ERROR,t)}},{key:"_fnGenericMessage",value:function(e){switch(e.get(A.GenericMessageRequest.KEY_MESSAGE_TYPE)){case A.GenericMessageType.PUBLIC_MSG:this._handlePublicMessage(e);break;case A.GenericMessageType.PRIVATE_MSG:this._handlePrivateMessage(e);break;case A.GenericMessageType.BUDDY_MSG:this._handleBuddyMessage(e);break;case A.GenericMessageType.MODERATOR_MSG:this._handleModMessage(e);break;case A.GenericMessageType.ADMING_MSG:this._handleAdminMessage(e);break;case A.GenericMessageType.OBJECT_MSG:this._handleObjectMessage(e)}}},{key:"_handlePublicMessage",value:function(e){var t=e.get(A.GenericMessageRequest.KEY_ROOM_ID),n=this._sfs.roomManager.getRoomById(t);if(null!=n){var r={};r.room=n,r.sender=this._sfs.userManager.getUserById(e.get(A.GenericMessageRequest.KEY_USER_ID)),r.message=e.get(A.GenericMessageRequest.KEY_MESSAGE),r.data=e.get(A.GenericMessageRequest.KEY_XTRA_PARAMS),this._sfs.dispatchEvent(o.SFSEvent.PUBLIC_MESSAGE,r)}else this._logger.warn("Unexpected PublicMessage event error; unknown Room id: "+t)}},{key:"_handlePrivateMessage",value:function(e){var t=e.get(A.GenericMessageRequest.KEY_USER_ID),n=this._sfs.userManager.getUserById(t);if(null==n){if(null==e.get(A.GenericMessageRequest.KEY_SENDER_DATA))return void this._logger.warn("Unexpected PublicMessage event error; missing sender details");n=l.SFSUser.fromSFSArray(e.get(A.GenericMessageRequest.KEY_SENDER_DATA))}var r={};r.sender=n,r.message=e.get(A.GenericMessageRequest.KEY_MESSAGE),r.data=e.get(A.GenericMessageRequest.KEY_XTRA_PARAMS),this._sfs.dispatchEvent(o.SFSEvent.PRIVATE_MESSAGE,r)}},{key:"_handleBuddyMessage",value:function(e){var t=e.get(A.GenericMessageRequest.KEY_USER_ID),n=this._sfs.buddyManager.getBuddyById(t),r={};r.isItMe=this._sfs.mySelf.id===t,r.buddy=n,r.message=e.get(A.GenericMessageRequest.KEY_MESSAGE),r.data=e.get(A.GenericMessageRequest.KEY_XTRA_PARAMS),this._sfs.dispatchEvent(o.SFSBuddyEvent.BUDDY_MESSAGE,r)}},{key:"_handleObjectMessage",value:function(e){var t={};t.sender=this._sfs.userManager.getUserById(e.get(A.GenericMessageRequest.KEY_USER_ID)),t.message=e.get(A.GenericMessageRequest.KEY_XTRA_PARAMS),this._sfs.dispatchEvent(o.SFSEvent.OBJECT_MESSAGE,t)}},{key:"_handleModMessage",value:function(e){var t={};t.sender=l.SFSUser.fromSFSArray(e.get(A.GenericMessageRequest.KEY_SENDER_DATA)),t.message=e.get(A.GenericMessageRequest.KEY_MESSAGE),t.data=e.get(A.GenericMessageRequest.KEY_XTRA_PARAMS),this._sfs.dispatchEvent(o.SFSEvent.MODERATOR_MESSAGE,t)}},{key:"_handleAdminMessage",value:function(e){var t={};t.sender=l.SFSUser.fromSFSArray(e.get(A.GenericMessageRequest.KEY_SENDER_DATA)),t.message=e.get(A.GenericMessageRequest.KEY_MESSAGE),t.data=e.get(A.GenericMessageRequest.KEY_XTRA_PARAMS),this._sfs.dispatchEvent(o.SFSEvent.ADMIN_MESSAGE,t)}},{key:"_fnSetRoomVariables",value:function(e){var t=e.get(w.SetRoomVariablesRequest.KEY_VAR_ROOM),n=e.get(w.SetRoomVariablesRequest.KEY_VAR_LIST),r=this._sfs.roomManager.getRoomById(t),i=new Set;if(null!=r){for(var s=0;s<n.size();s++){var a=y.SFSRoomVariable.fromSFSArray(n.get(s));r._setVariable(a),i.add(a.name)}var u={};u.changedVars=Array.from(i),u.room=r,this._sfs.dispatchEvent(o.SFSEvent.ROOM_VARIABLES_UPDATE,u)}else this._logger.warn("Unexpected RoomVariablesUpdate event error; unknown Room id: "+t)}},{key:"_fnSetUserVariables",value:function(e){var t=e.get(T.SetUserVariablesRequest.KEY_USER),n=e.get(T.SetUserVariablesRequest.KEY_VAR_LIST),r=this._sfs.userManager.getUserById(t),i=new Set;if(null!=r){for(var s=0;s<n.size();s++){var a=_.SFSUserVariable.fromSFSArray(n.get(s));r._setVariable(a),i.add(a.name)}var u={};u.changedVars=Array.from(i),u.user=r,this._sfs.dispatchEvent(o.SFSEvent.USER_VARIABLES_UPDATE,u)}else this._logger.warn("Unexpected UserVariablesUpdate event error; unknown User id: "+t)}},{key:"_fnSubscribeRoomGroup",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(I.SubscribeRoomGroupRequest.KEY_GROUP_ID),r=t.get(I.SubscribeRoomGroupRequest.KEY_ROOM_LIST);this._sfs.roomManager.containsGroup(n)&&this._logger.warn("Unexpected SubscribeRoomGroup event error; group already subscribed: "+n),this._populateRoomList(r);var i={};i.groupId=n,i.newRooms=this._sfs.roomManager.getRoomListFromGroup(n),this._sfs.dispatchEvent(o.SFSEvent.ROOM_GROUP_SUBSCRIBE,i)}else this._dispatchError(o.SFSEvent.ROOM_GROUP_SUBSCRIBE_ERROR,t)}},{key:"_fnUnsubscribeRoomGroup",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(k.UnsubscribeRoomGroupRequest.KEY_GROUP_ID);this._sfs.roomManager.containsGroup(n)||this._logger.warn("Unexpected UnsubscribeRoomGroup event error; group not found: "+n+" (maybe never subscribed, or the Room Manager doesn't contain Rooms belonging to that Group)"),this._sfs.roomManager._removeGroup(n);var r={};r.groupId=n,this._sfs.dispatchEvent(o.SFSEvent.ROOM_GROUP_UNSUBSCRIBE,r)}else this._dispatchError(o.SFSEvent.ROOM_GROUP_UNSUBSCRIBE_ERROR,t)}},{key:"_fnSpectatorToPlayer",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(M.SpectatorToPlayerRequest.KEY_ROOM_ID),r=t.get(M.SpectatorToPlayerRequest.KEY_USER_ID),i=t.get(M.SpectatorToPlayerRequest.KEY_PLAYER_ID),s=this._sfs.userManager.getUserById(r),a=this._sfs.roomManager.getRoomById(n);if(null!=a)if(null!=s)if(s.isJoinedInRoom(a)){s._setPlayerId(i,a);var u={};u.room=a,u.user=s,u.playerId=i,this._sfs.dispatchEvent(o.SFSEvent.SPECTATOR_TO_PLAYER,u)}else this._logger.warn("Unexpected SpectatorToPlayer event error; User "+s+" not in Room "+a);else this._logger.warn("Unexpected SpectatorToPlayer event error; unknown User id: "+r);else this._logger.warn("Unexpected SpectatorToPlayer event error; unknown Room id: "+n)}else this._dispatchError(o.SFSEvent.SPECTATOR_TO_PLAYER_ERROR,t)}},{key:"_fnPlayerToSpectator",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(P.PlayerToSpectatorRequest.KEY_ROOM_ID),r=t.get(P.PlayerToSpectatorRequest.KEY_USER_ID),i=this._sfs.userManager.getUserById(r),s=this._sfs.roomManager.getRoomById(n);if(null!=s)if(null!=i)if(i.isJoinedInRoom(s)){i._setPlayerId(-1,s);var a={};a.room=s,a.user=i,this._sfs.dispatchEvent(o.SFSEvent.PLAYER_TO_SPECTATOR,a)}else this._logger.warn("Unexpected PlayerToSpectator event error; User "+i+" not in Room "+s);else this._logger.warn("Unexpected SpectatorToPlayer event error; unknown User id: "+r);else this._logger.warn("Unexpected SpectatorToPlayer event error; unknown Room id: "+n)}else this._dispatchError(o.SFSEvent.PLAYER_TO_SPECTATOR_ERROR,t)}},{key:"_fnPingPong",value:function(e){var t={};t.lagValue=this._sfs._lagMonitor._onPingPong(),this._sfs.dispatchEvent(o.SFSEvent.PING_PONG,t)}},{key:"_fnFindRooms",value:function(e){for(var t=e.get(U.FindRoomsRequest.KEY_FILTERED_ROOMS),n=[],r=0;r<t.size();r++){var i=t.get(r),s=u.SFSRoom.fromSFSArray(i),a=this._sfs.roomManager.getRoomById(s.id);null!=a&&(s._isJoined=a._isJoined),n.push(s)}var l={};l.rooms=n,this._sfs.dispatchEvent(o.SFSEvent.ROOM_FIND_RESULT,l)}},{key:"_fnFindUsers",value:function(e){for(var t=e.get(j.FindUsersRequest.KEY_FILTERED_USERS),n=[],r=this._sfs.mySelf,i=0;i<t.size();i++){var s=t.get(i),a=l.SFSUser.fromSFSArray(s);a.id===r.id&&(a=r),n.push(a)}var u={};u.users=n,this._sfs.dispatchEvent(o.SFSEvent.USER_FIND_RESULT,u)}},{key:"_fnQuickJoinGame",value:function(t){null!=t.get(e.KEY_ERROR_CODE)&&this._dispatchError(o.SFSEvent.ROOM_JOIN_ERROR,t)}},{key:"_fnInviteUsers",value:function(e){var t=null;t=null!=e.get(D.InviteUsersRequest.KEY_USER_ID)?this._sfs.userManager.getUserById(e.get(D.InviteUsersRequest.KEY_USER_ID)):l.SFSUser.fromSFSArray(e.get(D.InviteUsersRequest.KEY_USER));var n=e.get(D.InviteUsersRequest.KEY_TIME),r=e.get(D.InviteUsersRequest.KEY_INVITATION_ID),i=e.get(D.InviteUsersRequest.KEY_PARAMS),s=new h.SFSInvitation(t,this._sfs.mySelf,n,i);s._id=r;var a={};a.invitation=s,this._sfs.dispatchEvent(o.SFSEvent.INVITATION,a)}},{key:"_fnInvitationReply",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=null;n=null!=t.get(D.InviteUsersRequest.KEY_USER_ID)?this._sfs.userManager.getUserById(t.get(D.InviteUsersRequest.KEY_USER_ID)):l.SFSUser.fromSFSArray(t.get(D.InviteUsersRequest.KEY_USER));var r=t.get(D.InviteUsersRequest.KEY_REPLY_ID),i=t.get(D.InviteUsersRequest.KEY_PARAMS),s={};s.invitee=n,s.reply=r,s.data=i,this._sfs.dispatchEvent(o.SFSEvent.INVITATION_REPLY,s)}else this._dispatchError(o.SFSEvent.INVITATION_REPLY_ERROR,t)}},{key:"_fnSetUserPosition",value:function(e){var t=e.get(F.SetUserPositionRequest.KEY_ROOM),n=this._sfs.roomManager.getRoomById(t),r=e.get(F.SetUserPositionRequest.KEY_MINUS_USER_LIST),i=e.get(F.SetUserPositionRequest.KEY_PLUS_USER_LIST),s=e.get(F.SetUserPositionRequest.KEY_MINUS_ITEM_LIST),u=e.get(F.SetUserPositionRequest.KEY_PLUS_ITEM_LIST),l=[],f=[],h=[],_=[];if(null!=r){var y=!0,d=!1,p=void 0;try{for(var g,b=r[Symbol.iterator]();!(y=(g=b.next()).done);y=!0){var v=g.value,m=n.getUserById(v);null!=m&&(n._removeUser(m),f.push(m))}}catch(e){d=!0,p=e}finally{try{!y&&b.return&&b.return()}finally{if(d)throw p}}}if(null!=i)for(var S=0;S<i.size();S++){var E=i.get(S),R=this._getOrCreateUser(E,!0,n);l.push(R),n._addUser(R);var O=E.get(5);null!=O&&(R._aoiEntryPoint=a.Vec3D.fromArray(O))}if(null!=s){var A=!0,w=!1,T=void 0;try{for(var I,k=s[Symbol.iterator]();!(A=(I=k.next()).done);A=!0){var M=I.value,P=n.getMMOItem(M);null!=P&&(n._removeItem(P.id),_.push(P))}}catch(e){w=!0,T=e}finally{try{!A&&k.return&&k.return()}finally{if(w)throw T}}}if(null!=u)for(var U=0;U<u.size();U++){var j=u.get(U),D=c.MMOItem.fromSFSArray(j);h.push(D),n._addMMOItem(D);var N=j.get(2);null!=N&&(D._aoiEntryPoint=a.Vec3D.fromArray(N))}var B={};B.addedItems=h,B.removedItems=_,B.removedUsers=f,B.addedUsers=l,B.room=n,this._sfs.dispatchEvent(o.SFSEvent.PROXIMITY_LIST_UPDATE,B)}},{key:"_fnInitBuddyList",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(B.InitBuddyListRequest.KEY_BLIST),r=t.get(B.InitBuddyListRequest.KEY_MY_VARS),i=t.get(B.InitBuddyListRequest.KEY_BUDDY_STATES);this._sfs.buddyManager._clearAll();for(var s=0;s<n.size();s++){var a=f.SFSBuddy.fromSFSArray(n.get(s));this._sfs.buddyManager._addBuddy(a)}null!=i&&this._sfs.buddyManager._setBuddyStates(i);for(var u=[],l=0;l<r.size();l++){var c=p.SFSBuddyVariable.fromSFSArray(r.get(l));u.push(c)}this._sfs.buddyManager._setMyVariables(u),this._sfs.buddyManager._setInited();var h={};h.buddyList=this._sfs.buddyManager.getBuddyList(),h.myVariables=this._sfs.buddyManager.getMyVariables(),this._sfs.dispatchEvent(o.SFSBuddyEvent.BUDDY_LIST_INIT,h)}else this._dispatchError(o.SFSBuddyEvent.BUDDY_ERROR,t)}},{key:"_fnAddBuddy",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=f.SFSBuddy.fromSFSArray(t.get(L.AddBuddyRequest.KEY_BUDDY_NAME));this._sfs.buddyManager._addBuddy(n);var r={};r.buddy=n,this._sfs.dispatchEvent(o.SFSBuddyEvent.BUDDY_ADD,r)}else this._dispatchError(o.SFSBuddyEvent.BUDDY_ERROR,t)}},{key:"_fnRemoveBuddy",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(Y.RemoveBuddyRequest.KEY_BUDDY_NAME),r=this._sfs.buddyManager._removeBuddyByName(n);if(null!=r){var i={};i.buddy=r,this._sfs.dispatchEvent(o.SFSBuddyEvent.BUDDY_REMOVE,i)}else this._logger.warn("Unexpected RemoveBuddy event error; can't find "+n+" in local buddy list")}else this._dispatchError(o.SFSBuddyEvent.BUDDY_ERROR,t)}},{key:"_fnBlockBuddy",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(C.BlockBuddyRequest.KEY_BUDDY_NAME),r=this._sfs.buddyManager.getBuddyByName(n);null!=t.get(C.BlockBuddyRequest.KEY_BUDDY)?(r=f.SFSBuddy.fromSFSArray(t.get(C.BlockBuddyRequest.KEY_BUDDY)),this._sfs.buddyManager._addBuddy(r)):null!=r?r._isBlocked=t.get(C.BlockBuddyRequest.KEY_BUDDY_BLOCK_STATE):this._logger.warn("Unexpected BlockBuddy event error; can't find "+n+" in local buddy list");var i={};i.buddy=r,this._sfs.dispatchEvent(o.SFSBuddyEvent.BUDDY_BLOCK,i)}else this._dispatchError(o.SFSBuddyEvent.BUDDY_ERROR,t)}},{key:"_fnGoOnline",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){var n=t.get(q.GoOnlineRequest.KEY_BUDDY_NAME),r=this._sfs.buddyManager.getBuddyByName(n),i=n===this._sfs.mySelf.name,s=t.get(q.GoOnlineRequest.KEY_ONLINE),a=s===f.BuddyOnlineState.ONLINE,u=!0;if(i)this._sfs.buddyManager.getMyOnlineState()!=a&&(this._logger.warn("Unexpected GoOnline event error; current user's online state is not in synch with the server; resynching to: "+a),this._sfs.buddyManager._setMyOnlineState(a));else{if(null==r)return void this._logger.warn("Unexpected GoOnline event error; can't find "+n+" in local buddy list");r._id=t.get(q.GoOnlineRequest.KEY_BUDDY_ID),r._setVariable(new p.SFSBuddyVariable(p.ReservedBuddyVariables.BV_ONLINE,a)),s===f.BuddyOnlineState.LEFT_THE_SERVER&&r._clearVolatileVariables(),u=this._sfs.buddyManager.getMyOnlineState()}if(u){var l={};l.buddy=r,l.isItMe=i,this._sfs.dispatchEvent(o.SFSBuddyEvent.BUDDY_ONLINE_STATE_CHANGE,l)}}else this._dispatchError(o.SFSBuddyEvent.BUDDY_ERROR,t)}},{key:"_fnSetBuddyVariables",value:function(t){if(null==t.get(e.KEY_ERROR_CODE)){for(var n=t.get(V.SetBuddyVariablesRequest.KEY_BUDDY_NAME),r=t.get(V.SetBuddyVariablesRequest.KEY_BUDDY_VARS),i=this._sfs.buddyManager.getBuddyByName(n),s=n===this._sfs.mySelf.name,a=[],u=[],l=!0,c=0;c<r.size();c++){var f=p.SFSBuddyVariable.fromSFSArray(r.get(c));u.push(f),a.push(f.name)}if(s)this._sfs.buddyManager._setMyVariables(u);else{if(null==i)return void this._logger.warn("Unexpected SetBuddyVariables event error; can't find "+n+" in local buddy list");i._setVariables(u),l=this._sfs.buddyManager.getMyOnlineState()}if(l){var h={};h.buddy=i,h.isItMe=s,h.changedVars=a,this._sfs.dispatchEvent(o.SFSBuddyEvent.BUDDY_VARIABLES_UPDATE,h)}}else this._dispatchError(o.SFSBuddyEvent.BUDDY_ERROR,t)}},{key:"_fnUserEnterRoom",value:function(t){var n=this._sfs.roomManager.getRoomById(t.get(e.ROOM_PARAM));if(null!=n){var r=t.get(e.USER_PARAM),i=this._getOrCreateUser(r,!0,n);n._addUser(i);var s={};s.user=i,s.room=n,this._sfs.dispatchEvent(o.SFSEvent.USER_ENTER_ROOM,s)}}},{key:"_fnUserCountChange",value:function(t){var n=this._sfs.roomManager.getRoomById(t.get(e.ROOM_PARAM));if(null!=n){var r=t.get(e.USER_COUNT_PARAM),i=null!=t.get(e.SPECT_COUNT_PARAM)?t.get(e.SPECT_COUNT_PARAM):0;n._userCount=r,n._specCount=i;var s={};s.room=n,s.uCount=r,s.sCount=i,this._sfs.dispatchEvent(o.SFSEvent.USER_COUNT_CHANGE,s)}}},{key:"_fnUserLost",value:function(t){var n=this._sfs.userManager.getUserById(t.get(e.USER_PARAM));if(null!=n){var r=this._sfs.roomManager.getUserRooms(n);this._sfs.roomManager._removeUser(n),this._sfs.userManager._removeUserReference(n,!0);var i=!0,s=!1,a=void 0;try{for(var u,l=r[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var c=u.value,f={};f.user=n,f.room=c,this._sfs.dispatchEvent(o.SFSEvent.USER_EXIT_ROOM,f)}}catch(e){s=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw a}}}}},{key:"_fnRoomLost",value:function(t){var n=this._sfs.roomManager.getRoomById(t.get(e.ROOM_PARAM));if(null!=n){this._sfs.roomManager._removeRoom(n);var r=!0,i=!1,s=void 0;try{for(var a,u=n.getUserList()[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var l=a.value;this._sfs.userManager._removeUser(l)}}catch(e){i=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw s}}var c={};c.room=n,this._sfs.dispatchEvent(o.SFSEvent.ROOM_REMOVE,c)}}},{key:"_fnUserExitRoom",value:function(t){var n=this._sfs.roomManager.getRoomById(t.get(e.ROOM_PARAM)),r=this._sfs.userManager.getUserById(t.get(e.USER_PARAM));if(null!=n&&null!=r){n._removeUser(r),this._sfs.userManager._removeUser(r),r.isItMe&&n.isJoined&&(n._isJoined=!1,0!==this._sfs.roomManager.getJoinedRooms().length&&this._sfs._lastJoinedRoom!==n||(this._sfs._lastJoinedRoom=null),n._isManaged||this._sfs.roomManager._removeRoom(n));var i={};i.user=r,i.room=n,this._sfs.dispatchEvent(o.SFSEvent.USER_EXIT_ROOM,i)}else this._logger.debug("Failed to handle UserExit event; Room: "+n+", User: "+r)}},{key:"_fnClientDisconnection",value:function(t){var n=t.get(e.DISCONNECTION_REASON_PARAM);this._sfs._handleClientDisconnection(g.ClientDisconnectionReason.getReason(n))}},{key:"_fnSetMMOItemVariables",value:function(e){var t=e.get(N.SetMMOItemVariables.KEY_ROOM_ID),n=e.get(N.SetMMOItemVariables.KEY_ITEM_ID),r=e.get(N.SetMMOItemVariables.KEY_VAR_LIST),i=this._sfs.roomManager.getRoomById(t),s=new Set;if(null!=i){var a=i.getMMOItem(n);if(null!=a){for(var u=0;u<r.size();u++){var l=d.MMOItemVariable.fromSFSArray(r.get(u));a._setVariable(l),s.add(l.name)}var c={};c.changedVars=Array.from(s),c.mmoItem=a,c.room=i,this._sfs.dispatchEvent(o.SFSEvent.MMOITEM_VARIABLES_UPDATE,c)}else this._logger.warn("Unexpected MMOItemVariablesUpdate event error; unknown MMOItem id: "+n)}else this._logger.warn("Unexpected MMOItemVariablesUpdate event error; unknown MMORoom id: "+t)}},{key:"_dispatchError",value:function(t,n){var r={};r.errorCode=n.get(e.KEY_ERROR_CODE),r.errorMessage=s.SFSErrorCodes.getErrorMessage(r.errorCode,n.get(e.KEY_ERROR_PARAMS)),this._sfs.dispatchEvent(t,r)}},{key:"_populateRoomList",value:function(e){for(var t=0;t<e.size();t++){var n=u.SFSRoom.fromSFSArray(e.get(t));this._sfs.roomManager._replaceRoom(n)}}},{key:"_getOrCreateUser",value:function(e,t,n){var r=e.get(0),i=this._sfs.userManager.getUserById(r);if(null==i)(i=l.SFSUser.fromSFSArray(e,n))._setUserManager(this._sfs.userManager);else{i._setPlayerId(e.get(3),n);var o=e.get(4);if(null!=o)for(var s=0;s<o.size();s++)i._setVariable(_.SFSUserVariable.fromSFSArray(o.get(s)))}return t&&this._sfs.userManager._addUser(i),i}},{key:"id",get:function(){return this._id}}]),e}();t.SystemController=K},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmartFox=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(70),o=n(63),s=n(4),a=n(0),u=n(62),l=n(43),c=n(60),f=n(59),h=n(1),_=n(58),y=n(20),d=n(10),p=n(57),g=n(11);var b=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._majVersion=1,n._minVersion=7,n._subVersion=10,n._configData=e,n._logger=d.Logger.instance,n._sessionToken=null,n._socketEngine=new u.SocketEngine(n),n._socketEngine.addEventListener(u.SocketEvent.CONNECT,n._onSocketConnect,n),n._socketEngine.addEventListener(u.SocketEvent.DISCONNECT,n._onSocketDisconnect,n),n._socketEngine.addEventListener(u.SocketEvent.DATA,n._onSocketData,n),n._socketEngine.addEventListener(u.SocketEvent.IOERROR,n._onSocketIOError,n),n._controllers={},n._controllers[0]=new i.SystemController(n),n._controllers[1]=new o.ExtensionController(n),n._reset(),n._clientDetails="JavaScript",n.debug=null!=n.config&&n.config.debug,n.debug&&(n._logger.info("SmartFox instance ready"),n._logger.info("SFS2X JavaScript API v"+n.version)),Object.seal(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EventDispatcher),r(t,[{key:"setClientDetails",value:function(e,t){if(this.isConnected)this._logger.warn("Method setClientDetails must be called before the connection is started");else{e=null!=e?e.replace(":"," "):"",t=null!=t?t.replace(":"," "):"",this._clientDetails=e+":"+t}}},{key:"connect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.debug&&this._logger.info("Attempting connection to server"),this.isConnected)this._logger.warn("Connection attempt interrupted: already connected");else if(this._socketEngine.isConnecting)this._logger.warn("Connection attempt interrupted: another attempt is already in progress");else{var r=null!=this.config&&null!=this.config.host?this.config.host:null,i=null!=this.config&&null!=this.config.port?this.config.port:null,o=null!=this.config&&this.config.useSSL;null!=e&&(r=e),t>-1&&(i=t),null!=n&&(o=n),null!=r&&"string"==typeof r&&0!==r.length?"number"!=typeof i||i<0||i>65535?this._logger.error("Invalid TCP connection port: "+i):("boolean"!=typeof o&&(o=!1),this._socketEngine.connect(r,i,o)):this._logger.error("Invalid connection host/address")}}},{key:"disconnect",value:function(){this.isConnected&&this._handleClientDisconnection(g.ClientDisconnectionReason.MANUAL)}},{key:"enableLagMonitor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;null!=this.mySelf?(null!=this._lagMonitor&&this._lagMonitor.destroy(),e&&(this._lagMonitor=new p.LagMonitor(this,t,n),this._lagMonitor.start())):this._logger.warn("Lag monitoring requires that you are logged in a Zone; please retry after completing the login process")}},{key:"send",value:function(e){if(this.isConnected){if(null!=e.validate&&null!=e.execute){this.debug&&this._logger.info("Sending request '"+h.Requests.getNameFromId(e.id)+"' to server");try{e.validate(this),e.execute(this)}catch(e){if(!(e instanceof a.SFSValidationError&&null!=e.message))throw e;var t=e.message;if(null!=e.errors){t+=":";for(var n=0;n<e.errors.length;n++)e.errors.length>1&&(t+=" "+(n+1)+")"),t+=" "+e.errors[n]}return this._logger.error("Request failed | "+t),!1}return this._socketEngine.send(e.getMessage()),!0}this._logger.error("An invalid request was passed: "+e)}else this._logger.error("You are not connected. Request cannot be sent: "+h.Requests.getNameFromId(e.id))}},{key:"getRoomById",value:function(e){return this.roomManager.getRoomById(e)}},{key:"getRoomByName",value:function(e){return this.roomManager.getRoomByName(e)}},{key:"getRoomList",value:function(){return this.roomManager.getRoomList()}},{key:"getRoomListFromGroup",value:function(e){return this.roomManager.getRoomListFromGroup(e)}},{key:"getJoinedRooms",value:function(){return this.roomManager.getJoinedRooms()}},{key:"_reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null!=this._buddyManager&&(this._buddyManager._clearAll(),this._buddyManager._inited=!1),this._userManager=new l.GlobalUserManager(this),this._roomManager=new c.SFSRoomManager(this),this._buddyManager=new f.SFSBuddyManager(this),null!=this._lagMonitor&&this._lagMonitor.destroy(),this._lagMonitor=null,this._isJoining=!1,this._currentZone=null,this._lastJoinedRoom=null,this._mySelf=null,e&&(this._sessionToken=null)}},{key:"_onSocketConnect",value:function(e){e.success?this.send(new _.HandshakeRequest(this.version,this._clientDetails)):this.dispatchEvent(s.SFSEvent.CONNECTION,{success:!1})}},{key:"_onSocketDisconnect",value:function(e){this.dispatchEvent(s.SFSEvent.CONNECTION_LOST,{reason:e.reason}),this._reset(!0)}},{key:"_onSocketData",value:function(e){var t=e.targetController,n=e.id,r=e.content;null!=t?null!=n?this._controllers[t].handleMessage(r,n):this._logger.error("Incoming message rejected: Command ID is missing"):this._logger.error("Incoming message rejected: Controller ID is missing")}},{key:"_onSocketIOError",value:function(e){this.dispatchEvent(s.SFSEvent.SOCKET_ERROR,{message:e})}},{key:"_handleHandShake",value:function(e){var t=e.get(h.BaseRequest.KEY_ERROR_CODE);if(null==t)this._sessionToken=e.get(_.HandshakeRequest.KEY_SESSION_TOKEN),this._socketEngine.maxMessageSize=e.get(_.HandshakeRequest.KEY_MAX_MESSAGE_SIZE),this._socketEngine.compressionThreshold=e.get(_.HandshakeRequest.KEY_COMPRESSION_THRESHOLD),this.dispatchEvent(s.SFSEvent.CONNECTION,{success:!0});else{var n={success:!1,errorMessage:y.SFSErrorCodes.getErrorMessage(t,e.get(h.BaseRequest.KEY_ERROR_PARAMS)),errorCode:t};this.dispatchEvent(s.SFSEvent.CONNECTION,n)}}},{key:"_handleLogout",value:function(){this._reset()}},{key:"_handleClientDisconnection",value:function(e){this.isConnected&&this._socketEngine.disconnect(e)}},{key:"version",get:function(){return this._majVersion+"."+this._minVersion+"."+this._subVersion}},{key:"config",get:function(){return this._configData}},{key:"logger",get:function(){return this._logger}},{key:"sessionToken",get:function(){return this._sessionToken}},{key:"roomManager",get:function(){return this._roomManager}},{key:"userManager",get:function(){return this._userManager}},{key:"buddyManager",get:function(){return this._buddyManager}},{key:"mySelf",get:function(){return this._mySelf}},{key:"lastJoinedRoom",get:function(){return this._lastJoinedRoom}},{key:"isConnected",get:function(){return null!=this._socketEngine&&this._socketEngine.isConnected}},{key:"maxMessageSize",get:function(){return null!=this._socketEngine?this._socketEngine.maxMessageSize:0}}]),t}();t.SmartFox=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SFSRoom=t.SetBuddyVariablesRequest=t.RemoveBuddyRequest=t.InitBuddyListRequest=t.GoOnlineRequest=t.BuddyMessageRequest=t.BlockBuddyRequest=t.AddBuddyRequest=t.SetUserPositionRequest=t.QuickJoinGameRequest=t.JoinRoomInvitationRequest=t.InviteUsersRequest=t.InvitationReplyRequest=t.CreateSFSGameRequest=t.BanUserRequest=t.KickUserRequest=t.ExtensionRequest=t.FindUsersRequest=t.FindRoomsRequest=t.PlayerToSpectatorRequest=t.SpectatorToPlayerRequest=t.UnsubscribeRoomGroupRequest=t.SubscribeRoomGroupRequest=t.SetUserVariablesRequest=t.SetRoomVariablesRequest=t.AdminMessageRequest=t.ModeratorMessageRequest=t.ObjectMessageRequest=t.PrivateMessageRequest=t.PublicMessageRequest=t.ChangeRoomCapacityRequest=t.ChangeRoomPasswordStateRequest=t.ChangeRoomNameRequest=t.LeaveRoomRequest=t.CreateRoomRequest=t.JoinRoomRequest=t.LogoutRequest=t.LoginRequest=t.ClientDisconnectionReason=t.LoggerEvent=t.LogLevel=t.SFSErrorCodes=t.MessageRecipientMode=t.BanMode=t.MapLimits=t.RoomExtension=t.RoomEvents=t.RoomPermissions=t.MMORoomSettings=t.SFSGameSettings=t.RoomSettings=t.UserProperties=t.RoomProperties=t.StringMatch=t.NumberMatch=t.BoolMatch=t.LogicOperator=t.MatchExpression=t.MMOItemVariable=t.ReservedBuddyVariables=t.SFSBuddyVariable=t.ReservedRoomVariables=t.SFSRoomVariable=t.SFSUserVariable=t.VariableType=t.UserPrivileges=t.InvitationReply=t.Vec3D=t.SFSArray=t.SFSObject=t.SFSDataType=t.SFSBuddyEvent=t.SFSEvent=t.SmartFox=void 0;var r=n(71);Object.defineProperty(t,"SmartFox",{enumerable:!0,get:function(){return r.SmartFox}});var i=n(4);Object.defineProperty(t,"SFSEvent",{enumerable:!0,get:function(){return i.SFSEvent}}),Object.defineProperty(t,"SFSBuddyEvent",{enumerable:!0,get:function(){return i.SFSBuddyEvent}});var o=n(2);Object.defineProperty(t,"SFSDataType",{enumerable:!0,get:function(){return o.SFSDataType}}),Object.defineProperty(t,"SFSObject",{enumerable:!0,get:function(){return o.SFSObject}}),Object.defineProperty(t,"SFSArray",{enumerable:!0,get:function(){return o.SFSArray}}),Object.defineProperty(t,"Vec3D",{enumerable:!0,get:function(){return o.Vec3D}});var s=n(18);Object.defineProperty(t,"InvitationReply",{enumerable:!0,get:function(){return s.InvitationReply}});var a=n(7);Object.defineProperty(t,"UserPrivileges",{enumerable:!0,get:function(){return a.UserPrivileges}});var u=n(8);Object.defineProperty(t,"VariableType",{enumerable:!0,get:function(){return u.VariableType}});var l=n(14);Object.defineProperty(t,"SFSUserVariable",{enumerable:!0,get:function(){return l.SFSUserVariable}});var c=n(9);Object.defineProperty(t,"SFSRoomVariable",{enumerable:!0,get:function(){return c.SFSRoomVariable}}),Object.defineProperty(t,"ReservedRoomVariables",{enumerable:!0,get:function(){return c.ReservedRoomVariables}});var f=n(6);Object.defineProperty(t,"SFSBuddyVariable",{enumerable:!0,get:function(){return f.SFSBuddyVariable}}),Object.defineProperty(t,"ReservedBuddyVariables",{enumerable:!0,get:function(){return f.ReservedBuddyVariables}});var h=n(19);Object.defineProperty(t,"MMOItemVariable",{enumerable:!0,get:function(){return h.MMOItemVariable}});var _=n(5);Object.defineProperty(t,"MatchExpression",{enumerable:!0,get:function(){return _.MatchExpression}}),Object.defineProperty(t,"LogicOperator",{enumerable:!0,get:function(){return _.LogicOperator}});var y=n(55);Object.defineProperty(t,"BoolMatch",{enumerable:!0,get:function(){return y.BoolMatch}}),Object.defineProperty(t,"NumberMatch",{enumerable:!0,get:function(){return y.NumberMatch}}),Object.defineProperty(t,"StringMatch",{enumerable:!0,get:function(){return y.StringMatch}});var d=n(54);Object.defineProperty(t,"RoomProperties",{enumerable:!0,get:function(){return d.RoomProperties}}),Object.defineProperty(t,"UserProperties",{enumerable:!0,get:function(){return d.UserProperties}});var p=n(12);Object.defineProperty(t,"RoomSettings",{enumerable:!0,get:function(){return p.RoomSettings}}),Object.defineProperty(t,"SFSGameSettings",{enumerable:!0,get:function(){return p.SFSGameSettings}}),Object.defineProperty(t,"MMORoomSettings",{enumerable:!0,get:function(){return p.MMORoomSettings}}),Object.defineProperty(t,"RoomPermissions",{enumerable:!0,get:function(){return p.RoomPermissions}}),Object.defineProperty(t,"RoomEvents",{enumerable:!0,get:function(){return p.RoomEvents}}),Object.defineProperty(t,"RoomExtension",{enumerable:!0,get:function(){return p.RoomExtension}}),Object.defineProperty(t,"MapLimits",{enumerable:!0,get:function(){return p.MapLimits}}),Object.defineProperty(t,"BanMode",{enumerable:!0,get:function(){return p.BanMode}}),Object.defineProperty(t,"MessageRecipientMode",{enumerable:!0,get:function(){return p.MessageRecipientMode}});var g=n(20);Object.defineProperty(t,"SFSErrorCodes",{enumerable:!0,get:function(){return g.SFSErrorCodes}});var b=n(10);Object.defineProperty(t,"LogLevel",{enumerable:!0,get:function(){return b.LogLevel}}),Object.defineProperty(t,"LoggerEvent",{enumerable:!0,get:function(){return b.LoggerEvent}});var v=n(11);Object.defineProperty(t,"ClientDisconnectionReason",{enumerable:!0,get:function(){return v.ClientDisconnectionReason}});var m=n(42);Object.defineProperty(t,"LoginRequest",{enumerable:!0,get:function(){return m.LoginRequest}});var S=n(41);Object.defineProperty(t,"LogoutRequest",{enumerable:!0,get:function(){return S.LogoutRequest}});var E=n(40);Object.defineProperty(t,"JoinRoomRequest",{enumerable:!0,get:function(){return E.JoinRoomRequest}});var R=n(17);Object.defineProperty(t,"CreateRoomRequest",{enumerable:!0,get:function(){return R.CreateRoomRequest}});var O=n(53);Object.defineProperty(t,"LeaveRoomRequest",{enumerable:!0,get:function(){return O.LeaveRoomRequest}});var A=n(39);Object.defineProperty(t,"ChangeRoomNameRequest",{enumerable:!0,get:function(){return A.ChangeRoomNameRequest}});var w=n(38);Object.defineProperty(t,"ChangeRoomPasswordStateRequest",{enumerable:!0,get:function(){return w.ChangeRoomPasswordStateRequest}});var T=n(37);Object.defineProperty(t,"ChangeRoomCapacityRequest",{enumerable:!0,get:function(){return T.ChangeRoomCapacityRequest}});var I=n(16);Object.defineProperty(t,"PublicMessageRequest",{enumerable:!0,get:function(){return I.PublicMessageRequest}}),Object.defineProperty(t,"PrivateMessageRequest",{enumerable:!0,get:function(){return I.PrivateMessageRequest}}),Object.defineProperty(t,"ObjectMessageRequest",{enumerable:!0,get:function(){return I.ObjectMessageRequest}}),Object.defineProperty(t,"ModeratorMessageRequest",{enumerable:!0,get:function(){return I.ModeratorMessageRequest}}),Object.defineProperty(t,"AdminMessageRequest",{enumerable:!0,get:function(){return I.AdminMessageRequest}});var k=n(36);Object.defineProperty(t,"SetRoomVariablesRequest",{enumerable:!0,get:function(){return k.SetRoomVariablesRequest}});var M=n(35);Object.defineProperty(t,"SetUserVariablesRequest",{enumerable:!0,get:function(){return M.SetUserVariablesRequest}});var P=n(34);Object.defineProperty(t,"SubscribeRoomGroupRequest",{enumerable:!0,get:function(){return P.SubscribeRoomGroupRequest}});var U=n(33);Object.defineProperty(t,"UnsubscribeRoomGroupRequest",{enumerable:!0,get:function(){return U.UnsubscribeRoomGroupRequest}});var j=n(32);Object.defineProperty(t,"SpectatorToPlayerRequest",{enumerable:!0,get:function(){return j.SpectatorToPlayerRequest}});var D=n(31);Object.defineProperty(t,"PlayerToSpectatorRequest",{enumerable:!0,get:function(){return D.PlayerToSpectatorRequest}});var N=n(30);Object.defineProperty(t,"FindRoomsRequest",{enumerable:!0,get:function(){return N.FindRoomsRequest}});var F=n(29);Object.defineProperty(t,"FindUsersRequest",{enumerable:!0,get:function(){return F.FindUsersRequest}});var B=n(21);Object.defineProperty(t,"ExtensionRequest",{enumerable:!0,get:function(){return B.ExtensionRequest}});var L=n(52);Object.defineProperty(t,"KickUserRequest",{enumerable:!0,get:function(){return L.KickUserRequest}});var Y=n(51);Object.defineProperty(t,"BanUserRequest",{enumerable:!0,get:function(){return Y.BanUserRequest}});var C=n(50);Object.defineProperty(t,"CreateSFSGameRequest",{enumerable:!0,get:function(){return C.CreateSFSGameRequest}});var q=n(49);Object.defineProperty(t,"InvitationReplyRequest",{enumerable:!0,get:function(){return q.InvitationReplyRequest}});var V=n(15);Object.defineProperty(t,"InviteUsersRequest",{enumerable:!0,get:function(){return V.InviteUsersRequest}});var K=n(48);Object.defineProperty(t,"JoinRoomInvitationRequest",{enumerable:!0,get:function(){return K.JoinRoomInvitationRequest}});var x=n(47);Object.defineProperty(t,"QuickJoinGameRequest",{enumerable:!0,get:function(){return x.QuickJoinGameRequest}});var G=n(28);Object.defineProperty(t,"SetUserPositionRequest",{enumerable:!0,get:function(){return G.SetUserPositionRequest}});var z=n(26);Object.defineProperty(t,"AddBuddyRequest",{enumerable:!0,get:function(){return z.AddBuddyRequest}});var H=n(24);Object.defineProperty(t,"BlockBuddyRequest",{enumerable:!0,get:function(){return H.BlockBuddyRequest}});var J=n(46);Object.defineProperty(t,"BuddyMessageRequest",{enumerable:!0,get:function(){return J.BuddyMessageRequest}});var X=n(23);Object.defineProperty(t,"GoOnlineRequest",{enumerable:!0,get:function(){return X.GoOnlineRequest}});var W=n(27);Object.defineProperty(t,"InitBuddyListRequest",{enumerable:!0,get:function(){return W.InitBuddyListRequest}});var Z=n(25);Object.defineProperty(t,"RemoveBuddyRequest",{enumerable:!0,get:function(){return Z.RemoveBuddyRequest}});var Q=n(22);Object.defineProperty(t,"SetBuddyVariablesRequest",{enumerable:!0,get:function(){return Q.SetBuddyVariablesRequest}});var $=n(3);Object.defineProperty(t,"SFSRoom",{enumerable:!0,get:function(){return $.SFSRoom}}),n(45)}])});
//# sourceMappingURL=sfs2x-api-1.7.10.js.map